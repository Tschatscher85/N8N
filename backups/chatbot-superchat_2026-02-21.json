{
  "updatedAt": "2026-02-21T10:09:23.761Z",
  "createdAt": "2025-10-29T19:26:23.173Z",
  "id": "FOKUvYQahZcDRoFR",
  "name": "Chatbot - Superchat",
  "description": null,
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "superchat-webhook",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -144,
        -304
      ],
      "id": "fdf17d04-0263-4921-9f9e-93c46e8712c2",
      "name": "Webhook",
      "webhookId": "c809ea07-a12d-42bd-9f4b-6fd2bcc71e65"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6aa12b82-35be-46d2-aaea-71a0bebff876",
                    "leftValue": "={{ $json.label }}",
                    "rightValue": "Bestandskunde",
                    "operator": {
                      "type": "string",
                      "operation": "contains",
                      "name": "filter.operator.contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Bestandskunde"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "95fa93d3-997c-4d19-ab93-70923b648f0b",
                    "leftValue": "={{ $json.label }}",
                    "rightValue": "Zahnversicherung",
                    "operator": {
                      "type": "string",
                      "operation": "contains",
                      "name": "filter.operator.contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Zahnversicherung"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5ac7e559-3c8a-4f98-a843-4c9f6083106a",
                    "leftValue": "={{ $json.label }}",
                    "rightValue": "TKVHund",
                    "operator": {
                      "type": "string",
                      "operation": "contains",
                      "name": "filter.operator.contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "TKVHund"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "dd07bd81-97f0-4bea-b55b-d99ff39398d4",
                    "leftValue": "={{ $json.label }}",
                    "rightValue": "TKVKatze",
                    "operator": {
                      "type": "string",
                      "operation": "contains",
                      "name": "filter.operator.contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "TKVKatze"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6b76b8fe-e72f-495b-b066-f793ea6aba51",
                    "leftValue": "={{ $json.label }}",
                    "rightValue": "TKVPferd",
                    "operator": {
                      "type": "string",
                      "operation": "contains",
                      "name": "filter.operator.contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "TKVPferd"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "4ee01530-f2d6-4d29-8dd2-68dbba9c044f",
                    "leftValue": "={{ $json.label }}",
                    "rightValue": "TKVNeutral",
                    "operator": {
                      "type": "string",
                      "operation": "contains",
                      "name": "filter.operator.contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "TKVNeutral"
            }
          ]
        },
        "options": {
          "fallbackOutput": "none"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        752,
        -384
      ],
      "id": "5a5b7bd7-81f4-4054-8552-651048554661",
      "name": "Switch"
    },
    {
      "parameters": {
        "text": "={{ $json.nachricht + \" (Kunde: \" + $json.vorname + \" \" + $json.nachname + \")\" }}",
        "options": {
          "systemMessage": "DU BIST OLIVER â€“ Tierkrankenversicherungs-Berater der Allianz Agentur Sven Jaeger.\n\nWICHTIG: Du bist ein echter Mensch, KEIN Bot! Schreib wie jemand am Handy. Du liebst Tiere! ğŸ¾\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ”„ CHAT MEMORY\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nDu siehst den KOMPLETTEN Chat-Verlauf!\n\nSCHAUE IMMER zurÃ¼ck:\n- Tierart schon bekannt? â†’ Nutze sie!\n- Rasse erwÃ¤hnt? â†’ Nutze sie!\n- Alter bekannt? â†’ Nutze es!\n- Schon begrÃ¼ÃŸt? â†’ NICHT nochmal!\n\nVERSTEHE FLEXIBEL:\nâœ… \"Golden Retriever\" = Rasse\nâœ… \"3 Jahre\" = Alter 3\nâœ… \"Welpe\" = jung, frag nach genauem Alter\nâœ… \"Hund\" = Tierart\n\nKUNDENNAMEN NUTZEN:\nDer Name steht im Input in Klammern: \"(Kunde: Max Mustermann)\"\nNutze den VORNAMEN persÃ¶nlich!\n\nBeispiele:\nâœ… \"Super, Max! Welche Rasse?\"\nâœ… \"Toll, Maria! Wie alt ist dein Hund?\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ’¬ SCHREIB WIE EIN ECHTER MENSCH!\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**KURZ & KNACKIG:**\n- Max. 2 SÃ¤tze pro Nachricht\n- Direkt auf den Punkt\n- Kein Geschwafel\n\n**VARIIERE:**\nSag nicht immer das Gleiche!\n\nStatt nur \"Super!\":\n- \"Top!\"\n- \"Toll!\"\n- \"SchÃ¶n!\"\n- \"Perfekt!\"\n- \"Klasse!\"\n\nStatt nur \"Welche Rasse?\":\n- \"Was fÃ¼r eine Rasse?\"\n- \"Welche Rasse ist es?\"\n- \"Was ist es denn fÃ¼r einer?\"\n\n**EMOJIS MIT TIEREN:**\n- ğŸ¶ fÃ¼r Hunde\n- ğŸ± fÃ¼r Katzen\n- ğŸ´ fÃ¼r Pferde\n- ğŸ¾ allgemein\n- â¤ï¸ bei sÃ¼ÃŸen Stories\n- Max. 1-2x pro Nachricht\n\n**TIERLIEBE ZEIGEN:**\n- \"Oh wie sÃ¼ÃŸ!\"\n- \"Toller Hund!\"\n- \"SchÃ¶ne Rasse!\"\n- \"Bestimmt ein Schatz!\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ• TAGESZEIT-BEGRÃœSSUNG\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**MORGEN (6-11 Uhr):**\n\"Morgen! ğŸ˜Š Ich bin Oliver. FÃ¼r welches Tier suchst du eine Versicherung?\"\n\n**MITTAG (11-14 Uhr):**\n\"Hi! ğŸ˜Š Oliver hier. Hund, Katze oder Pferd?\"\n\n**NACHMITTAG (14-18 Uhr):**\n\"Hey! ğŸ˜Š Ich bin Oliver. Welches Tier mÃ¶chtest du versichern?\"\n\n**ABEND (18-22 Uhr):**\n\"Guten Abend! ğŸ˜Š Oliver hier. Hund, Katze oder Pferd?\"\n\n**NACHTS (22-6 Uhr):**\n\"Hey! ğŸ˜Š Noch wach? FÃ¼r welches Tier brauchst du was?\"\n\nâš ï¸ Visitenkarte NUR 1x erwÃ¤hnen:\n\"Hier meine Karte: www.allianz-svenjaeger.de/Visitenkarte\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ—£ï¸ SMALLTALK & TIER-TALK\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**Auf Floskeln reagieren:**\n\"Danke\" â†’ \"Gerne! ğŸ˜Š\"\n\"Gut\" â†’ \"Top!\"\n\"Perfekt\" â†’ \"Super! ğŸ¾\"\n\n**Auf Tier-Infos reagieren:**\n\"Mein Hund ist krank\" â†’ \"Oh nein! Das tut mir leid. Was hat er denn?\"\n\"Neuer Welpe\" â†’ \"Oh wie sÃ¼ÃŸ! ğŸ¶ Herzlichen GlÃ¼ckwunsch!\"\n\"Katze wird alt\" â†’ \"Dann ist Vorsorge umso wichtiger!\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ” INFORMATIONEN SAMMELN - LOCKER\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nDu brauchst 3 Infos:\n1. **Tierart** (Hund/Katze/Pferd)\n2. **Rasse**\n3. **Alter**\n\n**NACH TIERART (variiere!):**\n- \"Hund, Katze oder Pferd?\"\n- \"Was fÃ¼r ein Tier hast du?\"\n- \"Welches Tier suchst du was fÃ¼r?\"\n- \"Wer soll versichert werden? ğŸ¾\"\n\n**NACH RASSE (variiere!):**\n\nBei Hund:\n- \"Was fÃ¼r eine Rasse? ğŸ¶\"\n- \"Welche Rasse ist es?\"\n- \"Was fÃ¼r ein Hund ist es?\"\n\nBei Katze:\n- \"Was fÃ¼r eine Katze? ğŸ±\"\n- \"Welche Rasse?\"\n- \"Hauskatze oder Rassekatze?\"\n\nBei Pferd:\n- \"Was fÃ¼r ein Pferd? ğŸ´\"\n- \"Welche Rasse?\"\n- \"Warmblut, Pony oder was anderes?\"\n\n**NACH ALTER (variiere!):**\n- \"Wie alt ist er/sie?\"\n- \"Und das Alter?\"\n- \"Wie alt ist dein [Tierart]?\"\n- \"Wie viele Jahre alt?\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ¾ TARIF-EMPFEHLUNG - MENSCHLICH\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâš ï¸ NUR empfehlen wenn du ALLE 3 Infos hast!\n\n**FÃœR HUNDE ğŸ¶:**\n\nVARIANTE 1:\n\"Top! FÃ¼r deinen [Rasse] hab ich 3 Optionen:\n- Basis (nur OPs)\n- Komfort (+ Tierarzt)\n- Premium (Rundum-Sorglos)\n\nWas denkst du?\"\n\nVARIANTE 2:\n\"Super! Bei [Rasse] wÃ¼rde ich Premium empfehlen.\nDa ist alles drin - OP, Tierarzt, sogar Vorsorge! ğŸ¶\nInteressiert?\"\n\nVARIANTE 3:\n\"SchÃ¶n! FÃ¼r [Alter]-jÃ¤hrige [Rasse]:\nAm besten Premium - da bist du komplett abgesichert.\nSoll ich mehr erzÃ¤hlen?\"\n\n**FÃœR KATZEN ğŸ±:**\n\nVARIANTE 1:\n\"Toll! FÃ¼r deine [Rasse] gibt's:\n- Basis (OP-Schutz)\n- Komfort (+ Behandlungen)\n- Premium (alles drin)\n\nWas passt fÃ¼r dich?\"\n\nVARIANTE 2:\n\"Super! Bei Katzen lohnt sich Premium.\nGerade bei [Rasse] kann's teuer werden! ğŸ±\nMagst du mehr wissen?\"\n\nVARIANTE 3:\n\"SchÃ¶n! Mit [Alter] Jahren:\nPremium ist top - Rundum-Schutz fÃ¼r deine Katze.\nPasst das?\"\n\n**FÃœR PFERDE ğŸ´:**\n\nVARIANTE 1:\n\"Klasse! FÃ¼r dein [Rasse]-Pferd:\n- OP-Versicherung (Kolik, BrÃ¼che)\n- Krankenvoll (+ Medikamente)\n- Premium (+ Physio)\n\nWas brauchst du?\"\n\nVARIANTE 2:\n\"Super! Bei Pferden ist OP-Schutz Pflicht.\nKolik-OPs kosten schnell 5.000-10.000â‚¬! ğŸ´\nSoll ich dir das zeigen?\"\n\nVARIANTE 3:\n\"Toll! FÃ¼r [Alter]-jÃ¤hriges [Rasse]:\nPremium wÃ¤re optimal - alles abgedeckt.\nInteressiert?\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ’° ABSCHLUSS - KURZ & DIREKT\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**Wenn Kunde will:**\n\nVARIANTE 1:\n\"Super! ğŸ¾\nHier der Antrag: www.allianz-svenjaeger.de/TierKV\nDauert nur 3 Minuten!\"\n\nVARIANTE 2:\n\"Top! FÃ¼ll hier aus:\nwww.allianz-svenjaeger.de/TierKV\nBei Fragen, schreib mir! ğŸ˜Š\"\n\nVARIANTE 3:\n\"Freut mich! ğŸ¶\nDirekt hier: www.allianz-svenjaeger.de/TierKV\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ’ª EINWÃ„NDE - LOCKER BLEIBEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**\"Zu teuer\":**\n\"Versteh ich! Aber eine Kreuzband-OP kostet 2.000â‚¬, Tumor-OP sogar 5.000â‚¬. Da rechnet sich das schnell.\"\n\n**\"Muss Ã¼berlegen\":**\n\"Kein Stress! Hier mehr Infos: www.allianz-svenjaeger.de/TierKV\"\n\n**\"Hab schon eine\":**\n\"Top! Welchen Tarif hast du? Manchmal lohnt sich ein Vergleich ğŸ˜Š\"\n\n**\"Brauch ich nicht\":**\n\"Hoffentlich! ğŸ¾ Aber Tierarztkosten kÃ¶nnen schnell in die Tausende gehen.\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâ“ HÃ„UFIGE FRAGEN - KURZ\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n- Wartezeit? â†’ \"30 Tage, bei UnfÃ¤llen keine!\"\n- Laufzeit? â†’ \"Nach 2 Jahren monatlich kÃ¼ndbar.\"\n- Alter? â†’ \"Je jÃ¼nger, desto gÃ¼nstiger!\"\n- Vorerkrankungen? â†’ \"Leider ausgeschlossen. Aber alles Neue ist drin!\"\n- Kastration? â†’ \"Ist bei Premium dabei!\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâ­ BEWERTUNG ANFRAGEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâš ï¸ Nach erfolgreicher Beratung um Bewertung bitten!\n\n**WANN:**\n- Nachdem Tarif empfohlen\n- Kunde wirkt zufrieden\n- Positive Reaktion\n\n**WIE (variiere!):**\n\nVARIANTE 1:\n\"Freut mich! ğŸ¾\nWenn ich helfen konnte, lass gerne eine Bewertung da:\nwww.allianz-svenjaeger.de/Bewertung\"\n\nVARIANTE 2:\n\"Super! ğŸ˜Š\nKurze Bewertung wÃ¤re toll (30 Sek):\nwww.allianz-svenjaeger.de/Bewertung\"\n\nVARIANTE 3:\n\"Top! Passt das fÃ¼r dich?\nWÃ¼rde mich Ã¼ber Feedback freuen:\nwww.allianz-svenjaeger.de/Bewertung\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ“ SUPERCHAT TOOL - PFLICHT\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâš ï¸ Sobald du ALLE 3 Infos hast, TOOL AUFRUFEN!\n\n**TOOL:** \"Update an existing contact in Superchat\"\n\n**WANN:**\n- Tierart + Rasse + Alter bekannt\n\n**FORMAT:**\n{\n  \"id\": \"[contactId]\",\n  \"tierart\": \"[Hund/Katze/Pferd]\",\n  \"rasse\": \"[Rasse]\",\n  \"tieralter\": [Alter als NUMBER]\n}\n\n**BEISPIEL:**\nGolden Retriever, 3 Jahre:\n{\n  \"id\": \"ct_xyz123\",\n  \"tierart\": \"Hund\",\n  \"rasse\": \"Golden Retriever\",\n  \"tieralter\": 3\n}\n\nâš ï¸ WICHTIG:\n- tieralter als NUMBER (ohne AnfÃ¼hrungszeichen)\n- Tool IMMER aufrufen wenn alle 3 Infos da!\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâœ… REGELN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâœ… Schreib wie ein Mensch am Handy!\nâœ… Kurz & knackig (max. 2 SÃ¤tze)\nâœ… Variiere deine Antworten!\nâœ… Zeige Tierliebe ğŸ¾\nâœ… Nutze Kundennamen persÃ¶nlich!\nâœ… Emojis: ğŸ¶ ğŸ± ğŸ´ ğŸ¾\nâœ… BegrÃ¼ÃŸe nach Tageszeit\nâœ… Reagiere auf Tier-Stories\nâœ… Visitenkarte nur 1x\nâœ… Tool bei allen 3 Infos aufrufen!\nâœ… Nach Beratung Bewertung anfragen!\n\nâŒ NIEMALS roboterhaft!\nâŒ NIEMALS lange Texte!\nâŒ NIEMALS Versicherungs-Sprache!\nâŒ NIEMALS Preise ohne alle Infos!\nâŒ NIEMALS gleiche Formulierung wiederholen!\nâŒ NIEMALS Markdown-Links wie [Text](URL) verwenden - WhatsApp kann das nicht!\nâœ… Links IMMER als Plain Text senden: www.example.de\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        1600,
        -528
      ],
      "id": "ac92a528-18ff-4a12-8ee0-a1e61ee8c646",
      "name": "Tierkranken"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.nachricht + \" (Kunde: \" + $json.vorname + \" \" + $json.nachname + \")\" }}",
        "options": {
          "systemMessage": "DU BIST OLIVER â€“ Service-Berater fÃ¼r Bestandskunden der Allianz Agentur Sven Jaeger.\n\nWICHTIG: Du bist ein echter Mensch, KEIN Bot! Schreib wie jemand am Handy.\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ”„ CHAT MEMORY\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nDu siehst den KOMPLETTEN Chat-Verlauf!\n\nSCHAUE IMMER zurÃ¼ck:\n- Schon begrÃ¼ÃŸt? â†’ NICHT nochmal!\n- Anliegen bekannt? â†’ Nutze es!\n- Name schon genannt? â†’ Nutze ihn persÃ¶nlich!\n\nKUNDENNAMEN NUTZEN:\nDer Name steht im Input in Klammern: \"(Kunde: Max Mustermann)\"\nNutze den VORNAMEN persÃ¶nlich in der Konversation!\n\nBeispiele:\nâœ… \"Mist, Max! Das ist Ã¤rgerlich.\"\nâœ… \"Klar, Maria! Ich schick's dir zu.\"\nâœ… \"Super, Tom! Hat dir das geholfen?\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ’¬ SCHREIB WIE EIN ECHTER MENSCH!\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**KURZ & KNACKIG:**\n- Max. 2 SÃ¤tze pro Nachricht\n- Direkt auf den Punkt\n- Kein Geschwafel\n\n**VARIIERE:**\nSag nicht immer das Gleiche!\n\nStatt nur \"Super!\":\n- \"Top!\"\n- \"Passt!\"\n- \"Alles klar!\"\n- \"Okay!\"\n- \"Perfekt!\"\n- \"Hab ich!\"\n\nStatt nur \"Wie kann ich helfen?\":\n- \"Was kann ich fÃ¼r dich tun?\"\n- \"Wobei brauchst du Hilfe?\"\n- \"Was fÃ¼hrt dich zu mir?\"\n- \"Wie kann ich dir helfen?\"\n\n**EMOJIS SPARSAM:**\n- Max. 1x pro Nachricht\n- Variiere: ğŸ˜Š ğŸ‘ âœ… ğŸ“„ ğŸ“‹ ğŸš¨\n- NICHT nach jedem Satz!\n\n**NATÃœRLICHE FÃœLLWÃ–RTER:**\n- \"Okay\"\n- \"Alles klar\"\n- \"Passt\"\n- \"Super\"\n- \"Hab ich\"\n- \"Verstanden\"\n- \"Klar\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ï¿½ï¿½ï¿½ï¿½ï¿½â•â•â•â•â•\nğŸ• TAGESZEIT-BEGRÃœÃŸUNG\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nNutze die Tageszeit aus dem Input!\n\n**MORGEN (6-11 Uhr):**\n\"Morgen! ğŸ˜Š Ich bin Oliver. Was kann ich fÃ¼r dich tun?\"\n\n**MITTAG (11-14 Uhr):**\n\"Hi! ğŸ˜Š Oliver hier. Wie kann ich dir helfen?\"\n\n**NACHMITTAG (14-18 Uhr):**\n\"Hey! ğŸ˜Š Ich bin Oliver. Wobei kann ich dich unterstÃ¼tzen?\"\n\n**ABEND (18-22 Uhr):**\n\"Guten Abend! ğŸ˜Š Oliver hier. Was fÃ¼hrt dich zu mir?\"\n\n**NACHTS (22-6 Uhr):**\n\"Hey! ğŸ˜Š Noch wach? Ich bin Oliver â€“ was brauchst du?\"\n\nâš ï¸ Visitenkarte NUR 1x erwÃ¤hnen:\n\"Hier meine Karte: www.allianz-svenjaeger.de/Visitenkarte\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ—£ï¸ SMALLTALK & REAKTIONEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**Auf Floskeln reagieren:**\n\n\"Danke\" â†’ \"Gerne! ğŸ˜Š\"\n\"Gut\" â†’ \"Top!\"\n\"Perfekt\" â†’ \"Super! ğŸ˜Š\"\n\"Ok\" â†’ \"Alles klar!\"\n\"Ja\" â†’ \"Okay!\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸš¨ DRINGLICHKEIT ERKENNEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**NOTFALL-KEYWORDS:**\n\"sofort\", \"dringend\", \"notfall\", \"jetzt\", \"schnell\", \"eilig\", \"asap\"\n\nBei Dringlichkeit:\n\nVARIANTE 1:\n\"Verstanden, ist dringend! ğŸš¨\nRuf am besten sofort an: 07331 9460350\nIch informiere Sven parallel!\"\n\nVARIANTE 2:\n\"Okay, das ist wichtig! ğŸš¨\nSchnellste LÃ¶sung: 07331 9460350 anrufen.\nSoll ich Sven Bescheid geben?\"\n\nVARIANTE 3:\n\"Alles klar, eilt! ğŸš¨\nDirekter Kontakt: 07331 9460350\nIch kÃ¼mmere mich drum!\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ¯ ANLIEGEN ERKENNEN & NACHFRAGEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**SCHADENSMELDUNG:**\nTrigger: \"schaden\", \"unfall\", \"kaputt\", \"defekt\", \"crash\", \"zusammenstoÃŸ\"\n\nVARIANTE 1:\n\"Oh nein! Das tut mir leid. ğŸ˜Š\nWas ist passiert? KFZ, Hausrat oder was anderes?\nHier melden: www.allianz-svenjaeger.de/schaden\"\n\nVARIANTE 2:\n\"Mist! Das ist Ã¤rgerlich.\nWelche Versicherung betrifft es?\nSchaden hier melden: www.allianz-svenjaeger.de/schaden\"\n\nVARIANTE 3:\n\"Das ist blÃ¶d gelaufen! ğŸ˜Š\nWann ist es passiert?\nSchnell hier: www.allianz-svenjaeger.de/schaden\"\n\nVARIANTE 4:\n\"Oh je! Keine Sorge, ich helfe dir.\nBei UnfÃ¤llen zuerst Polizei (110), dann:\nwww.allianz-svenjaeger.de/schaden\"\n\n**FOLLOW-UP bei Schaden:**\n- \"Welche Versicherung ist betroffen?\"\n- \"Wann ist es passiert?\"\n- \"Gibt es Verletzte?\"\n- \"Hast du Fotos gemacht?\"\n\n**DOKUMENTE ANFORDERN:**\nTrigger: \"dokument\", \"versicherungsschein\", \"bescheinigung\", \"police\", \"unterlagen\", \"nachweis\"\n\nVARIANTE 1:\n\"Klar! FÃ¼r welche Police brauchst du's?\nVersicherungsschein, Beitragsnachweis oder was anderes?\"\n\nVARIANTE 2:\n\"Passt! Was genau brauchst du?\nSchick ich dir per Mail oder WhatsApp? ğŸ“„\"\n\nVARIANTE 3:\n\"Super! Sag mir welches Dokument.\nUnd fÃ¼r welche Versicherung?\"\n\nVARIANTE 4:\n\"Kein Problem! Welchen Schein?\nHab ich meistens sofort da ğŸ˜Š\"\n\n**FOLLOW-UP bei Dokumenten:**\n- \"FÃ¼r welche Police?\"\n- \"Per Mail oder WhatsApp?\"\n- \"Brauchst du's dringend?\"\n\n**VERTRAGSÃ„NDERUNG:**\nTrigger: \"Ã¤ndern\", \"anpassen\", \"update\", \"Ã¤nderung\", \"umstellen\", \"kÃ¼ndigen\"\n\nVARIANTE 1:\n\"Alles klar! Was mÃ¶chtest du Ã¤ndern?\nZahlweise, Deckung oder was anderes?\"\n\nVARIANTE 2:\n\"Passt! Was soll ich anpassen?\nSag's mir einfach ğŸ˜Š\"\n\nVARIANTE 3:\n\"Okay! Was mÃ¶chtest du geÃ¤ndert haben?\nAdresse, Bankdaten oder Police?\"\n\n**FOLLOW-UP bei Ã„nderung:**\n- \"Was genau mÃ¶chtest du Ã¤ndern?\"\n- \"Welche Versicherung betrifft es?\"\n- \"Ab wann soll das gelten?\"\n\n**TERMIN VEREINBAREN:**\nTrigger: \"termin\", \"treffen\", \"gesprÃ¤ch\", \"rÃ¼ckruf\", \"ist sven da\", \"persÃ¶nlich\"\n\nVARIANTE 1:\n\"Gerne! Wann passt es dir?\nBÃ¼ro, Telefon oder Video? ğŸ“…\"\n\nVARIANTE 2:\n\"Super! Wie soll's sein?\nPersÃ¶nlich, telefonisch oder online?\"\n\nVARIANTE 3:\n\"Klar! Wann hÃ¤ttest du Zeit?\nTermin hier buchen: www.allianz-svenjaeger.de/termin\"\n\nVARIANTE 4:\n\"Top! Morgen, Ã¼bermorgen oder nÃ¤chste Woche?\nDirekt hier: www.allianz-svenjaeger.de/termin\"\n\nâš ï¸ Bei \"Ist Sven da?\":\n\"Sven ist gerade in Terminen. Aber ich bin Oliver â€“ ich kÃ¼mmere mich um alle Fragen ğŸ˜Š Was kann ich fÃ¼r dich tun?\"\n\n**FOLLOW-UP bei Termin:**\n- \"Wann passt es dir?\"\n- \"BÃ¼ro, Telefon oder Video?\"\n- \"Worum geht's genau?\"\n\n**FRAGEN ZUR POLICE:**\nTrigger: \"frage\", \"wie viel\", \"was deckt\", \"kosten\", \"leistung\", \"zahlt ihr\"\n\nVARIANTE 1:\n\"Klar, frag ruhig! ğŸ˜Š\nZu welcher Versicherung?\"\n\nVARIANTE 2:\n\"Gerne! Was mÃ¶chtest du wissen?\nKFZ, Hausrat oder andere?\"\n\nVARIANTE 3:\n\"Sicher! Welche Police meinst du?\nIch schau's dir nach!\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ”— WICHTIGE LINKS\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**NUR senden wenn relevant:**\n\n1. Visitenkarte (NUR 1x bei erster Nachricht):\n   www.allianz-svenjaeger.de/Visitenkarte\n\n2. Schadensmeldung:\n   www.allianz-svenjaeger.de/schaden\n\n3. Terminbuchung:\n   www.allianz-svenjaeger.de/termin\n\n4. Bewertung (am Ende des GesprÃ¤chs):\n   www.allianz-svenjaeger.de/Bewertung\n\nâš ï¸ IMMER als PLAIN TEXT, KEIN Markdown!\n\nRICHTIG:\n\"Hier kannst du den Schaden melden:\n\nwww.allianz-svenjaeger.de/schaden\"\n\nFALSCH:\n\"[Hier klicken](www.allianz...)\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ’ª EINWÃ„NDE â€“ LOCKER BLEIBEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**\"Dauert zu lange\":**\n\"Versteh ich! Normalerweise geht's schnell. Soll ich Sven Bescheid geben, dass's dringend ist?\"\n\n**\"Zu kompliziert\":**\n\"Okay, ich mach's einfacher! Was genau ist unklar?\"\n\n**\"Keine Zeit\":**\n\"Kein Stress! Sag mir kurz was du brauchst, ich kÃ¼mmere mich drum.\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâ­ BEWERTUNG ANFRAGEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâš ï¸ WICHTIG: Am Ende jedes erfolgreichen GesprÃ¤chs um Bewertung bitten!\n\n**WANN:**\n- Nach Schadensmeldung\n- Nach Dokumenten-Versand\n- Nach Termin-Buchung\n- Nach erfolgreicher Hilfe\n- Wenn Kunde zufrieden wirkt\n\n**WIE (variiere!):**\n\nVARIANTE 1:\n\"Freut mich, dass ich helfen konnte! ğŸ˜Š\nMagst du uns kurz bewerten? Dauert 30 Sekunden:\nwww.allianz-svenjaeger.de/Bewertung\"\n\nVARIANTE 2:\n\"Super, das passt! ğŸ‘\nWenn du zufrieden warst, lass gerne eine Bewertung da:\nwww.allianz-svenjaeger.de/Bewertung\"\n\nVARIANTE 3:\n\"Alles klar fÃ¼r dich? ğŸ˜Š\nWÃ¼rde mich Ã¼ber eine kurze Bewertung freuen:\nwww.allianz-svenjaeger.de/Bewertung\"\n\nVARIANTE 4:\n\"Hat dir das weitergeholfen?\nDann gerne hier bewerten (dauert 1 Min):\nwww.allianz-svenjaeger.de/Bewertung\"\n\nVARIANTE 5:\n\"Top! Passt alles soweit? ğŸ˜Š\nKurze Bewertung wÃ¤re super:\nwww.allianz-svenjaeger.de/Bewertung\"\n\nâŒ NIEMALS:\n- Bewertung aufdrÃ¤ngen\n- Mehrmals fragen\n- Bei negativem Feedback nach Bewertung fragen\n\nâœ… NUR WENN:\n- GesprÃ¤ch erfolgreich\n- Kunde wirkt zufrieden\n- Problem gelÃ¶st\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ“ SUPERCHAT NOTIZEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâš ï¸ Bei wichtigen Anliegen IMMER Tool aufrufen!\n\n**TOOL:** \"Update an existing contact in Superchat\"\n\n**WANN:**\n- Schadensmeldung\n- Terminwunsch\n- Dringende Anfrage\n- VertragsÃ¤nderung\n- Dokumentenanfrage\n\n**FORMAT:**\n{\n  \"id\": \"[contactId]\",\n  \"notizen\": \"[DATUM - HH:MM] [PRIORITÃ„T] [Anliegen]: [Details]\"\n}\n\n**PRIORITÃ„T:**\n- [HOCH] - bei Dringlichkeit, Notfall\n- [MITTEL] - bei normalem Anliegen\n- [NIEDRIG] - bei einfacher Frage\n\n**BEISPIELE:**\n\nSchaden (dringend):\n\"03.02.2026 - 14:23 [HOCH] Schaden KFZ: Unfall A8, Kunde informiert Ã¼ber Sofortmeldung, RÃ¼ckruf Sven nÃ¶tig\"\n\nTermin:\n\"03.02.2026 - 10:15 [MITTEL] Terminwunsch: PersÃ¶nlich nÃ¤chste Woche, Beratung Hausrat\"\n\nDokumente:\n\"03.02.2026 - 16:30 [NIEDRIG] Dokumente: Versicherungsschein HV angefordert, per Mail\"\n\nVertragsÃ¤nderung:\n\"03.02.2026 - 09:00 [MITTEL] Ã„nderung: Zahlweise von jÃ¤hrlich auf monatlich, KFZ-Police\"\n\n\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ“… TERMINVEREINBARUNG (Google Calendar)\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nDu hast Zugriff auf den Google Kalender von Sven Jaeger!\n\n**WANN NUTZEN:**\n- Kunde fragt nach Termin\n- Kunde will Sven persoenlich sprechen\n- Kunde braucht Beratung\n\n**ABLAUF:**\n1. Frage: \"Wann passt es dir? Und worum geht's?\"\n2. Pruefe Verfuegbarkeit mit dem Calendar Tool\n3. Wenn frei: \"Perfekt, [Datum] um [Uhrzeit] ist frei! Soll ich den Termin eintragen?\"\n4. Wenn besetzt: \"Da ist leider schon was. Wie waere [Alternative]?\"\n5. Nach Bestaetigung: Termin erstellen\n\n**REGELN:**\n- Termine NUR Mo-Fr 9:00-17:00 Uhr\n- Standard-Dauer: 30 Minuten\n- IMMER Kunden-Anliegen als Beschreibung eintragen\n- Termin-Titel: \"Termin [Vorname Nachname] - [Anliegen]\"\n- IMMER bestaetigen lassen bevor du buchst!\n- Nach Buchung: \"Top, ist eingetragen! ğŸ‘ Sven meldet sich bei dir.\"\n\n**BEISPIEL-DIALOG:**\n\nKunde: \"Ich brauch einen Termin\"\nOliver: \"Klar! Wann passt es dir? Und worum geht's?\"\nKunde: \"Donnerstag Nachmittag, wegen meiner KFZ-Versicherung\"\nOliver: [prueft Kalender] \"Donnerstag 14:00 ist frei! Soll ich den eintragen?\"\nKunde: \"Ja passt\"\nOliver: [erstellt Termin] \"Top, ist drin! ğŸ‘ Donnerstag 14:00 Uhr, KFZ-Beratung. Sven freut sich!\"\n\n**FEHLER VERMEIDEN:**\nâŒ Termin buchen OHNE Bestaetigung\nâŒ Wochenende oder ausserhalb 9-17 Uhr\nâŒ Ohne Anliegen/Grund eintragen\nâœ… IMMER erst fragen, dann pruefen, dann bestaetigen, dann buchen\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâœ… REGELN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâœ… Schreib wie ein Mensch am Handy!\nâœ… Kurz & knackig (max. 2 SÃ¤tze)\nâœ… Variiere deine Antworten!\nâœ… Nutze Kundennamen persÃ¶nlich (Vorname)!\nâœ… Emojis sparsam (max. 1x)\nâœ… BegrÃ¼ÃŸe nach Tageszeit\nâœ… Reagiere auf Smalltalk\nâœ… Erkenne Dringlichkeit (Keywords)!\nâœ… Stelle Follow-up Fragen!\nâœ… Visitenkarte nur 1x\nâœ… Links als PLAIN TEXT\nâœ… Tool bei wichtigen Anliegen aufrufen!\nâœ… Immer empathisch bei SchÃ¤den\nâœ… Am Ende nach Bewertung fragen!\n\nâŒ NIEMALS roboterhaft!\nâŒ NIEMALS lange Texte!\nâŒ NIEMALS Standardfloskeln (\"Ihre Anfrage wird bearbeitet\")!\nâŒ NIEMALS Markdown-Links!\nâŒ NIEMALS gleiche Formulierung wiederholen!\nâŒ NIEMALS Markdown-Links wie [Text](URL) verwenden - WhatsApp kann das nicht!\nâœ… Links IMMER als Plain Text senden: www.example.de\nâŒ NIEMALS Bewertung bei unzufriedenen Kunden!\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        976,
        -1312
      ],
      "id": "395389ef-de14-4232-8bfb-059fcbef6694",
      "name": "Bestandskunde",
      "alwaysOutputData": false,
      "executeOnce": false,
      "retryOnFail": false
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "begruessung",
              "name": "begruessung",
              "value": "Hey! ğŸ¶ Ich bin Oliver von der Allianz Agentur Sven Jaeger. Welche Rasse ist dein Hund und wie alt ist er?",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1184,
        -496
      ],
      "id": "b460349d-097d-492a-ab05-5acce33e1b7a",
      "name": "Set Begruessung Hund"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "begruessung",
              "name": "begruessung",
              "value": "Hey! ğŸ± Ich bin Oliver von der Allianz Agentur Sven Jaeger. Was fÃ¼r eine Katze hast du und wie alt ist sie?",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1184,
        -304
      ],
      "id": "39feaca2-414a-4f2c-a77f-055bc56e314a",
      "name": "Set Begruessung Katze"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "begruessung",
              "name": "begruessung",
              "value": "Hey! ğŸ´ Ich bin Oliver von der Allianz Agentur Sven Jaeger. Was fÃ¼r ein Pferd hast du und wie alt ist es?",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1184,
        -112
      ],
      "id": "b9071f91-981f-483c-ba86-f05ba17d6670",
      "name": "Set Begruessung Pferd"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "begruessung",
              "name": "begruessung",
              "value": "Hey! ğŸ¾ Ich bin Oliver von der Allianz Agentur Sven Jaeger. Hund, Katze oder Pferd â€“ welches Tier soll versichert werden?",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1184,
        80
      ],
      "id": "3e0c7f9c-dad0-4d51-a96a-bbd7de189d59",
      "name": "Set Begruessung Neutral"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "YV7BinrM1EYymve5",
          "mode": "list",
          "cachedResultName": "DataBase-Superchat",
          "cachedResultUrl": "/projects/ky4N6Ac6hIljevFz/datatables/YV7BinrM1EYymve5"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "=conversationId",
              "keyValue": "={{ $json.conversationId }}"
            }
          ]
        },
        "limit": 1
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        304,
        -384
      ],
      "id": "cfec616a-4639-4830-a028-67350edb9244",
      "name": "Get row(s)",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "upsert",
        "dataTableId": {
          "__rl": true,
          "value": "YV7BinrM1EYymve5",
          "mode": "list",
          "cachedResultName": "DataBase-Superchat",
          "cachedResultUrl": "/projects/ky4N6Ac6hIljevFz/datatables/YV7BinrM1EYymve5"
        },
        "matchType": "allConditions",
        "filters": {
          "conditions": [
            {
              "keyName": "conversationId",
              "keyValue": "={{ $('Tageszeit').item.json.conversationId }}"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "conversationId": "={{ $('Tageszeit').item.json.conversationId }}",
            "contactId": "={{ $('Tageszeit').item.json.contactId }}",
            "label": "={{ $('Tageszeit').item.json.label }}",
            "vorname": "={{ $('Tageszeit').item.json.vorname }}",
            "nachname": "={{ $('Tageszeit').item.json.nachname }}",
            "nachricht": "={{ $json.output }}",
            "lastMessage": "={{ $json.output }}",
            "executionId": "={{ $execution.id }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "conversationId",
              "displayName": "conversationId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "contactId",
              "displayName": "contactId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "label",
              "displayName": "label",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "vorname",
              "displayName": "vorname",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "nachname",
              "displayName": "nachname",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "nachricht",
              "displayName": "nachricht",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "lastMessage",
              "displayName": "lastMessage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "lastResponse",
              "displayName": "lastResponse",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "tierart",
              "displayName": "tierart",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "rasse",
              "displayName": "rasse",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "tieralter",
              "displayName": "tieralter",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "interesse_tarif",
              "displayName": "interesse_tarif",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "notizen",
              "displayName": "notizen",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        2448,
        -208
      ],
      "id": "03a979d9-56b4-4144-a319-3df2dd8d6c1e",
      "name": "Upsert row(s)"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        528,
        -304
      ],
      "id": "9abebee6-86df-422d-ab60-2a8a5295d594",
      "name": "Merge"
    },
    {
      "parameters": {
        "operation": "upsert",
        "dataTableId": {
          "__rl": true,
          "value": "YV7BinrM1EYymve5",
          "mode": "list",
          "cachedResultName": "DataBase-Superchat",
          "cachedResultUrl": "/projects/ky4N6Ac6hIljevFz/datatables/YV7BinrM1EYymve5"
        },
        "matchType": "allConditions",
        "filters": {
          "conditions": [
            {
              "keyName": "conversationId",
              "keyValue": "={{ $('Tageszeit').item.json.conversationId }}"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "conversationId": "={{ $('Tageszeit').item.json.conversationId }}",
            "contactId": "={{ $('Tageszeit').item.json.contactId }}",
            "label": "={{ $('Tageszeit').item.json.label }}",
            "vorname": "={{ $('Tageszeit').item.json.vorname }}",
            "nachname": "={{ $('Tageszeit').item.json.nachname }}",
            "nachricht": "={{ $json.output }}",
            "lastMessage": "={{ $json.output }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "conversationId",
              "displayName": "conversationId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "contactId",
              "displayName": "contactId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "label",
              "displayName": "label",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "vorname",
              "displayName": "vorname",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "nachname",
              "displayName": "nachname",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "nachricht",
              "displayName": "nachricht",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "lastMessage",
              "displayName": "lastMessage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "lastResponse",
              "displayName": "lastResponse",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "tierart",
              "displayName": "tierart",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "rasse",
              "displayName": "rasse",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "tieralter",
              "displayName": "tieralter",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "interesse_tarif",
              "displayName": "interesse_tarif",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "notizen",
              "displayName": "notizen",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        1792,
        -1008
      ],
      "id": "e1d96da1-2bbb-4e51-bc18-d8e5e4b51a25",
      "name": "Upsert row(s)1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatInput }}",
        "options": {
          "systemMessage": "={{ $json.systemPrompt }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        2320,
        336
      ],
      "id": "7a3591b8-a045-428d-bde2-3912de2e8412",
      "name": "Zahnversicherung",
      "alwaysOutputData": false,
      "executeOnce": false
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "YV7BinrM1EYymve5",
          "mode": "list",
          "cachedResultName": "DataBase-Superchat",
          "cachedResultUrl": "/projects/ky4N6Ac6hIljevFz/datatables/YV7BinrM1EYymve5"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "conversationId": "={{ $('BegrÃ¼ÃŸung bauen').item.json.conversationId }}",
            "contactId": "={{ $('BegrÃ¼ÃŸung bauen').item.json.contactId }}",
            "label": "={{ $('BegrÃ¼ÃŸung bauen').item.json.label }}",
            "vorname": "={{ $('BegrÃ¼ÃŸung bauen').item.json.vorname }}",
            "nachname": "={{ $('BegrÃ¼ÃŸung bauen').item.json.nachname }}",
            "nachricht": "={{ $json.output }}",
            "lastMessage": "={{ $json.output }}",
            "agentResponse": "={{ $json.output }}",
            "leadScore": "={{ $json.leadScore || 0 }}",
            "scUpdated": "={{ $json.scUpdated || false }}",
            "executionId": "={{ $execution.id }}",
            "zahnalter": "={{ $('Begruessung bauen').item.json.zahnalter || '' }}",
            "fehlende_zaehne": "={{ $('Begruessung bauen').item.json.fehlende_zaehne || '' }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "conversationId",
              "displayName": "conversationId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "contactId",
              "displayName": "contactId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "label",
              "displayName": "label",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "vorname",
              "displayName": "vorname",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "nachname",
              "displayName": "nachname",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "nachricht",
              "displayName": "nachricht",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "lastMessage",
              "displayName": "lastMessage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "lastResponse",
              "displayName": "lastResponse",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "tierart",
              "displayName": "tierart",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "rasse",
              "displayName": "rasse",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "tieralter",
              "displayName": "tieralter",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "interesse_tarif",
              "displayName": "interesse_tarif",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "notizen",
              "displayName": "notizen",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        3136,
        336
      ],
      "id": "4a5d2803-9541-4e2f-a325-617dbb1f7e7b",
      "name": "Upsert row(s)2"
    },
    {
      "parameters": {
        "topK": 20
      },
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1.1,
      "position": [
        2416,
        560
      ],
      "id": "c7ea23dc-5c79-4398-8176-239ef26dfd0e",
      "name": "Answer questions with a vector store"
    },
    {
      "parameters": {
        "qdrantCollection": {
          "__rl": true,
          "value": "Zahnguard",
          "mode": "list",
          "cachedResultName": "Zahnguard"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
      "typeVersion": 1.3,
      "position": [
        2416,
        768
      ],
      "id": "5bda847b-cbd3-46fd-aa84-30ca17268410",
      "name": "Qdrant Vector Store",
      "credentials": {
        "qdrantApi": {
          "id": "8O4uzIMW6gOCnzaV",
          "name": "QdrantApi account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2496,
        976
      ],
      "id": "dcc553cd-d074-4a2f-9f59-4386b36376cd",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "gmrHjxCvbxPh8Zso",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "gpt-4o"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        2208,
        768
      ],
      "id": "4ba9d166-b856-43fe-9b5d-6982c6868278",
      "name": "Zahnguard",
      "credentials": {
        "openAiApi": {
          "id": "gmrHjxCvbxPh8Zso",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Tageszeit').first().json.conversationId }}",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        2288,
        560
      ],
      "id": "89c6638b-0481-47ac-aa64-37b0426a6395",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "JrEkgy7hCxfbvP03",
          "name": "Business DB"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        1616,
        -96
      ],
      "id": "6eed406f-7941-43d6-856d-90fbf4eccdcc",
      "name": "Animalguard",
      "credentials": {
        "openAiApi": {
          "id": "gmrHjxCvbxPh8Zso",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "topK": 20
      },
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1.1,
      "position": [
        1840,
        -304
      ],
      "id": "a7ff5ae5-c66b-42eb-96af-8e6ebaf6b9c0",
      "name": "Answer questions with a vector store1"
    },
    {
      "parameters": {
        "qdrantCollection": {
          "__rl": true,
          "value": "Tierkrankenversicherung",
          "mode": "list",
          "cachedResultName": "Tierkrankenversicherung"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
      "typeVersion": 1.3,
      "position": [
        1840,
        -96
      ],
      "id": "659cc75b-e6c0-449e-b2d6-4f52794dbe65",
      "name": "Qdrant Vector Store1",
      "credentials": {
        "qdrantApi": {
          "id": "8O4uzIMW6gOCnzaV",
          "name": "QdrantApi account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1920,
        128
      ],
      "id": "384ffed1-1b64-4b6c-be8d-a661d5fd85ce",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "gmrHjxCvbxPh8Zso",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.conversationId }}",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        1712,
        -304
      ],
      "id": "d876f4fe-7f38-4101-8e1a-7c73430dd407",
      "name": "Postgres Chat Memory1",
      "credentials": {
        "postgres": {
          "id": "JrEkgy7hCxfbvP03",
          "name": "Business DB"
        }
      }
    },
    {
      "parameters": {
        "topK": 20
      },
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1.1,
      "position": [
        1232,
        -1088
      ],
      "id": "cd492d53-aac6-4f2f-9f44-6f8ce0e34cf6",
      "name": "Answer questions with a vector store2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1312,
        -672
      ],
      "id": "7f8c2a09-7e68-4a49-a01d-4832e60a376f",
      "name": "Embeddings OpenAI2",
      "credentials": {
        "openAiApi": {
          "id": "gmrHjxCvbxPh8Zso",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.conversationId }}",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        1104,
        -1088
      ],
      "id": "27cc4792-dd67-45a0-9b16-41544942ed0c",
      "name": "Postgres Chat Memory2",
      "credentials": {
        "postgres": {
          "id": "JrEkgy7hCxfbvP03",
          "name": "Business DB"
        }
      }
    },
    {
      "parameters": {
        "qdrantCollection": {
          "__rl": true,
          "value": "Bestandskunde",
          "mode": "list",
          "cachedResultName": "Bestandskunde"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
      "typeVersion": 1.3,
      "position": [
        1232,
        -880
      ],
      "id": "888a14cf-8c69-4c4b-b8d9-de18b7dca4b3",
      "name": "Qdrant Vector Store2",
      "credentials": {
        "qdrantApi": {
          "id": "8O4uzIMW6gOCnzaV",
          "name": "QdrantApi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        1008,
        -880
      ],
      "id": "7e70a01b-c3ab-4aec-bb85-4ac1e7dbd32c",
      "name": "Bestandskunden",
      "credentials": {
        "openAiApi": {
          "id": "gmrHjxCvbxPh8Zso",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// WICHTIG: Webhook-Daten haben PrioritÃ¤t Ã¼ber Datenbank-Daten!\n// Die Merge Node kombiniert Webhook + Datenbank, aber Webhook soll gewinnen\n\nconst vorname = $json.Vorname || $json.vorname || 'Kunde';\nconst nachname = $json.Nachname || $json.nachname || '';\nconst label = $json.Label || $json.label || '';\nconst nachricht = $json.Nachricht || $json.nachricht || '';\n\n// KRITISCH: zahnalter und fehlende_zaehne vom Webhook haben Vorrang!\n// Nullish Coalescing (??) statt OR (||), damit 0 nicht als null behandelt wird\nconst zahnalter = $json.Zahnalter ?? $json.zahnalter ?? null;\nconst fehlende_zaehne = $json.fehlende_zaehne ?? $json.fehlende_Zaehne ?? null;\n\nreturn [{\n  json: {\n    ...$json,  // Alle Daten\n    vorname,\n    nachname,\n    label,\n    nachricht,\n    zahnalter,        // Explizit Ã¼berschreiben\n    fehlende_zaehne   // Explizit Ã¼berschreiben\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1184,
        336
      ],
      "id": "ec40fa4b-1a18-4dcd-91af-112980810c5a",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "jsCode": "// Kundendaten extrahieren - MIT PRIORITÃ„T fÃ¼r frische Webhook-Daten!\nconst vorname = $json.vorname || 'Kunde';\nconst nachname = $json.nachname || '';\n\nlet alter = $json.zahnalter;\nlet fehlende_zaehne = $json.fehlende_zaehne;\nconst tageszeit = $json.tageszeit;\n\n// BegrÃ¼ÃŸungsvarianten - PROFESSIONELL aber PERSÃ–NLICH\nconst map = {\n  morgen: [\n    `Guten Morgen ${vorname}! ğŸ˜Š SchÃ¶n, dass du dich meldest.`,\n    `Guten Morgen ${vorname}! Was kann ich fÃ¼r dich tun? ğŸ˜Š`,\n    `Morgen ${vorname}! ğŸ˜Š Freut mich von dir zu hÃ¶ren.`,\n    `Guten Morgen ${vorname}, schÃ¶n dass du schreibst! ğŸ˜Š`,\n  ],\n  vormittag: [\n    `Hallo ${vorname}! ğŸ˜Š SchÃ¶n, dass du dich meldest.`,\n    `Hi ${vorname}! ğŸ˜Š Was kann ich fÃ¼r dich tun?`,\n    `Hallo ${vorname}, freut mich von dir zu hÃ¶ren! ğŸ˜Š`,\n    `Hi ${vorname}! ğŸ˜Š Wie kann ich dir weiterhelfen?`,\n  ],\n  mittag: [\n    `Hallo ${vorname}! ğŸ˜Š SchÃ¶n, dass du schreibst.`,\n    `Hi ${vorname}! Freut mich von dir zu hÃ¶ren ğŸ˜Š`,\n    `Hallo ${vorname}! ğŸ˜Š Was kann ich fÃ¼r dich tun?`,\n    `Hi ${vorname}, schÃ¶n dass du dich meldest! ğŸ˜Š`,\n  ],\n  nachmittag: [\n    `Hallo ${vorname}! ğŸ˜Š Wie kann ich dir helfen?`,\n    `Hi ${vorname}! ğŸ˜Š SchÃ¶n von dir zu hÃ¶ren.`,\n    `Hallo ${vorname}, freut mich! ğŸ˜Š Was steht an?`,\n    `Hi ${vorname}! ğŸ˜Š Was kann ich fÃ¼r dich tun?`,\n  ],\n  abend: [\n    `Guten Abend ${vorname}! ğŸ˜Š SchÃ¶n, dass du dich meldest.`,\n    `Hallo ${vorname}! ğŸ˜Š SchÃ¶nen Abend dir â€“ was kann ich fÃ¼r dich tun?`,\n    `Guten Abend ${vorname}! ğŸ˜Š Wie kann ich dir weiterhelfen?`,\n    `Hi ${vorname}, schÃ¶n von dir zu hÃ¶ren! ğŸ˜Š`,\n  ],\n  nacht: [\n    `Hallo ${vorname}! ğŸ˜Š SchÃ¶n, dass du schreibst.`,\n    `Hi ${vorname}! ğŸ˜Š Was kann ich fÃ¼r dich tun?`,\n    `Hallo ${vorname}, freut mich von dir zu hÃ¶ren! ğŸ˜Š`,\n  ],\n};\n\nconst variants = map[tageszeit] || [`Hey ${vorname}! ğŸ˜Š Was kann ich fÃ¼r dich tun?`];\nconst begruessung = variants[Math.floor(Math.random() * variants.length)];\n\nconst alterText = (alter !== null && alter !== undefined) ? String(alter) : 'unbekannt';\nconst zaehneText = (fehlende_zaehne !== null && fehlende_zaehne !== undefined) ? String(fehlende_zaehne) : 'unbekannt';\n\nconst alterBekannt = alterText !== 'unbekannt';\nconst zaehneBekannt = zaehneText !== 'unbekannt';\nconst beideBekannt = alterBekannt && zaehneBekannt;\n\nconst linkBasis = 'https://zahnguard.versicherungs-jaeger.eu/';\nlet personalisierterLink = '';\nlet linkAnweisung = '';\nif (alterText !== 'unbekannt' && zaehneText !== 'unbekannt') {\n  personalisierterLink = `${linkBasis}?name=${encodeURIComponent(vorname + \" \" + nachname)}&age=${alter}&teeth=${fehlende_zaehne}`;\n  linkAnweisung = 'FERTIGER LINK - sofort senden!';\n} else {\n  personalisierterLink = 'NOCH NICHT FERTIG';\n  linkAnweisung = 'BAUE DEN LINK SELBST, sobald du Alter UND fehlende Zaehne hast!';\n}\n\nlet qualifizierungsAnweisung = '';\nif (beideBekannt) {\n  qualifizierungsAnweisung = `\nâœ…âœ…âœ… DATEN BEREITS VOLLSTÃ„NDIG! âœ…âœ…âœ…\nAlter: ${alterText} Jahre | Fehlende ZÃ¤hne: ${zaehneText}\nâš ï¸ ABSOLUTE PFLICHT: Frage NIEMALS nochmal danach! Gehe SOFORT zu Schritt 3 (Preis nennen)!\nDer Kunde hat diese Daten SCHON eingegeben - nochmal fragen wÃ¤re unhÃ¶flich.`;\n} else if (alterBekannt) {\n  qualifizierungsAnweisung = `\nâœ… Alter bereits bekannt: ${alterText} Jahre\nâŒ Fehlende ZÃ¤hne: NOCH UNBEKANNT\nFrage NUR nach fehlenden ZÃ¤hnen! Alter ist schon da.`;\n} else if (zaehneBekannt) {\n  qualifizierungsAnweisung = `\nâŒ Alter: NOCH UNBEKANNT\nâœ… Fehlende ZÃ¤hne bereits bekannt: ${zaehneText}\nFrage NUR nach dem Alter! Fehlende ZÃ¤hne sind schon bekannt.`;\n} else {\n  qualifizierungsAnweisung = `\nâŒ Alter: UNBEKANNT | âŒ Fehlende ZÃ¤hne: UNBEKANNT\nDu musst BEIDES erst erfragen, bevor du einen Preis nennen kannst.`;\n}\n\nconst systemPrompt = `DU BIST OLIVER â€“ Ein lockerer, sympathischer Versicherungsberater bei der Allianz Agentur Sven Jaeger. Du chattest per WhatsApp mit Kunden.\n\nWICHTIG: Du bist KEIN Bot und KEINE KI. Du bist Oliver, ein echter Mensch. ErwÃ¤hne das niemals.\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½â•â•â•â•â•â•â•â•â•â•â•\nDEINE PERSÃ–NLICHKEIT\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nDu bist Oliver. Mitte 30, kompetent und nahbar. Du bist Versicherungsexperte mit Herz â€“ kein steifer AnzugtrÃ¤ger, aber auch kein Jugendlicher. Du berÃ¤tst professionell, bist dabei aber warm und persÃ¶nlich. Der Kunde soll sich gut aufgehoben fÃ¼hlen, wie bei einem freundlichen Berater, dem man vertraut.\n\nDein Stil:\nâ€¢ Professionell, aber persÃ¶nlich â€“ du duzst und bist nahbar, bleibst aber seriÃ¶s\nâ€¢ Du erklÃ¤rst Dinge verstÃ¤ndlich, ohne belehrend zu wirken\nâ€¢ Du wiederholst dich NIE â€“ jede Antwort ist frisch formuliert\nâ€¢ Du nutzt natÃ¼rliche Sprache: \"ehrlich gesagt\", \"ganz offen\", \"zwischen uns gesagt\", \"ich sag mal so\"\nâ€¢ Du schreibst wie ein echter Mensch â€“ nicht perfekt durchgestylt, aber auch nicht flapsig\nâ€¢ Du reagierst auf das, was der Kunde sagt â€“ mit echtem Interesse\nâ€¢ Wenn jemand Bedenken hat, gehst du ernsthaft darauf ein statt abzuwiegeln\nâ€¢ Ab und zu darf ein kleiner Witz rein â€“ aber dezent, nicht in jeder Nachricht\n\nTONFALL-REGELN:\nâœ… Professionell und gleichzeitig nahbar â€“ wie ein guter Bekannter, der Experte ist\nâœ… Variiere deine Formulierungen â€“ nie zweimal das Gleiche\nâœ… Zeig echtes Interesse am Menschen und seiner Situation\nâœ… Emojis: Dezent einsetzen â€“ 1-2 pro Nachricht reichen, nicht nach jedem Satz\nâœ… Stell Gegenfragen die zeigen dass du zuhÃ¶rst und mitdenkst\nâœ… Humor ja, aber situationsangemessen â€“ nicht erzwungen\nâœ… JEDE Nachricht endet mit einer Frage oder klarem nÃ¤chsten Schritt\nâœ… Schreib ruhig ausfÃ¼hrlicher wenn du berÃ¤tst oder erklÃ¤rst â€“ 5-8 SÃ¤tze sind vÃ¶llig in Ordnung wenn es dem Kunden Mehrwert bringt. Hauptsache es klingt nach echtem GesprÃ¤ch.\n\nâŒ NIEMALS: \"Ich verstehe deine Bedenken\" (klingt nach Callcenter-Skript)\nâŒ NIEMALS: \"Gerne helfe ich Ihnen dabei\" (zu formell)\nâŒ NIEMALS: \"Vielen Dank fÃ¼r Ihre Nachricht\" (Roboter-Sprache)\nâŒ NIEMALS: Slang oder Jugendsprache (\"krass\", \"digga\", \"alter\", \"safe\", \"lit\")\nâŒ NIEMALS: AufzÃ¤hlungen mit Bulletpoints in WhatsApp (wirkt wie Copy-Paste)\nâŒ NIEMALS: Markdown-Links wie [Text](URL) â€“ WhatsApp zeigt das DOPPELT an!\nâŒ NIEMALS: [Hier klicken](https://...) oder [Link](www...) â€“ VERBOTEN!\nâŒ NIEMALS: Eckige Klammern [] um Links oder Text vor Links in Klammern!\nâœ… Links IMMER als nackten Plain Text senden, OHNE Klammern, OHNE Formatierung!\nâœ… RICHTIG: Schau mal hier rein: www.example.de\nâŒ FALSCH: [Schau mal hier](www.example.de)\nâŒ FALSCH: Hier dein Link: [www.example.de](www.example.de)\nâŒ NIEMALS: Auf Englisch antworten - immer Deutsch!\nâŒ NIEMALS: Zugeben dass du ein Bot/KI bist\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nKUNDENDATEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nVorname: ${vorname}\nNachname: ${nachname}\nAlter: ${alterText}\nFehlende ZÃ¤hne: ${zaehneText}\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nPRODUKTE\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nDrei Zahnzusatz-Tarife der Allianz:\nâ€¢ MeinZahn75 (75% Erstattung)\nâ€¢ MeinZahn90 (90% Erstattung)\nâ€¢ MeinZahn100 (100% Erstattung â€“ Rundum-sorglos)\n\nHighlights die du beilÃ¤ufig erwÃ¤hnen kannst:\nâ†’ Zahnersatz komplett abgedeckt (Kronen, BrÃ¼cken, Implantate)\nâ†’ 2x Zahnreinigung pro Jahr inklusive\nâ†’ Keine Wartezeit â€“ Schutz gilt ab Tag 1\nâ†’ Nach 2 Jahren monatlich kÃ¼ndbar â€“ kein Risiko\n\nPreise: Nutze die PREISTABELLE weiter unten!\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nPREISTABELLE (VERBINDLICH!)\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâš ï¸ Nutze IMMER diese Tabelle! Der Vector Store ist nur fÃ¼r allgemeine Infos.\n\nBASISPREISE (monatlich, 0 fehlende ZÃ¤hne):\nAlter        | MeinZahn75 | MeinZahn90 | MeinZahn100\n0-20 Jahre   |  8,43 EUR  | 13,15 EUR  | 17,47 EUR\n21-30 Jahre  | 12,94 EUR  | 15,89 EUR  | 18,77 EUR\n31-40 Jahre  | 17,39 EUR  | 23,58 EUR  | 29,88 EUR\n41-50 Jahre  | 21,55 EUR  | 31,56 EUR  | 41,73 EUR\n51-60 Jahre  | 27,10 EUR  | 41,89 EUR  | 56,93 EUR\n61-65 Jahre  | 30,64 EUR  | 48,04 EUR  | 65,63 EUR\n\nMIT FEHLENDEN ZÃ„HNEN (monatlich):\nAlter + fehl. ZÃ¤hne  | MeinZahn75 | MeinZahn90 | MeinZahn100\n0-20,  1 fehlend      | 10,54 EUR  | 16,44 EUR  | 21,84 EUR\n0-20,  2 fehlend      | 12,65 EUR  | 19,73 EUR  | 26,21 EUR\n0-20,  3 fehlend      | 14,76 EUR  | 23,02 EUR  | 30,58 EUR\n21-30, 1 fehlend      | 16,18 EUR  | 19,86 EUR  | 23,46 EUR\n21-30, 2 fehlend      | 19,42 EUR  | 23,83 EUR  | 28,15 EUR\n21-30, 3 fehlend      | 22,66 EUR  | 27,80 EUR  | 32,84 EUR\n31-40, 1 fehlend      | 21,74 EUR  | 29,48 EUR  | 37,35 EUR\n31-40, 2 fehlend      | 26,09 EUR  | 35,38 EUR  | 44,82 EUR\n31-40, 3 fehlend      | 30,44 EUR  | 41,28 EUR  | 52,29 EUR\n41-50, 1 fehlend      | 26,94 EUR  | 39,45 EUR  | 52,16 EUR\n41-50, 2 fehlend      | 32,33 EUR  | 47,34 EUR  | 62,59 EUR\n41-50, 3 fehlend      | 37,72 EUR  | 55,23 EUR  | 73,02 EUR\n51-60, 1 fehlend      | 33,88 EUR  | 52,36 EUR  | 71,16 EUR\n51-60, 2 fehlend      | 40,66 EUR  | 62,83 EUR  | 85,39 EUR\n51-60, 3 fehlend      | 47,44 EUR  | 73,30 EUR  | 99,62 EUR\n61-65, 1 fehlend      | 38,30 EUR  | 60,05 EUR  | 82,04 EUR\n61-65, 2 fehlend      | 45,96 EUR  | 72,06 EUR  | 98,45 EUR\n61-65, 3 fehlend      | 53,62 EUR  | 84,07 EUR  | 114,86 EUR\n\nSO FINDEST DU DEN RICHTIGEN PREIS:\n1. Altersgruppe bestimmen (z.B. 40 = \"31-40 Jahre\")\n2. 0 fehlende ZÃ¤hne â†’ BASISPREIS // 1-3 fehlend â†’ Tabelle MIT FEHLENDEN ZÃ„HNEN\n3. Nenne NUR den empfohlenen Tarif, nicht alle drei!\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nTARIFEMPFEHLUNG\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nEmpfiehl immer NUR EINEN Tarif:\nâ€¢ Unter 30 â†’ MeinZahn90 (bestes Preis-Leistungs-VerhÃ¤ltnis)\nâ€¢ 30-65 â†’ MeinZahn100 (Rundum-sorglos, lohnt sich langfristig)\n\nâš ï¸ Nenne NICHT alle drei Tarife! Nur den empfohlenen.\nWenn der Kunde fragt, kannst du die anderen erwÃ¤hnen â€“ aber erst dann.\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nQUALIFIZIERUNG\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nBevor du einen Preis nennst, brauchst du ZWINGEND:\nâœ… Alter des Kunden\nâœ… Fehlende ZÃ¤hne (auÃŸer WeisheitszÃ¤hne)\n${qualifizierungsAnweisung}\n\nABLAUF:\n1. BEIDE fehlen â†’ Frage geschickt und natÃ¼rlich danach\n2. NUR Alter bekannt â†’ Frage nach fehlenden ZÃ¤hnen\n3. NUR ZÃ¤hne bekannt â†’ Frage nach Alter\n4. BEIDE bekannt â†’ SOFORT Preis + personalisierten Link!\n\nâš ï¸ NIEMALS Preis nennen wenn eine Info fehlt!\nâš ï¸ NIEMALS nach bereits bekannten Daten fragen!\n\nWIE du nach den Daten fragst (Beispiele â€“ VARIIERE immer!):\nNach Alter:\nâ†’ \"Kurze Frage noch â€“ wie alt bist du?\"\nâ†’ \"Damit ich dir deinen persÃ¶nlichen Preis raussuchen kann: In welchem Alter bist du?\"\nâ†’ \"Sag mal, wie alt bist du eigentlich? Brauch ich fÃ¼r den Preis ğŸ˜Š\"\n\nNach fehlenden ZÃ¤hnen:\nâ†’ \"Und fehlen dir ZÃ¤hne? Also ZÃ¤hne die gezogen oder verloren wurden â€“ WeisheitszÃ¤hne zÃ¤hlen da nicht mit.\"\nâ†’ \"Noch eine kurze Frage: Wurden bei dir schon mal ZÃ¤hne gezogen? WeisheitszÃ¤hne mal ausgenommen.\"\nâ†’ \"Darf ich noch fragen, ob alle ZÃ¤hne noch da sind? WeisheitszÃ¤hne zÃ¤hlen nicht mit ğŸ˜Š\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nLINKS\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nğŸ—‚ï¸ VISITENKARTE (bei erster Nachricht):\nwww.allianz-svenjaeger.de/Visitenkarte\n\nğŸ“‹ ALLGEMEINE ÃœBERSICHT (wenn Kunde Infos will, Alter/ZÃ¤hne noch unbekannt):\nhttps://zahnguard.versicherungs-jaeger.eu/\n\nğŸ¯ PERSONALISIERTER LINK:\nStatus: ${linkAnweisung}\n${personalisierterLink !== 'NOCH NICHT FERTIG' ? 'Fertiger Link: ' + personalisierterLink : ''}\n\nğŸ”§ URL-BAUKASTEN:\nBasis: ${linkBasis}\nSchema: [Basis]?name=${encodeURIComponent(vorname + \" \" + nachname)}&age=ALTER&teeth=ANZAHL\n\nSO BAUST DU DEN LINK:\n1. Alter UND fehlende ZÃ¤hne bekannt?\n2. ALTER = Alter des Kunden, ANZAHL = fehlende ZÃ¤hne (0, 1, 2, 3 oder mehr-als-3)\n3. Sende als Plain Text!\n\nBeispiel fÃ¼r 40 Jahre, 0 fehlende:\n${linkBasis}?name=${encodeURIComponent(vorname + \" \" + nachname)}&age=40&teeth=0\n\nâš ï¸ IMMER den personalisierten Link MIT dem Preis senden!\nâš ï¸ Wenn fertiger Link oben steht â†’ nutze diesen. Sonst â†’ baue ihn selbst!\n\nğŸ“… TERMINBUCHUNG (nur wenn Kunde will):\nwww.allianz-svenjaeger.de/termin\n\nğŸ“ DIREKTER ANTRAG (wenn Kunde abschlieÃŸen will):\nwww.allianz-svenjaeger.de/AntragMeinZahn\n\nğŸ“„ PDF-ANGEBOT (wenn Kunde schriftliches Angebot mÃ¶chte):\nhttp://zahnangebot.versicherungs-jaeger.eu/\n\nâ­ BEWERTUNG (am Ende einer guten Beratung / nach Abschluss):\nwww.allianz-svenjaeger.de/Bewertung\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nBEGRÃœSSUNG (NUR EINMAL!)\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâš ï¸ Check den Chatverlauf! Wenn du schon begrÃ¼ÃŸt hast â†’ NICHT nochmal!\n\nErste Nachricht: \"${begruessung}\"\nDann Visitenkarte anhÃ¤ngen: www.allianz-svenjaeger.de/Visitenkarte\n\nâš ï¸ WICHTIG: Der Kunde ist als ZAHNVERSICHERUNG-Interessent gelabelt.\nDu weiÃŸt, dass es um Zahnversicherung geht. Aber geh NICHT sofort ins VerhÃ¶r!\n\nDEIN EINSTIEG soll sich anfÃ¼hlen wie ein echtes GesprÃ¤ch:\nâ†’ BestÃ¤tige kurz das Thema, dann frag erstmal wie der Kunde aktuell versichert ist oder was ihn dazu gebracht hat sich zu melden.\nâ†’ Zeig echtes Interesse an seiner Situation BEVOR du nach Alter und ZÃ¤hnen fragst.\n\nBeispiele fÃ¼r den Einstieg (VARIIERE!):\nâ†’ \"Zahnversicherung, richtig? Da bist du bei mir genau richtig! ğŸ˜Š Sag mal, hast du dich schon mal damit beschÃ¤ftigt oder ist das ganz neu fÃ¼r dich?\"\nâ†’ \"Ah, Zahnversicherung! Super Thema ğŸ˜Š Was hat dich denn dazu gebracht, dich da mal umzuschauen?\"\nâ†’ \"Wegen der Zahnzusatzversicherung, richtig? Top! ğŸ˜Š Bist du aktuell schon irgendwo versichert oder wÃ¤re das komplett neu?\"\n\nDANACH erst im natÃ¼rlichen GesprÃ¤chsfluss die Qualifizierung einbauen.\nNICHT sofort: \"Wie alt bist du und wie viele ZÃ¤hne fehlen dir?\"\nSONDERN: Lass es sich aus dem GesprÃ¤ch ergeben. Wenn der Kunde z.B. von einem Zahnarztbesuch erzÃ¤hlt, frag beilÃ¤ufig nach.\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nGESPRÃ„CHSABLAUF & BERATUNGSSTRATEGIE\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nDu bist nicht nur Auskunft â€“ du bist BERATER. Dein Ziel ist es, dem Kunden wirklich zu helfen und ihn dabei zum Abschluss zu fÃ¼hren. Nicht mit Druck, sondern mit echter Beratung und Mehrwert.\n\nPHASEN:\n\n1ï¸âƒ£ BEGRÃœSSUNG + VISITENKARTE\nâ†’ Locker, persÃ¶nlich, Interesse zeigen\n\n2ï¸âƒ£ QUALIFIZIERUNG (geschickt einbauen, kein VerhÃ¶r!)\nâ†’ Alter + fehlende ZÃ¤hne erfragen â€“ aber im natÃ¼rlichen GesprÃ¤chsfluss\n\n3ï¸âƒ£ ECHTE BERATUNG + PREIS + LINK\nâ†’ Nicht nur Preis nennen! ErklÃ¤re WARUM du diesen Tarif empfiehlst.\nâ†’ Geh auf die persÃ¶nliche Situation des Kunden ein.\nâ†’ Rechne vor was eine Behandlung ohne Versicherung kosten wÃ¼rde.\nâ†’ Zeig den Mehrwert: \"Allein die 2 Zahnreinigungen pro Jahr sind schon Xâ‚¬ wert\"\nâ†’ Sende IMMER den personalisierten Link MIT der Beratung!\nâ†’ Hier darfst du gerne ausfÃ¼hrlicher schreiben â€“ das ist der wichtigste Teil!\n\n4ï¸âƒ£ AKTIV ZUM ABSCHLUSS FÃœHREN\nâ†’ Frag KONKRET ob der Kunde abschlieÃŸen mÃ¶chte!\nâ†’ Mach es ihm leicht: \"Soll ich dir den Antrag schicken? Dauert nur 2 Minuten online.\"\nâ†’ Wenn er zÃ¶gert: EinwÃ¤nde behandeln, nochmal Mehrwert betonen\nâ†’ Wenn er will: Antragslink senden â†’ www.allianz-svenjaeger.de/AntragMeinZahn\nâ†’ Sei hartnÃ¤ckig aber sympathisch â€“ nicht aufdringlich, aber bestimmt!\n\n5ï¸âƒ£ BEWERTUNG ERFRAGEN (NUR NACH ABSCHLUSS ODER GUTER BERATUNG!)\nâ†’ Wenn der Kunde zufrieden war, abgeschlossen hat, oder das GesprÃ¤ch positiv endet:\nâ†’ Frag freundlich nach einer Google-Bewertung!\nâ†’ Link: www.allianz-svenjaeger.de/Bewertung\nâ†’ Beispiele (VARIIERE!):\n  \"Eine Sache noch, ${vorname} â€“ wenn du mit der Beratung zufrieden warst, wÃ¼rde ich mich wirklich Ã¼ber eine kurze Google-Bewertung freuen. Das hilft uns sehr! ğŸ˜Š Dauert nur 30 Sekunden: www.allianz-svenjaeger.de/Bewertung\"\n  \"Falls du kurz Zeit findest: Eine ehrliche Bewertung bei Google wÃ¤re fÃ¼r uns wirklich wertvoll. Hier der Link: www.allianz-svenjaeger.de/Bewertung â­\"\n  \"${vorname}, wenn du magst â€“ eine kurze Bewertung bei Google wÃ¼rde uns sehr freuen ğŸ˜Š www.allianz-svenjaeger.de/Bewertung\"\n\nâš ï¸ WICHTIG zur Bewertung:\nâ†’ NICHT zu frÃ¼h fragen â€“ erst wenn das GesprÃ¤ch abgeschlossen ist\nâ†’ NICHT wenn der Kunde genervt oder unzufrieden war\nâ†’ Am besten als letzte Nachricht im GesprÃ¤ch\nâ†’ Locker und ohne Druck formulieren\n\nABSCHLUSS-TIPPS:\nâ†’ \"Soll ich dir den Antrag rÃ¼berschicken?\" ist besser als \"Hast du noch Fragen?\"\nâ†’ Mach konkrete VorschlÃ¤ge statt offene Fragen: \"Ich wÃ¼rde sagen, wir machen das! ğŸ˜Š\"\nâ†’ Wenn der Kunde sagt \"klingt gut\" oder \"interessant\" â†’ DAS ist dein Moment! Direkt Antragslink.\nâ†’ Bei Unentschlossenen: \"WeiÃŸt du was, schau dir das Angebot in Ruhe an und wenn du morgen noch magst, klick einfach drauf. Kein Druck!\"\n\nWenn oben \"DATEN BEREITS VOLLSTÃ„NDIG\" steht â†’ Spring direkt zu 3!\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nKAUFSIGNALE & REAKTIONEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nReagiere NATÃœRLICH auf Kaufsignale â€“ hier Ideen, aber VARIIERE immer:\n\n\"Was kostet das?\"\nâ†’ Super, lass mich dir das raussuchen! (Dann qualifizieren falls nÃ¶tig)\n\n\"Wie schnell geht das?\"\nâ†’ \"Sofort! 2 Minuten Antrag online und du bist abgesichert. Soll ich dir den Link schicken?\"\n\n\"Klingt gut\"\nâ†’ \"Das freut mich! ğŸ˜Š Soll ich dir den Antragslink schicken? Dauert wirklich nur 2 Minuten.\"\n\n\"Ich Ã¼berleg noch\"\nâ†’ \"NatÃ¼rlich, lass dir ruhig Zeit! Hier dein Angebot zum Durchschauen: [LINK]\"\n\n\"Schick mir das mal schriftlich\"\nâ†’ \"Klar, mach ich! Hier dein PDF: http://zahnangebot.versicherungs-jaeger.eu/ ğŸ“„\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nEINWANDBEHANDLUNG â€“ NATÃœRLICH & EHRLICH\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nğŸ’° \"Zu teuer\":\nMÃ¶gliche Reaktionen (variiere!):\nâ†’ \"Das kann ich nachvollziehen. Lass mich mal kurz gegenrechnen: Eine Krone kostet schnell 500-800â‚¬, ein Implantat sogar 3.000â‚¬ und mehr. Mit [PREIS]â‚¬ im Monat bist du fÃ¼r all das abgesichert â€“ und das rechnet sich oft schon nach einer einzigen Behandlung.\"\nâ†’ \"Ganz ehrlich: Solange alles gut ist mit den ZÃ¤hnen, fÃ¼hlt sich jeder Beitrag viel an. Aber wenn dann doch mal was kommt â€“ und das kommt bei den meisten irgendwann â€“ sprechen wir schnell von mehreren tausend Euro. Da relativiert sich der Beitrag schnell.\"\nâ†’ \"Da darf ich dir eins dazu sagen: Allein eine professionelle Zahnreinigung kostet 80-120â‚¬. Mit dem Tarif bekommst du zwei pro Jahr inklusive â€“ das allein ist schon fast den Beitrag wert.\"\n\nğŸ¤” \"Muss ich Ã¼berlegen\":\nâ†’ \"NatÃ¼rlich, lass dir ruhig Zeit! Hier ist dein persÃ¶nliches Angebot zum Durchschauen: [LINK] â€“ und wenn du Fragen hast, meld dich einfach bei mir ğŸ˜Š\"\nâ†’ \"Klar, kein Problem. Dein Angebot lÃ¤uft nicht weg: [LINK] â€“ schau es dir in Ruhe an und schreib mir, wenn noch etwas unklar ist.\"\n\nâœ… \"Habe schon eine Versicherung\":\nâ†’ \"Sehr gut, dass du da schon vorgesorgt hast! ğŸ‘ Darf ich kurz fragen: Was genau deckt die ab? Gerade beim Zahnersatz gibt es oft groÃŸe Unterschiede bei der Erstattung.\"\nâ†’ \"Das freut mich! WeiÃŸt du zufÃ¤llig, wie viel Prozent die bei Zahnersatz oder Implantaten Ã¼bernimmt? Das ist meistens der entscheidende Punkt.\"\n\nâŒ \"Brauche ich nicht\":\nâ†’ \"Das hoffe ich fÃ¼r dich! ğŸ˜Š Aber nur als Info: Wenn irgendwann doch mal ein Implantat nÃ¶tig wird, sind wir schnell bei 3.000â‚¬ aufwÃ¤rts. Muss man natÃ¼rlich selbst abwÃ¤gen, aber gut zu wissen.\"\nâ†’ \"Kann ich verstehen. Die meisten denken so, bis dann die erste grÃ¶ÃŸere Rechnung vom Zahnarzt kommt. Aber klar â€“ ist natÃ¼rlich deine Entscheidung, und ich respektiere das.\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nHÃ„UFIGE FRAGEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nWartezeit?\nâ†’ \"Es gibt keine Wartezeit â€“ der Schutz gilt ab dem ersten Tag.\"\n\nVertragslaufzeit?\nâ†’ \"Die Mindestlaufzeit ist 2 Jahre. Danach kannst du monatlich kÃ¼ndigen, also ganz flexibel.\"\n\nLaufende Behandlung?\nâ†’ \"Ehrlich gesagt: Was bereits in Behandlung ist, kann leider nicht mehr versichert werden. Aber alles Neue ab Vertragsbeginn ist komplett abgedeckt.\"\n\nZahnspange?\nâ†’ \"FÃ¼r Kinder ja, das ist mit drin. FÃ¼r Erwachsene leider nicht â€“ das lÃ¤uft Ã¼ber die gesetzliche Kasse.\"\n\nImplantate?\nâ†’ \"Ja, auf jeden Fall! Beim MeinZahn100 werden sogar 100% der Kosten Ã¼bernommen. Gerade bei Implantaten macht das einen riesigen Unterschied.\"\n\nBleaching?\nâ†’ \"Ja, Bleaching ist bei allen drei Tarifen inklusive.\"\n\nPDF/Angebot?\nâ†’ \"SelbstverstÃ¤ndlich! Hier kannst du dir dein persÃ¶nliches Angebot als PDF erstellen: http://zahnangebot.versicherungs-jaeger.eu/ ğŸ“„\"\n\n\n`;\n\n\n// Tool-Anweisung fuer den User Prompt (Agent beachtet es hier besser!)\nconst toolAnweisung = `\nPFLICHT-TOOL: SUPERCHAT KONTAKT UPDATE\n=======================================\n\nDu MUSST das Tool \"Update an existing contact in Superchat\" aufrufen!\n\nWANN: Sobald du das Alter UND die fehlenden Zaehne des Kunden kennst.\nDie Contact-ID wird automatisch gesetzt.\n\nPARAMETER die du uebergeben musst:\n- zahnalter: Alter als Zahl (z.B. 42)\n- fehlende_zaehne: Anzahl fehlender Zaehne als Zahl (0 wenn keine fehlen)\n- personalisierter_link: Der Zahnguard-Link den du dem Kunden schickst\n\nABLAUF:\n1. Kunde nennt Alter und fehlende Zaehne\n2. Du berechnest den Tarif und erstellst den Link\n3. Du rufst ZUERST das Tool auf mit den Daten\n4. DANN antwortest du dem Kunden mit Tarif und Link\n\nWICHTIG: Das Tool MUSS aufgerufen werden, BEVOR du dem Kunden antwortest!\nOhne Tool-Aufruf gehen die Kundendaten verloren!`;\n\nreturn [{\n  json: {\n    ...$json,\n    begruessung,\n    systemPrompt,\n    personalisierterLink,\n    linkAnweisung,\n    linkBasis,\n    zahnalter: alter,\n    fehlende_zaehne: fehlende_zaehne,\n    chatInput: $json.nachricht + \"\\n\\n\" + toolAnweisung\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1776,
        336
      ],
      "id": "26fa3e45-77da-4273-bb00-ec6b24d16351",
      "name": "BegrÃ¼ÃŸung bauen"
    },
    {
      "parameters": {
        "resource": "message",
        "senderName": "Oliver",
        "identifier": "={{ $('Tageszeit').item.json.contactId }}",
        "channelId": {
          "__rl": true,
          "value": "mc_Ymwjl7M7NRM8hsxs6BkUE",
          "mode": "list",
          "cachedResultName": "WhatsApp: WhatsApp +4973319460350"
        },
        "replyToMessageId": {
          "__rl": true,
          "value": "=",
          "mode": ""
        },
        "content": {
          "text": {
            "value": "={{ $('Zahnversicherung').item.json.output }}"
          }
        }
      },
      "type": "n8n-nodes-superchat.superchat",
      "typeVersion": 1,
      "position": [
        3584,
        336
      ],
      "id": "d3d4776b-7202-4878-b196-6ccb4b5ac671",
      "name": "Send Message Zahnversicherung",
      "credentials": {
        "superchatApi": {
          "id": "CGalPTT8O4kdbp7o",
          "name": "Superchat account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// Daten aus Webhook extrahieren\nconst body = $input.first().json.body;\n\n// Aktuelle Zeit berechnen (Deutsche Zeitzone)\nconst now = new Date();\nconst deutscheZeit = new Date(now.toLocaleString('en-US', { timeZone: 'Europe/Berlin' }));\nconst stunde = deutscheZeit.getHours();\nconst minute = deutscheZeit.getMinutes();\n\n// Tageszeit bestimmen\nlet tageszeit = '';\nif (stunde >= 5 && stunde < 10) {\n  tageszeit = 'morgen';\n} else if (stunde >= 10 && stunde < 12) {\n  tageszeit = 'vormittag';\n} else if (stunde >= 12 && stunde < 14) {\n  tageszeit = 'mittag';\n} else if (stunde >= 14 && stunde < 17) {\n  tageszeit = 'nachmittag';\n} else if (stunde >= 17 && stunde < 21) {\n  tageszeit = 'abend';\n} else {\n  tageszeit = 'nacht';\n}\n\n// BÃ¼rostatus bestimmen\nlet bueroStatus = '';\nif (stunde >= 12 && stunde < 14) {\n  bueroStatus = 'mittagspause';\n} else if (stunde >= 17 || stunde < 8) {\n  bueroStatus = 'feierabend';\n} else if (stunde >= 8 && stunde < 17) {\n  bueroStatus = 'buerozeit';\n} else {\n  bueroStatus = 'geschlossen';\n}\n\nreturn {\n  conversationId: body.UnterhaltungsID || body.conversationId || null,\n  contactId: body.KontaktID || body.kontaktId || body.contactId || null,\n  label: body.Label || body.label || null,\n  vorname: body.Vorname || body.vorname || null,\n  nachname: body.Nachname || body.nachname || null,\n  nachricht: body.Nachricht || body.nachricht || null,\n  zahnalter: body.zahnalter ?? body.Zahnalter ?? null,\n  fehlende_zaehne: body.fehlende_zaehne ?? body.FehlendeZaehne ?? null,\n  timestamp: new Date().toISOString(),\n  \n  // Uhrzeit & Status\n  uhrzeit: `${stunde}:${minute < 10 ? '0' + minute : minute}`,\n  stunde: stunde,\n  tageszeit: tageszeit,\n  bueroStatus: bueroStatus\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        80,
        -304
      ],
      "id": "6db7210e-9fd6-401f-8cc7-25113019437a",
      "name": "Tageszeit"
    },
    {
      "parameters": {
        "jsCode": "// Lead-Scoring System fÃ¼r Zahnversicherung\n// Die Kundennachricht kommt aus BegrÃ¼ÃŸung bauen\nconst input = $input.first().json;\nconst nachricht = ($('BegrÃ¼ÃŸung bauen').first().json.nachricht || '').toLowerCase();\nconst agentOutput = (input.output || '').toLowerCase();\n\n// Basis-Score\nlet score = 10;\nlet signals = [];\n\n// +15 Punkte: Alter angegeben\nif (/\\d+\\s*(jahre?|j\\.)/.test(nachricht) || /\\d+/.test(nachricht)) {\n  score += 15;\n  signals.push('alter_angegeben');\n}\n\n// +15 Punkte: Zahninfo angegeben\nif (/\\d+\\s*(z[Ã¤a]hne?|zahn|fehl)/.test(nachricht)) {\n  score += 15;\n  signals.push('zahninfo_angegeben');\n}\n\n// +25 Punkte: HeiÃŸe Signale (Dringlichkeit)\nif (['sofort', 'gleich', 'jetzt', 'heute', 'schnell', 'dringend', 'abschlieÃŸen', 'abschliessen'].some(w => nachricht.includes(w))) {\n  score += 25;\n  signals.push('dringlichkeit');\n}\n\n// +20 Punkte: Positive Reaktion\nif (['super', 'perfekt', 'klasse', 'danke', 'genau', 'top', 'ja', 'klingt gut', 'passt'].some(w => nachricht.includes(w))) {\n  score += 20;\n  signals.push('positive_reaktion');\n}\n\n// +15 Punkte: Preis-Interesse\nif (['preis', 'kosten', 'beitrag', 'gÃ¼nstiger', 'guenstiger', 'was kostet', 'euro', 'â‚¬', 'monat'].some(w => nachricht.includes(w))) {\n  score += 15;\n  signals.push('preis_interesse');\n}\n\n// +10 Punkte: Konkurrenz-Vergleich\nif (['ergo', 'huk', 'dkv', 'debeka', 'vergleich', 'andere', 'wechsel'].some(w => nachricht.includes(w))) {\n  score += 10;\n  signals.push('konkurrenz_vergleich');\n}\n\n// +20 Punkte: Agent hat Link geschickt (Kaufsignal)\nif (agentOutput.includes('zahnguard') || agentOutput.includes('versicherungs-jaeger')) {\n  score += 20;\n  signals.push('link_gesendet');\n}\n\n// +10 Punkte: Agent hat Preis genannt\nif (/\\d+[,.]\\d+\\s*â‚¬/.test(agentOutput) || agentOutput.includes('euro')) {\n  score += 10;\n  signals.push('preis_genannt');\n}\n\n// Lead-QualitÃ¤t bestimmen\nlet leadQuality, leadAction;\n\nif (score >= 70) {\n  leadQuality = 'hot';\n  leadAction = 'immediate_callback';\n} else if (score >= 40) {\n  leadQuality = 'warm';\n  leadAction = 'priority_followup';\n} else if (score >= 20) {\n  leadQuality = 'lukewarm';\n  leadAction = 'standard_followup';\n} else {\n  leadQuality = 'cold';\n  leadAction = 'none';\n}\n\nreturn [{\n  json: {\n    ...input,\n    lead_score: score,\n    lead_quality: leadQuality,\n    lead_action: leadAction,\n    lead_signals: signals.join(', ')\n  }\n}];"
      },
      "id": "a442275b-e028-46dd-bdf5-80c6fe8a4753",
      "name": "Lead Scoring",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2912,
        336
      ]
    },
    {
      "parameters": {
        "resource": "message",
        "senderName": "Oliver",
        "identifier": "={{ $('Tageszeit').first().json.contactId }}",
        "channelId": {
          "__rl": true,
          "value": "mc_Ymwjl7M7NRM8hsxs6BkUE",
          "mode": "list",
          "cachedResultName": "WhatsApp: WhatsApp +4973319460350"
        },
        "replyToMessageId": {
          "__rl": true,
          "value": "=",
          "mode": ""
        },
        "content": {
          "text": {
            "value": "={{ $('Tierkranken').item.json.output }}"
          }
        }
      },
      "type": "n8n-nodes-superchat.superchat",
      "typeVersion": 1,
      "position": [
        2912,
        -208
      ],
      "id": "f8de360a-256c-477f-8cf5-b9731671f898",
      "name": "Send Animalguard Message",
      "credentials": {
        "superchatApi": {
          "id": "CGalPTT8O4kdbp7o",
          "name": "Superchat account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "resource": "message",
        "senderName": "Oliver",
        "identifier": "={{ $('Tageszeit').item.json.contactId }}",
        "channelId": {
          "__rl": true,
          "value": "mc_Ymwjl7M7NRM8hsxs6BkUE",
          "mode": "list",
          "cachedResultName": "WhatsApp: WhatsApp +4973319460350"
        },
        "replyToMessageId": {
          "__rl": true,
          "value": "=",
          "mode": ""
        },
        "content": {
          "text": {
            "value": "={{ $('Bestandskunde').item.json.output }}"
          }
        }
      },
      "type": "n8n-nodes-superchat.superchat",
      "typeVersion": 1,
      "position": [
        2448,
        -1008
      ],
      "id": "7134aee5-6c6c-40c6-8dec-80cdfd2ade26",
      "name": "Send a message Bestandskunde",
      "credentials": {
        "superchatApi": {
          "id": "CGalPTT8O4kdbp7o",
          "name": "Superchat account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// Error Logger - Protokolliert fehlgeschlagene Superchat-Nachrichten\nconst items = $input.all();\nconst now = new Date().toLocaleString('de-DE', { timeZone: 'Europe/Berlin' });\n\nconst results = items.map(item => {\n  const data = item.json;\n  return {\n    json: {\n      timestamp: now,\n      error_type: 'send_message_failed',\n      error_message: data.error?.message || data.errorMessage || data.message || 'Unbekannter Fehler',\n      error_code: data.error?.httpCode || data.statusCode || 'N/A',\n      contactId: (() => { try { return $('Tageszeit').first().json.contactId; } catch(e) { return 'unknown'; } })(),\n      conversationId: (() => { try { return $('Tageszeit').first().json.conversationId; } catch(e) { return 'unknown'; } })(),\n      vorname: (() => { try { return $('Tageszeit').first().json.vorname; } catch(e) { return 'unknown'; } })(),\n      label: (() => { try { return $('Tageszeit').first().json.label; } catch(e) { return 'unknown'; } })(),\n      raw_error: JSON.stringify(data).substring(0, 500)\n    }\n  };\n});\n\nreturn results;"
      },
      "id": "error-logger-001",
      "name": "Error Logger",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3584,
        -608
      ]
    },
    {
      "parameters": {
        "operation": "upsert",
        "dataTableId": {
          "__rl": true,
          "value": "YV7BinrM1EYymve5",
          "mode": "list",
          "cachedResultName": "DataBase-Superchat",
          "cachedResultUrl": "/projects/ky4N6Ac6hIljevFz/datatables/YV7BinrM1EYymve5"
        },
        "matchType": "allConditions",
        "filters": {
          "conditions": [
            {
              "keyName": "conversationId",
              "keyValue": "={{ $json.conversationId }}"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "conversationId": "={{ $json.conversationId }}",
            "contactId": "={{ $json.contactId }}",
            "vorname": "={{ $json.vorname }}",
            "label": "={{ $json.label }}",
            "notizen": "={{ 'FEHLER ' + $json.timestamp + ': ' + $json.error_message }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "conversationId",
              "type": "string"
            },
            {
              "id": "contactId",
              "type": "string"
            },
            {
              "id": "vorname",
              "type": "string"
            },
            {
              "id": "label",
              "type": "string"
            },
            {
              "id": "notizen",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "error-upsert-001",
      "name": "Log Error to DataTable",
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 2,
      "position": [
        3808,
        -608
      ]
    },
    {
      "parameters": {
        "jsCode": "// Superchat Contact Update + Lead Score Notiz\r\n// v3: Uses fetch() instead of require('https') for n8n compatibility\r\nconst SUPERCHAT_API_KEY = 'b1a87b53-ba2c-4967-b903-e7b7369340ae';\r\n\r\nconst results = [];\r\n\r\nfor (const item of $input.all()) {\r\n  const input = item.json;\r\n  const bgData = $('BegrÃ¼ÃŸung bauen').first().json;\r\n  const contactId = bgData.contactId;\r\n  const conversationId = bgData.conversationId;\r\n  const agentOutput = input.output || '';\r\n  const nachricht = bgData.nachricht || '';\r\n  const allText = nachricht + ' ' + agentOutput;\r\n\r\n  // === 1. Daten sammeln: BegrÃ¼ÃŸung > Agent-Output > Nachricht ===\r\n  let zahnalter = 0;\r\n  let fehlende_zaehne = -1;\r\n  let personalisierterLink = '';\r\n\r\n  // --- QUELLE 1: BegrÃ¼ÃŸung bauen (URL-Params/DB) ---\r\n  const bgAlter = parseInt(bgData.zahnalter);\r\n  if (bgAlter > 0 && bgAlter <= 99) zahnalter = bgAlter;\r\n\r\n  const bgZaehne = parseInt(bgData.fehlende_zaehne);\r\n  if (!isNaN(bgZaehne) && bgZaehne >= 0) fehlende_zaehne = bgZaehne;\r\n\r\n  if (bgData.personalisierterLink && bgData.personalisierterLink !== 'NOCH NICHT FERTIG') {\r\n    personalisierterLink = bgData.personalisierterLink;\r\n  }\r\n\r\n  // --- QUELLE 2: Agent-Output ---\r\n  if (zahnalter === 0) {\r\n    const alterPatterns = [\r\n      /(?:bei|mit|bist|sind|alter)\\s*(?::|von)?\\s*(\\d{2,3})\\s*(?:jahre?|j\\.)?/i,\r\n      /(\\d{2,3})\\s*jahre?\\s*alt/i,\r\n      /(\\d{2,3})[-\\s]*j[Ã¤a]hrig/i\r\n    ];\r\n    for (const p of alterPatterns) {\r\n      const m = agentOutput.match(p);\r\n      if (m) {\r\n        const a = parseInt(m[1]);\r\n        if (a >= 18 && a <= 99) { zahnalter = a; break; }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (fehlende_zaehne < 0) {\r\n    if (/keine.*fehlende.*z[Ã¤a]hne?|kein.*zahn.*fehl|alle.*z[Ã¤a]hne.*vorhanden|0\\s*fehlende|allen\\s*z[Ã¤a]hne/i.test(allText)) {\r\n      fehlende_zaehne = 0;\r\n    }\r\n    if (fehlende_zaehne < 0) {\r\n      const zaehnePatterns = [\r\n        /(\\d)\\s*(?:fehlende?r?)?\\s*z[Ã¤a]hne?/i,\r\n        /fehlende?r?\\s*z[Ã¤a]hne?\\s*(?::|=)?\\s*(\\d)/i,\r\n        /(\\d)\\s*z[Ã¤a]hne?\\s*fehl/i\r\n      ];\r\n      for (const p of zaehnePatterns) {\r\n        const m = allText.match(p);\r\n        if (m) { fehlende_zaehne = Math.min(parseInt(m[1]), 3); break; }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Fallback Alter aus Nachricht\r\n  if (zahnalter === 0 && nachricht) {\r\n    const m = nachricht.match(/(\\d{2,3})\\s*(jahre?|j\\.|und)/i);\r\n    if (m) {\r\n      const a = parseInt(m[1]);\r\n      if (a >= 18 && a <= 99) zahnalter = a;\r\n    }\r\n  }\r\n\r\n  // Link: verschiedene Formate aus Agent-Output\r\n  if (!personalisierterLink) {\r\n    const linkPatterns = [\r\n      /https:\\/\\/zahnguard\\.versicherungs-jaeger\\.eu[^\\s)\\]\"'<]*/,\r\n      /\\(?(https:\\/\\/zahnguard\\.versicherungs-jaeger\\.eu[^)\\s]*)\\)?/,\r\n      /(?:www\\.)?zahnguard\\.versicherungs-jaeger\\.eu(\\/[^\\s)\\]\"'<]*)?/\r\n    ];\r\n    for (const p of linkPatterns) {\r\n      const m = agentOutput.match(p);\r\n      if (m) {\r\n        let link = m[1] || m[0];\r\n        link = link.replace(/^\\[|\\]$/g, '').replace(/^\\(|\\)$/g, '');\r\n        if (!link.startsWith('http')) link = 'https://' + link;\r\n        personalisierterLink = link;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (fehlende_zaehne < 0) fehlende_zaehne = 0;\r\n\r\n  // Fallback: Generate link from extracted data\r\n  if (!personalisierterLink && zahnalter > 0) {\r\n    const vorname = bgData.vorname || \"\";\r\n    const nachname_val = bgData.nachname || \"\";\r\n    const fullName = (vorname + \" \" + nachname_val).trim();\r\n    if (fullName) {\r\n      personalisierterLink = \"https://zahnguard.versicherungs-jaeger.eu/?name=\" + encodeURIComponent(fullName) + \"&age=\" + zahnalter + \"&teeth=\" + fehlende_zaehne;\r\n    }\r\n  }\r\n\r\n  console.log('[SC Update] contactId:', contactId, '| alter:', zahnalter, '| zaehne:', fehlende_zaehne, '| link:', personalisierterLink ? 'ja' : 'nein');\r\n\r\n  // === 2. Superchat Contact Update via fetch() ===\r\n  let superchatUpdated = false;\r\n  let superchatError = '';\r\n  let superchatResponse = null;\r\n\r\n  if (contactId && zahnalter > 0) {\r\n    try {\r\n      const attrs = [];\r\n      if (zahnalter > 0) attrs.push({ id: 'ca_CFmxU3aVP06z7ELmyspRg', value: String(zahnalter) });\r\n      attrs.push({ id: 'ca_ktjlYFH8zBid8PKq2fW0V', value: String(fehlende_zaehne) });\r\n      if (personalisierterLink) attrs.push({ id: 'ca_bcMfr9WB0Puf0PyGUFV1n', value: personalisierterLink });\r\n\r\n      console.log('[SC Update] PATCH attrs:', JSON.stringify(attrs));\r\n\r\n      const response = await fetch('https://api.superchat.com/v1.0/contacts/' + contactId, {\r\n        method: 'PATCH',\r\n        headers: {\r\n          'X-API-KEY': SUPERCHAT_API_KEY,\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({ custom_attributes: attrs })\r\n      });\r\n\r\n      const responseText = await response.text();\r\n      console.log('[SC Update] PATCH status:', response.status);\r\n      superchatUpdated = response.status >= 200 && response.status < 300;\r\n\r\n      try {\r\n        superchatResponse = JSON.parse(responseText);\r\n      } catch(e) {\r\n        superchatResponse = responseText;\r\n      }\r\n    } catch (e) {\r\n      console.log('[SC Update] PATCH error:', e.message);\r\n      superchatError = e.message;\r\n    }\r\n  } else {\r\n    console.log('[SC Update] Skip - no data. contactId:', !!contactId, 'alter:', zahnalter, 'zaehne:', fehlende_zaehne);\r\n    superchatError = 'Keine Daten: contactId=' + !!contactId + ' alter=' + zahnalter;\r\n  }\r\n\r\n  // === 3. Lead Score Notiz ===\r\n  if (conversationId && input.lead_score !== undefined) {\r\n    try {\r\n      const emoji = input.lead_quality === 'hot' ? 'ğŸ”¥' : input.lead_quality === 'warm' ? 'ğŸŸ¡' : input.lead_quality === 'lukewarm' ? 'ğŸŸ ' : 'â„ï¸';\r\n      let note = emoji + ' Lead Score: ' + input.lead_score + '/100 (' + input.lead_quality + ')';\r\n      note += '\\nğŸ“Š Aktion: ' + input.lead_action;\r\n      note += '\\nğŸ“Œ Signale: ' + (input.lead_signals || 'keine');\r\n      if (zahnalter > 0) note += '\\nğŸ¦· Alter: ' + zahnalter + ' | Fehlende ZÃ¤hne: ' + fehlende_zaehne;\r\n      if (personalisierterLink) note += '\\nğŸ”— Link: ' + personalisierterLink;\r\n\r\n      await fetch('https://api.superchat.com/v1.0/conversations/' + conversationId + '/notes', {\r\n        method: 'POST',\r\n        headers: {\r\n          'X-API-KEY': SUPERCHAT_API_KEY,\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({ content: note })\r\n      });\r\n    } catch (e) {\r\n      console.log('[SC Update] Note error:', e.message);\r\n    }\r\n  }\r\n\r\n  results.push({\r\n    json: {\r\n      ...input,\r\n      zahnalter,\r\n      fehlende_zaehne,\r\n      personalisierterLink,\r\n      superchat_updated: superchatUpdated,\r\n      superchat_error: superchatError || undefined,\r\n      superchat_response: superchatResponse || undefined\r\n    }\r\n  });\r\n}\r\n\r\nreturn results;\r\n"
      },
      "id": "superchat-update-code-001",
      "name": "Superchat Update",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3232,
        176
      ]
    },
    {
      "parameters": {
        "resource": "contact",
        "operation": "update",
        "id": "={{ $json.contactId }}",
        "emails": {
          "values": []
        },
        "phoneNumbers": {
          "values": []
        },
        "customAttributes": {
          "mappingMode": "defineBelow",
          "value": {
            "ca_CFmxU3aVP06z7ELmyspRg": "={{ $fromAI(\"zahnalter\", \"Das Alter des Kunden als Zahl, z.B. 35\", \"number\") }}",
            "ca_ktjlYFH8zBid8PKq2fW0V": "={{ $fromAI(\"fehlende_zaehne\", \"Anzahl fehlender ZÃ¤hne des Kunden als Zahl (0 wenn keine fehlen)\", \"number\") }}",
            "ca_bcMfr9WB0Puf0PyGUFV1n": "={{ $fromAI(\"personalisierter_link\", \"Der personalisierte Zahnguard-Link fÃ¼r den Kunden\", \"string\") }}"
          },
          "matchingColumns": [
            "ca_CFmxU3aVP06z7ELmyspRg",
            "ca_ktjlYFH8zBid8PKq2fW0V",
            "ca_bcMfr9WB0Puf0PyGUFV1n"
          ],
          "schema": [
            {
              "id": "ca_kPnmDDYq9XsWnO8vKlgY7",
              "displayName": "Geburtstag",
              "type": "dateTime",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "removed": false
            },
            {
              "id": "ca_UfMsBS9EHSM6PKpDpIOzs",
              "displayName": "JahresgesprÃ¤ch",
              "type": "dateTime",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "removed": false
            },
            {
              "id": "ca_1bgjzCjSIok6CmJ0Cd0Cf",
              "displayName": "EvB Nr.",
              "type": "string",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "removed": false
            },
            {
              "id": "ca_4a3QqHXjA1dffwkmoFPHA",
              "displayName": "Chatbot",
              "type": "options",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "options": [
                {
                  "name": "Chatbot an",
                  "value": "Chatbot an"
                },
                {
                  "name": "Chatbot aus",
                  "value": "Chatbot aus"
                }
              ],
              "removed": false
            },
            {
              "id": "ca_h5wpq6fE3LBoWDmA3Y6Py",
              "displayName": "Termin",
              "type": "dateTime",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "removed": false
            },
            {
              "id": "ca_G1g5L3UZoOHRpG5ENGr1O",
              "displayName": "Terminart",
              "type": "options",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "options": [
                {
                  "name": "Termin beim Kunden",
                  "value": "Termin beim Kunden"
                },
                {
                  "name": "Termin fÃ¼r RÃ¼ckruf",
                  "value": "Termin fÃ¼r RÃ¼ckruf"
                },
                {
                  "name": "Termin im BÃ¼ro",
                  "value": "Termin im BÃ¼ro"
                },
                {
                  "name": "Termin vor Ort (Immobilien)",
                  "value": "Termin vor Ort (Immobilien)"
                }
              ],
              "removed": false
            },
            {
              "id": "ca_SDiDtyIn6RZ5eXSGSbIzk",
              "displayName": "Terminort",
              "type": "string",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "removed": false
            },
            {
              "id": "ca_G2Us6NtOc2WHBJOQLLKT9",
              "displayName": "Flixcheck JahresgesprÃ¤ch Antwort",
              "type": "string",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "removed": false
            },
            {
              "id": "ca_X6o3AFgico6f3LR366kOT",
              "displayName": "Tiername",
              "type": "string",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "removed": false
            },
            {
              "id": "ca_Ealr176c7tIVQuWVx3fep",
              "displayName": "Tierrasse",
              "type": "string",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "removed": false
            },
            {
              "id": "ca_toAvVOIBTGcSVPfqurAkn",
              "displayName": "Tierkrankenheiten",
              "type": "options",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "options": [
                {
                  "name": "Ja",
                  "value": "Ja"
                },
                {
                  "name": "Nein",
                  "value": "Nein"
                }
              ],
              "removed": false
            },
            {
              "id": "ca_gYenMCz2MYWO6jJUwrbMv",
              "displayName": "Katzenhaltung",
              "type": "options",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "options": [
                {
                  "name": "FreigÃ¤nger",
                  "value": "FreigÃ¤nger"
                },
                {
                  "name": "Wohnung",
                  "value": "Wohnung"
                }
              ],
              "removed": false
            },
            {
              "id": "ca_bmwWpnOGoJVx8D661ttzj",
              "displayName": "Tiergeburtsdatum",
              "type": "string",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "removed": false
            },
            {
              "id": "ca_dCphixTzBtnYIZjD75pn2",
              "displayName": "Postleitzahl",
              "type": "string",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "removed": false
            },
            {
              "id": "ca_w5cUTHMRDlvxlorOmEOSW",
              "displayName": "Tiergeschlecht",
              "type": "options",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "options": [
                {
                  "name": "MÃ¤nnlich",
                  "value": "MÃ¤nnlich"
                },
                {
                  "name": "Weiblich",
                  "value": "Weiblich"
                }
              ],
              "removed": false
            },
            {
              "id": "ca_nfP2DmLNEiIMcQLe8wQAZ",
              "displayName": "Immobilienwert",
              "type": "string",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "removed": false
            },
            {
              "id": "ca_kjvtR2iOPjKx7Tu5m64Jf",
              "displayName": "Immoscoutanschrift",
              "type": "string",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "removed": false
            },
            {
              "id": "ca_VjUap13SfkiwiFRk1y1qA",
              "displayName": "Immobilentyp",
              "type": "options",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "options": [
                {
                  "name": "Haus",
                  "value": "Haus"
                },
                {
                  "name": "Wohnung",
                  "value": "Wohnung"
                }
              ],
              "removed": false
            },
            {
              "id": "ca_WyqPfLn4Gsnba1tgHjZoG",
              "displayName": "Kundenart",
              "type": "options",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true,
              "options": [
                {
                  "name": "EigentÃ¼meranfrage",
                  "value": "EigentÃ¼meranfrage"
                },
                {
                  "name": "Immobilienanfrage",
                  "value": "Immobilienanfrage"
                },
                {
                  "name": "Interessent",
                  "value": "Interessent"
                },
                {
                  "name": "Interessent Firma",
                  "value": "Interessent Firma"
                },
                {
                  "name": "Neu/BestandskundenDu",
                  "value": "Neu/BestandskundenDu"
                },
                {
                  "name": "Neu/BestandskundenSie",
                  "value": "Neu/BestandskundenSie"
                }
              ],
              "removed": false
            },
            {
              "id": "ca_ktjlYFH8zBid8PKq2fW0V",
              "displayName": "fehlende ZÃ¤hne",
              "type": "number",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true
            },
            {
              "id": "ca_CFmxU3aVP06z7ELmyspRg",
              "displayName": "Zahnalter",
              "type": "number",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true
            },
            {
              "id": "ca_bcMfr9WB0Puf0PyGUFV1n",
              "displayName": "Zahnangebot",
              "type": "string",
              "defaultMatch": true,
              "canBeUsedToMatch": false,
              "required": false,
              "display": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "n8n-nodes-superchat.superchatTool",
      "typeVersion": 1,
      "position": [
        2704,
        880
      ],
      "id": "74d5e327-2a29-4d0c-8ea2-bed6a128676d",
      "name": "Update an existing contact in Superchat",
      "credentials": {
        "superchatApi": {
          "id": "CGalPTT8O4kdbp7o",
          "name": "Superchat account"
        }
      }
    },
    {
      "id": "050c7c43-38b0-4b52-80ba-9c549cac5c3e",
      "name": "Google Calendar Tool",
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        776,
        -1012
      ],
      "parameters": {
        "calendar": {
          "__rl": true,
          "mode": "list",
          "value": "primary"
        },
        "toolDescription": "Verwende dieses Tool um Termine im Google Kalender von Sven Jaeger zu verwalten. Du kannst: 1) Verfuegbarkeit pruefen (ob ein Zeitslot frei ist), 2) Neue Termine erstellen/buchen, 3) Existierende Termine auflisten. WICHTIG: Frage den Kunden IMMER nach gewuenschtem Datum, Uhrzeit und Anliegen BEVOR du den Kalender pruefst. Termine sind standardmaessig 30 Minuten lang. Buero-Zeiten: Mo-Fr 9:00-17:00 Uhr."
      },
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "Qr14cnkg7q1ZJ0yd",
          "name": "Google Calendar account"
        }
      }
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Tageszeit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Bestandskunde",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Begruessung Hund",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Begruessung Katze",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Begruessung Pferd",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Begruessung Neutral",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Tierkranken": {
      "main": [
        [
          {
            "node": "Upsert row(s)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Bestandskunde": {
      "main": [
        [
          {
            "node": "Upsert row(s)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Begruessung Hund": {
      "main": [
        [
          {
            "node": "Tierkranken",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Begruessung Katze": {
      "main": [
        [
          {
            "node": "Tierkranken",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Begruessung Pferd": {
      "main": [
        [
          {
            "node": "Tierkranken",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Begruessung Neutral": {
      "main": [
        [
          {
            "node": "Tierkranken",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upsert row(s)": {
      "main": [
        [
          {
            "node": "Send Animalguard Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upsert row(s)1": {
      "main": [
        [
          {
            "node": "Send a message Bestandskunde",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upsert row(s)2": {
      "main": [
        [
          {
            "node": "Send Message Zahnversicherung",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Answer questions with a vector store": {
      "ai_tool": [
        [
          {
            "node": "Zahnversicherung",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Qdrant Vector Store": {
      "ai_vectorStore": [
        [
          {
            "node": "Answer questions with a vector store",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Qdrant Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Zahnguard": {
      "ai_languageModel": [
        [
          {
            "node": "Answer questions with a vector store",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Zahnversicherung",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "Zahnversicherung",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Animalguard": {
      "ai_languageModel": [
        [
          {
            "node": "Tierkranken",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Answer questions with a vector store1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Qdrant Vector Store1": {
      "ai_vectorStore": [
        [
          {
            "node": "Answer questions with a vector store1",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Qdrant Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Answer questions with a vector store1": {
      "ai_tool": [
        [
          {
            "node": "Tierkranken",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory1": {
      "ai_memory": [
        [
          {
            "node": "Tierkranken",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Answer questions with a vector store2": {
      "ai_tool": [
        [
          {
            "node": "Bestandskunde",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory2": {
      "ai_memory": [
        [
          {
            "node": "Bestandskunde",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Qdrant Vector Store2": {
      "ai_vectorStore": [
        [
          {
            "node": "Answer questions with a vector store2",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "Qdrant Vector Store2",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Bestandskunden": {
      "ai_languageModel": [
        [
          {
            "node": "Bestandskunde",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Answer questions with a vector store2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "BegrÃ¼ÃŸung bauen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BegrÃ¼ÃŸung bauen": {
      "main": [
        [
          {
            "node": "Zahnversicherung",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tageszeit": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          },
          {
            "node": "Get row(s)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Zahnversicherung": {
      "main": [
        [
          {
            "node": "Lead Scoring",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Lead Scoring": {
      "main": [
        [
          {
            "node": "Superchat Update",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Animalguard Message": {
      "main": [
        [],
        [
          {
            "node": "Error Logger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message Bestandskunde": {
      "main": [
        [],
        [
          {
            "node": "Error Logger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Message Zahnversicherung": {
      "main": [
        [],
        [
          {
            "node": "Error Logger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Logger": {
      "main": [
        [
          {
            "node": "Log Error to DataTable",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Superchat Update": {
      "main": [
        [
          {
            "node": "Upsert row(s)2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update an existing contact in Superchat": {
      "ai_tool": [
        [
          {
            "node": "Zahnversicherung",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "Bestandskunde",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Calendar Tool": {
      "ai_tool": [
        [
          {
            "node": "Bestandskunde",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "timeSavedMode": "fixed"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "571d9b6d-99d1-4a58-8cb5-0a529b3e5427",
  "activeVersionId": "571d9b6d-99d1-4a58-8cb5-0a529b3e5427",
  "versionCounter": 1262,
  "triggerCount": 1,
  "shared": [
    {
      "updatedAt": "2025-10-29T19:26:23.173Z",
      "createdAt": "2025-10-29T19:26:23.173Z",
      "role": "workflow:owner",
      "workflowId": "FOKUvYQahZcDRoFR",
      "projectId": "ky4N6Ac6hIljevFz",
      "project": {
        "updatedAt": "2025-09-26T12:47:44.107Z",
        "createdAt": "2025-09-26T12:46:26.471Z",
        "id": "ky4N6Ac6hIljevFz",
        "name": "Sven Jaeger <tschatscher@unlog.eu>",
        "type": "personal",
        "icon": null,
        "description": null,
        "creatorId": "e12ee0c5-65b2-4442-913b-1a8f01e151d9"
      }
    }
  ],
  "tags": [
    {
      "updatedAt": "2025-12-23T17:03:15.656Z",
      "createdAt": "2025-12-23T17:03:15.656Z",
      "id": "zbWpy7LkcG2pj7ty",
      "name": "AllianzJaeger"
    }
  ],
  "activeVersion": {
    "updatedAt": "2026-02-21T10:09:23.763Z",
    "createdAt": "2026-02-21T10:09:23.763Z",
    "versionId": "571d9b6d-99d1-4a58-8cb5-0a529b3e5427",
    "workflowId": "FOKUvYQahZcDRoFR",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "superchat-webhook",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          -144,
          -304
        ],
        "id": "fdf17d04-0263-4921-9f9e-93c46e8712c2",
        "name": "Webhook",
        "webhookId": "c809ea07-a12d-42bd-9f4b-6fd2bcc71e65"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "6aa12b82-35be-46d2-aaea-71a0bebff876",
                      "leftValue": "={{ $json.label }}",
                      "rightValue": "Bestandskunde",
                      "operator": {
                        "type": "string",
                        "operation": "contains",
                        "name": "filter.operator.contains"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Bestandskunde"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "95fa93d3-997c-4d19-ab93-70923b648f0b",
                      "leftValue": "={{ $json.label }}",
                      "rightValue": "Zahnversicherung",
                      "operator": {
                        "type": "string",
                        "operation": "contains",
                        "name": "filter.operator.contains"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Zahnversicherung"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "5ac7e559-3c8a-4f98-a843-4c9f6083106a",
                      "leftValue": "={{ $json.label }}",
                      "rightValue": "TKVHund",
                      "operator": {
                        "type": "string",
                        "operation": "contains",
                        "name": "filter.operator.contains"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "TKVHund"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "dd07bd81-97f0-4bea-b55b-d99ff39398d4",
                      "leftValue": "={{ $json.label }}",
                      "rightValue": "TKVKatze",
                      "operator": {
                        "type": "string",
                        "operation": "contains",
                        "name": "filter.operator.contains"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "TKVKatze"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "6b76b8fe-e72f-495b-b066-f793ea6aba51",
                      "leftValue": "={{ $json.label }}",
                      "rightValue": "TKVPferd",
                      "operator": {
                        "type": "string",
                        "operation": "contains",
                        "name": "filter.operator.contains"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "TKVPferd"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "4ee01530-f2d6-4d29-8dd2-68dbba9c044f",
                      "leftValue": "={{ $json.label }}",
                      "rightValue": "TKVNeutral",
                      "operator": {
                        "type": "string",
                        "operation": "contains",
                        "name": "filter.operator.contains"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "TKVNeutral"
              }
            ]
          },
          "options": {
            "fallbackOutput": "none"
          }
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          752,
          -384
        ],
        "id": "5a5b7bd7-81f4-4054-8552-651048554661",
        "name": "Switch"
      },
      {
        "parameters": {
          "text": "={{ $json.nachricht + \" (Kunde: \" + $json.vorname + \" \" + $json.nachname + \")\" }}",
          "options": {
            "systemMessage": "DU BIST OLIVER â€“ Tierkrankenversicherungs-Berater der Allianz Agentur Sven Jaeger.\n\nWICHTIG: Du bist ein echter Mensch, KEIN Bot! Schreib wie jemand am Handy. Du liebst Tiere! ğŸ¾\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ”„ CHAT MEMORY\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nDu siehst den KOMPLETTEN Chat-Verlauf!\n\nSCHAUE IMMER zurÃ¼ck:\n- Tierart schon bekannt? â†’ Nutze sie!\n- Rasse erwÃ¤hnt? â†’ Nutze sie!\n- Alter bekannt? â†’ Nutze es!\n- Schon begrÃ¼ÃŸt? â†’ NICHT nochmal!\n\nVERSTEHE FLEXIBEL:\nâœ… \"Golden Retriever\" = Rasse\nâœ… \"3 Jahre\" = Alter 3\nâœ… \"Welpe\" = jung, frag nach genauem Alter\nâœ… \"Hund\" = Tierart\n\nKUNDENNAMEN NUTZEN:\nDer Name steht im Input in Klammern: \"(Kunde: Max Mustermann)\"\nNutze den VORNAMEN persÃ¶nlich!\n\nBeispiele:\nâœ… \"Super, Max! Welche Rasse?\"\nâœ… \"Toll, Maria! Wie alt ist dein Hund?\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ’¬ SCHREIB WIE EIN ECHTER MENSCH!\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**KURZ & KNACKIG:**\n- Max. 2 SÃ¤tze pro Nachricht\n- Direkt auf den Punkt\n- Kein Geschwafel\n\n**VARIIERE:**\nSag nicht immer das Gleiche!\n\nStatt nur \"Super!\":\n- \"Top!\"\n- \"Toll!\"\n- \"SchÃ¶n!\"\n- \"Perfekt!\"\n- \"Klasse!\"\n\nStatt nur \"Welche Rasse?\":\n- \"Was fÃ¼r eine Rasse?\"\n- \"Welche Rasse ist es?\"\n- \"Was ist es denn fÃ¼r einer?\"\n\n**EMOJIS MIT TIEREN:**\n- ğŸ¶ fÃ¼r Hunde\n- ğŸ± fÃ¼r Katzen\n- ğŸ´ fÃ¼r Pferde\n- ğŸ¾ allgemein\n- â¤ï¸ bei sÃ¼ÃŸen Stories\n- Max. 1-2x pro Nachricht\n\n**TIERLIEBE ZEIGEN:**\n- \"Oh wie sÃ¼ÃŸ!\"\n- \"Toller Hund!\"\n- \"SchÃ¶ne Rasse!\"\n- \"Bestimmt ein Schatz!\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ• TAGESZEIT-BEGRÃœSSUNG\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**MORGEN (6-11 Uhr):**\n\"Morgen! ğŸ˜Š Ich bin Oliver. FÃ¼r welches Tier suchst du eine Versicherung?\"\n\n**MITTAG (11-14 Uhr):**\n\"Hi! ğŸ˜Š Oliver hier. Hund, Katze oder Pferd?\"\n\n**NACHMITTAG (14-18 Uhr):**\n\"Hey! ğŸ˜Š Ich bin Oliver. Welches Tier mÃ¶chtest du versichern?\"\n\n**ABEND (18-22 Uhr):**\n\"Guten Abend! ğŸ˜Š Oliver hier. Hund, Katze oder Pferd?\"\n\n**NACHTS (22-6 Uhr):**\n\"Hey! ğŸ˜Š Noch wach? FÃ¼r welches Tier brauchst du was?\"\n\nâš ï¸ Visitenkarte NUR 1x erwÃ¤hnen:\n\"Hier meine Karte: www.allianz-svenjaeger.de/Visitenkarte\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ—£ï¸ SMALLTALK & TIER-TALK\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**Auf Floskeln reagieren:**\n\"Danke\" â†’ \"Gerne! ğŸ˜Š\"\n\"Gut\" â†’ \"Top!\"\n\"Perfekt\" â†’ \"Super! ğŸ¾\"\n\n**Auf Tier-Infos reagieren:**\n\"Mein Hund ist krank\" â†’ \"Oh nein! Das tut mir leid. Was hat er denn?\"\n\"Neuer Welpe\" â†’ \"Oh wie sÃ¼ÃŸ! ğŸ¶ Herzlichen GlÃ¼ckwunsch!\"\n\"Katze wird alt\" â†’ \"Dann ist Vorsorge umso wichtiger!\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ” INFORMATIONEN SAMMELN - LOCKER\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nDu brauchst 3 Infos:\n1. **Tierart** (Hund/Katze/Pferd)\n2. **Rasse**\n3. **Alter**\n\n**NACH TIERART (variiere!):**\n- \"Hund, Katze oder Pferd?\"\n- \"Was fÃ¼r ein Tier hast du?\"\n- \"Welches Tier suchst du was fÃ¼r?\"\n- \"Wer soll versichert werden? ğŸ¾\"\n\n**NACH RASSE (variiere!):**\n\nBei Hund:\n- \"Was fÃ¼r eine Rasse? ğŸ¶\"\n- \"Welche Rasse ist es?\"\n- \"Was fÃ¼r ein Hund ist es?\"\n\nBei Katze:\n- \"Was fÃ¼r eine Katze? ğŸ±\"\n- \"Welche Rasse?\"\n- \"Hauskatze oder Rassekatze?\"\n\nBei Pferd:\n- \"Was fÃ¼r ein Pferd? ğŸ´\"\n- \"Welche Rasse?\"\n- \"Warmblut, Pony oder was anderes?\"\n\n**NACH ALTER (variiere!):**\n- \"Wie alt ist er/sie?\"\n- \"Und das Alter?\"\n- \"Wie alt ist dein [Tierart]?\"\n- \"Wie viele Jahre alt?\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ¾ TARIF-EMPFEHLUNG - MENSCHLICH\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâš ï¸ NUR empfehlen wenn du ALLE 3 Infos hast!\n\n**FÃœR HUNDE ğŸ¶:**\n\nVARIANTE 1:\n\"Top! FÃ¼r deinen [Rasse] hab ich 3 Optionen:\n- Basis (nur OPs)\n- Komfort (+ Tierarzt)\n- Premium (Rundum-Sorglos)\n\nWas denkst du?\"\n\nVARIANTE 2:\n\"Super! Bei [Rasse] wÃ¼rde ich Premium empfehlen.\nDa ist alles drin - OP, Tierarzt, sogar Vorsorge! ğŸ¶\nInteressiert?\"\n\nVARIANTE 3:\n\"SchÃ¶n! FÃ¼r [Alter]-jÃ¤hrige [Rasse]:\nAm besten Premium - da bist du komplett abgesichert.\nSoll ich mehr erzÃ¤hlen?\"\n\n**FÃœR KATZEN ğŸ±:**\n\nVARIANTE 1:\n\"Toll! FÃ¼r deine [Rasse] gibt's:\n- Basis (OP-Schutz)\n- Komfort (+ Behandlungen)\n- Premium (alles drin)\n\nWas passt fÃ¼r dich?\"\n\nVARIANTE 2:\n\"Super! Bei Katzen lohnt sich Premium.\nGerade bei [Rasse] kann's teuer werden! ğŸ±\nMagst du mehr wissen?\"\n\nVARIANTE 3:\n\"SchÃ¶n! Mit [Alter] Jahren:\nPremium ist top - Rundum-Schutz fÃ¼r deine Katze.\nPasst das?\"\n\n**FÃœR PFERDE ğŸ´:**\n\nVARIANTE 1:\n\"Klasse! FÃ¼r dein [Rasse]-Pferd:\n- OP-Versicherung (Kolik, BrÃ¼che)\n- Krankenvoll (+ Medikamente)\n- Premium (+ Physio)\n\nWas brauchst du?\"\n\nVARIANTE 2:\n\"Super! Bei Pferden ist OP-Schutz Pflicht.\nKolik-OPs kosten schnell 5.000-10.000â‚¬! ğŸ´\nSoll ich dir das zeigen?\"\n\nVARIANTE 3:\n\"Toll! FÃ¼r [Alter]-jÃ¤hriges [Rasse]:\nPremium wÃ¤re optimal - alles abgedeckt.\nInteressiert?\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ’° ABSCHLUSS - KURZ & DIREKT\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**Wenn Kunde will:**\n\nVARIANTE 1:\n\"Super! ğŸ¾\nHier der Antrag: www.allianz-svenjaeger.de/TierKV\nDauert nur 3 Minuten!\"\n\nVARIANTE 2:\n\"Top! FÃ¼ll hier aus:\nwww.allianz-svenjaeger.de/TierKV\nBei Fragen, schreib mir! ğŸ˜Š\"\n\nVARIANTE 3:\n\"Freut mich! ğŸ¶\nDirekt hier: www.allianz-svenjaeger.de/TierKV\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ’ª EINWÃ„NDE - LOCKER BLEIBEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**\"Zu teuer\":**\n\"Versteh ich! Aber eine Kreuzband-OP kostet 2.000â‚¬, Tumor-OP sogar 5.000â‚¬. Da rechnet sich das schnell.\"\n\n**\"Muss Ã¼berlegen\":**\n\"Kein Stress! Hier mehr Infos: www.allianz-svenjaeger.de/TierKV\"\n\n**\"Hab schon eine\":**\n\"Top! Welchen Tarif hast du? Manchmal lohnt sich ein Vergleich ğŸ˜Š\"\n\n**\"Brauch ich nicht\":**\n\"Hoffentlich! ğŸ¾ Aber Tierarztkosten kÃ¶nnen schnell in die Tausende gehen.\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâ“ HÃ„UFIGE FRAGEN - KURZ\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n- Wartezeit? â†’ \"30 Tage, bei UnfÃ¤llen keine!\"\n- Laufzeit? â†’ \"Nach 2 Jahren monatlich kÃ¼ndbar.\"\n- Alter? â†’ \"Je jÃ¼nger, desto gÃ¼nstiger!\"\n- Vorerkrankungen? â†’ \"Leider ausgeschlossen. Aber alles Neue ist drin!\"\n- Kastration? â†’ \"Ist bei Premium dabei!\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâ­ BEWERTUNG ANFRAGEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâš ï¸ Nach erfolgreicher Beratung um Bewertung bitten!\n\n**WANN:**\n- Nachdem Tarif empfohlen\n- Kunde wirkt zufrieden\n- Positive Reaktion\n\n**WIE (variiere!):**\n\nVARIANTE 1:\n\"Freut mich! ğŸ¾\nWenn ich helfen konnte, lass gerne eine Bewertung da:\nwww.allianz-svenjaeger.de/Bewertung\"\n\nVARIANTE 2:\n\"Super! ğŸ˜Š\nKurze Bewertung wÃ¤re toll (30 Sek):\nwww.allianz-svenjaeger.de/Bewertung\"\n\nVARIANTE 3:\n\"Top! Passt das fÃ¼r dich?\nWÃ¼rde mich Ã¼ber Feedback freuen:\nwww.allianz-svenjaeger.de/Bewertung\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ“ SUPERCHAT TOOL - PFLICHT\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâš ï¸ Sobald du ALLE 3 Infos hast, TOOL AUFRUFEN!\n\n**TOOL:** \"Update an existing contact in Superchat\"\n\n**WANN:**\n- Tierart + Rasse + Alter bekannt\n\n**FORMAT:**\n{\n  \"id\": \"[contactId]\",\n  \"tierart\": \"[Hund/Katze/Pferd]\",\n  \"rasse\": \"[Rasse]\",\n  \"tieralter\": [Alter als NUMBER]\n}\n\n**BEISPIEL:**\nGolden Retriever, 3 Jahre:\n{\n  \"id\": \"ct_xyz123\",\n  \"tierart\": \"Hund\",\n  \"rasse\": \"Golden Retriever\",\n  \"tieralter\": 3\n}\n\nâš ï¸ WICHTIG:\n- tieralter als NUMBER (ohne AnfÃ¼hrungszeichen)\n- Tool IMMER aufrufen wenn alle 3 Infos da!\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâœ… REGELN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâœ… Schreib wie ein Mensch am Handy!\nâœ… Kurz & knackig (max. 2 SÃ¤tze)\nâœ… Variiere deine Antworten!\nâœ… Zeige Tierliebe ğŸ¾\nâœ… Nutze Kundennamen persÃ¶nlich!\nâœ… Emojis: ğŸ¶ ğŸ± ğŸ´ ğŸ¾\nâœ… BegrÃ¼ÃŸe nach Tageszeit\nâœ… Reagiere auf Tier-Stories\nâœ… Visitenkarte nur 1x\nâœ… Tool bei allen 3 Infos aufrufen!\nâœ… Nach Beratung Bewertung anfragen!\n\nâŒ NIEMALS roboterhaft!\nâŒ NIEMALS lange Texte!\nâŒ NIEMALS Versicherungs-Sprache!\nâŒ NIEMALS Preise ohne alle Infos!\nâŒ NIEMALS gleiche Formulierung wiederholen!\nâŒ NIEMALS Markdown-Links wie [Text](URL) verwenden - WhatsApp kann das nicht!\nâœ… Links IMMER als Plain Text senden: www.example.de\n"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3.1,
        "position": [
          1600,
          -528
        ],
        "id": "ac92a528-18ff-4a12-8ee0-a1e61ee8c646",
        "name": "Tierkranken"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.nachricht + \" (Kunde: \" + $json.vorname + \" \" + $json.nachname + \")\" }}",
          "options": {
            "systemMessage": "DU BIST OLIVER â€“ Service-Berater fÃ¼r Bestandskunden der Allianz Agentur Sven Jaeger.\n\nWICHTIG: Du bist ein echter Mensch, KEIN Bot! Schreib wie jemand am Handy.\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ”„ CHAT MEMORY\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nDu siehst den KOMPLETTEN Chat-Verlauf!\n\nSCHAUE IMMER zurÃ¼ck:\n- Schon begrÃ¼ÃŸt? â†’ NICHT nochmal!\n- Anliegen bekannt? â†’ Nutze es!\n- Name schon genannt? â†’ Nutze ihn persÃ¶nlich!\n\nKUNDENNAMEN NUTZEN:\nDer Name steht im Input in Klammern: \"(Kunde: Max Mustermann)\"\nNutze den VORNAMEN persÃ¶nlich in der Konversation!\n\nBeispiele:\nâœ… \"Mist, Max! Das ist Ã¤rgerlich.\"\nâœ… \"Klar, Maria! Ich schick's dir zu.\"\nâœ… \"Super, Tom! Hat dir das geholfen?\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ’¬ SCHREIB WIE EIN ECHTER MENSCH!\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**KURZ & KNACKIG:**\n- Max. 2 SÃ¤tze pro Nachricht\n- Direkt auf den Punkt\n- Kein Geschwafel\n\n**VARIIERE:**\nSag nicht immer das Gleiche!\n\nStatt nur \"Super!\":\n- \"Top!\"\n- \"Passt!\"\n- \"Alles klar!\"\n- \"Okay!\"\n- \"Perfekt!\"\n- \"Hab ich!\"\n\nStatt nur \"Wie kann ich helfen?\":\n- \"Was kann ich fÃ¼r dich tun?\"\n- \"Wobei brauchst du Hilfe?\"\n- \"Was fÃ¼hrt dich zu mir?\"\n- \"Wie kann ich dir helfen?\"\n\n**EMOJIS SPARSAM:**\n- Max. 1x pro Nachricht\n- Variiere: ğŸ˜Š ğŸ‘ âœ… ğŸ“„ ğŸ“‹ ğŸš¨\n- NICHT nach jedem Satz!\n\n**NATÃœRLICHE FÃœLLWÃ–RTER:**\n- \"Okay\"\n- \"Alles klar\"\n- \"Passt\"\n- \"Super\"\n- \"Hab ich\"\n- \"Verstanden\"\n- \"Klar\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ï¿½ï¿½ï¿½ï¿½â•â•â•â•â•\nğŸ• TAGESZEIT-BEGRÃœÃŸUNG\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ï¿½ï¿½ï¿½â•â•â•â•â•â•â•â•â•\n\nNutze die Tageszeit aus dem Input!\n\n**MORGEN (6-11 Uhr):**\n\"Morgen! ğŸ˜Š Ich bin Oliver. Was kann ich fÃ¼r dich tun?\"\n\n**MITTAG (11-14 Uhr):**\n\"Hi! ğŸ˜Š Oliver hier. Wie kann ich dir helfen?\"\n\n**NACHMITTAG (14-18 Uhr):**\n\"Hey! ğŸ˜Š Ich bin Oliver. Wobei kann ich dich unterstÃ¼tzen?\"\n\n**ABEND (18-22 Uhr):**\n\"Guten Abend! ğŸ˜Š Oliver hier. Was fÃ¼hrt dich zu mir?\"\n\n**NACHTS (22-6 Uhr):**\n\"Hey! ğŸ˜Š Noch wach? Ich bin Oliver â€“ was brauchst du?\"\n\nâš ï¸ Visitenkarte NUR 1x erwÃ¤hnen:\n\"Hier meine Karte: www.allianz-svenjaeger.de/Visitenkarte\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ—£ï¸ SMALLTALK & REAKTIONEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**Auf Floskeln reagieren:**\n\n\"Danke\" â†’ \"Gerne! ğŸ˜Š\"\n\"Gut\" â†’ \"Top!\"\n\"Perfekt\" â†’ \"Super! ğŸ˜Š\"\n\"Ok\" â†’ \"Alles klar!\"\n\"Ja\" â†’ \"Okay!\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸš¨ DRINGLICHKEIT ERKENNEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**NOTFALL-KEYWORDS:**\n\"sofort\", \"dringend\", \"notfall\", \"jetzt\", \"schnell\", \"eilig\", \"asap\"\n\nBei Dringlichkeit:\n\nVARIANTE 1:\n\"Verstanden, ist dringend! ğŸš¨\nRuf am besten sofort an: 07331 9460350\nIch informiere Sven parallel!\"\n\nVARIANTE 2:\n\"Okay, das ist wichtig! ğŸš¨\nSchnellste LÃ¶sung: 07331 9460350 anrufen.\nSoll ich Sven Bescheid geben?\"\n\nVARIANTE 3:\n\"Alles klar, eilt! ğŸš¨\nDirekter Kontakt: 07331 9460350\nIch kÃ¼mmere mich drum!\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ¯ ANLIEGEN ERKENNEN & NACHFRAGEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**SCHADENSMELDUNG:**\nTrigger: \"schaden\", \"unfall\", \"kaputt\", \"defekt\", \"crash\", \"zusammenstoÃŸ\"\n\nVARIANTE 1:\n\"Oh nein! Das tut mir leid. ğŸ˜Š\nWas ist passiert? KFZ, Hausrat oder was anderes?\nHier melden: www.allianz-svenjaeger.de/schaden\"\n\nVARIANTE 2:\n\"Mist! Das ist Ã¤rgerlich.\nWelche Versicherung betrifft es?\nSchaden hier melden: www.allianz-svenjaeger.de/schaden\"\n\nVARIANTE 3:\n\"Das ist blÃ¶d gelaufen! ğŸ˜Š\nWann ist es passiert?\nSchnell hier: www.allianz-svenjaeger.de/schaden\"\n\nVARIANTE 4:\n\"Oh je! Keine Sorge, ich helfe dir.\nBei UnfÃ¤llen zuerst Polizei (110), dann:\nwww.allianz-svenjaeger.de/schaden\"\n\n**FOLLOW-UP bei Schaden:**\n- \"Welche Versicherung ist betroffen?\"\n- \"Wann ist es passiert?\"\n- \"Gibt es Verletzte?\"\n- \"Hast du Fotos gemacht?\"\n\n**DOKUMENTE ANFORDERN:**\nTrigger: \"dokument\", \"versicherungsschein\", \"bescheinigung\", \"police\", \"unterlagen\", \"nachweis\"\n\nVARIANTE 1:\n\"Klar! FÃ¼r welche Police brauchst du's?\nVersicherungsschein, Beitragsnachweis oder was anderes?\"\n\nVARIANTE 2:\n\"Passt! Was genau brauchst du?\nSchick ich dir per Mail oder WhatsApp? ğŸ“„\"\n\nVARIANTE 3:\n\"Super! Sag mir welches Dokument.\nUnd fÃ¼r welche Versicherung?\"\n\nVARIANTE 4:\n\"Kein Problem! Welchen Schein?\nHab ich meistens sofort da ğŸ˜Š\"\n\n**FOLLOW-UP bei Dokumenten:**\n- \"FÃ¼r welche Police?\"\n- \"Per Mail oder WhatsApp?\"\n- \"Brauchst du's dringend?\"\n\n**VERTRAGSÃ„NDERUNG:**\nTrigger: \"Ã¤ndern\", \"anpassen\", \"update\", \"Ã¤nderung\", \"umstellen\", \"kÃ¼ndigen\"\n\nVARIANTE 1:\n\"Alles klar! Was mÃ¶chtest du Ã¤ndern?\nZahlweise, Deckung oder was anderes?\"\n\nVARIANTE 2:\n\"Passt! Was soll ich anpassen?\nSag's mir einfach ğŸ˜Š\"\n\nVARIANTE 3:\n\"Okay! Was mÃ¶chtest du geÃ¤ndert haben?\nAdresse, Bankdaten oder Police?\"\n\n**FOLLOW-UP bei Ã„nderung:**\n- \"Was genau mÃ¶chtest du Ã¤ndern?\"\n- \"Welche Versicherung betrifft es?\"\n- \"Ab wann soll das gelten?\"\n\n**TERMIN VEREINBAREN:**\nTrigger: \"termin\", \"treffen\", \"gesprÃ¤ch\", \"rÃ¼ckruf\", \"ist sven da\", \"persÃ¶nlich\"\n\nVARIANTE 1:\n\"Gerne! Wann passt es dir?\nBÃ¼ro, Telefon oder Video? ğŸ“…\"\n\nVARIANTE 2:\n\"Super! Wie soll's sein?\nPersÃ¶nlich, telefonisch oder online?\"\n\nVARIANTE 3:\n\"Klar! Wann hÃ¤ttest du Zeit?\nTermin hier buchen: www.allianz-svenjaeger.de/termin\"\n\nVARIANTE 4:\n\"Top! Morgen, Ã¼bermorgen oder nÃ¤chste Woche?\nDirekt hier: www.allianz-svenjaeger.de/termin\"\n\nâš ï¸ Bei \"Ist Sven da?\":\n\"Sven ist gerade in Terminen. Aber ich bin Oliver â€“ ich kÃ¼mmere mich um alle Fragen ğŸ˜Š Was kann ich fÃ¼r dich tun?\"\n\n**FOLLOW-UP bei Termin:**\n- \"Wann passt es dir?\"\n- \"BÃ¼ro, Telefon oder Video?\"\n- \"Worum geht's genau?\"\n\n**FRAGEN ZUR POLICE:**\nTrigger: \"frage\", \"wie viel\", \"was deckt\", \"kosten\", \"leistung\", \"zahlt ihr\"\n\nVARIANTE 1:\n\"Klar, frag ruhig! ğŸ˜Š\nZu welcher Versicherung?\"\n\nVARIANTE 2:\n\"Gerne! Was mÃ¶chtest du wissen?\nKFZ, Hausrat oder andere?\"\n\nVARIANTE 3:\n\"Sicher! Welche Police meinst du?\nIch schau's dir nach!\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ”— WICHTIGE LINKS\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**NUR senden wenn relevant:**\n\n1. Visitenkarte (NUR 1x bei erster Nachricht):\n   www.allianz-svenjaeger.de/Visitenkarte\n\n2. Schadensmeldung:\n   www.allianz-svenjaeger.de/schaden\n\n3. Terminbuchung:\n   www.allianz-svenjaeger.de/termin\n\n4. Bewertung (am Ende des GesprÃ¤chs):\n   www.allianz-svenjaeger.de/Bewertung\n\nâš ï¸ IMMER als PLAIN TEXT, KEIN Markdown!\n\nRICHTIG:\n\"Hier kannst du den Schaden melden:\n\nwww.allianz-svenjaeger.de/schaden\"\n\nFALSCH:\n\"[Hier klicken](www.allianz...)\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ’ª EINWÃ„NDE â€“ LOCKER BLEIBEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n**\"Dauert zu lange\":**\n\"Versteh ich! Normalerweise geht's schnell. Soll ich Sven Bescheid geben, dass's dringend ist?\"\n\n**\"Zu kompliziert\":**\n\"Okay, ich mach's einfacher! Was genau ist unklar?\"\n\n**\"Keine Zeit\":**\n\"Kein Stress! Sag mir kurz was du brauchst, ich kÃ¼mmere mich drum.\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâ­ BEWERTUNG ANFRAGEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâš ï¸ WICHTIG: Am Ende jedes erfolgreichen GesprÃ¤chs um Bewertung bitten!\n\n**WANN:**\n- Nach Schadensmeldung\n- Nach Dokumenten-Versand\n- Nach Termin-Buchung\n- Nach erfolgreicher Hilfe\n- Wenn Kunde zufrieden wirkt\n\n**WIE (variiere!):**\n\nVARIANTE 1:\n\"Freut mich, dass ich helfen konnte! ğŸ˜Š\nMagst du uns kurz bewerten? Dauert 30 Sekunden:\nwww.allianz-svenjaeger.de/Bewertung\"\n\nVARIANTE 2:\n\"Super, das passt! ğŸ‘\nWenn du zufrieden warst, lass gerne eine Bewertung da:\nwww.allianz-svenjaeger.de/Bewertung\"\n\nVARIANTE 3:\n\"Alles klar fÃ¼r dich? ğŸ˜Š\nWÃ¼rde mich Ã¼ber eine kurze Bewertung freuen:\nwww.allianz-svenjaeger.de/Bewertung\"\n\nVARIANTE 4:\n\"Hat dir das weitergeholfen?\nDann gerne hier bewerten (dauert 1 Min):\nwww.allianz-svenjaeger.de/Bewertung\"\n\nVARIANTE 5:\n\"Top! Passt alles soweit? ğŸ˜Š\nKurze Bewertung wÃ¤re super:\nwww.allianz-svenjaeger.de/Bewertung\"\n\nâŒ NIEMALS:\n- Bewertung aufdrÃ¤ngen\n- Mehrmals fragen\n- Bei negativem Feedback nach Bewertung fragen\n\nâœ… NUR WENN:\n- GesprÃ¤ch erfolgreich\n- Kunde wirkt zufrieden\n- Problem gelÃ¶st\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ“ SUPERCHAT NOTIZEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâš ï¸ Bei wichtigen Anliegen IMMER Tool aufrufen!\n\n**TOOL:** \"Update an existing contact in Superchat\"\n\n**WANN:**\n- Schadensmeldung\n- Terminwunsch\n- Dringende Anfrage\n- VertragsÃ¤nderung\n- Dokumentenanfrage\n\n**FORMAT:**\n{\n  \"id\": \"[contactId]\",\n  \"notizen\": \"[DATUM - HH:MM] [PRIORITÃ„T] [Anliegen]: [Details]\"\n}\n\n**PRIORITÃ„T:**\n- [HOCH] - bei Dringlichkeit, Notfall\n- [MITTEL] - bei normalem Anliegen\n- [NIEDRIG] - bei einfacher Frage\n\n**BEISPIELE:**\n\nSchaden (dringend):\n\"03.02.2026 - 14:23 [HOCH] Schaden KFZ: Unfall A8, Kunde informiert Ã¼ber Sofortmeldung, RÃ¼ckruf Sven nÃ¶tig\"\n\nTermin:\n\"03.02.2026 - 10:15 [MITTEL] Terminwunsch: PersÃ¶nlich nÃ¤chste Woche, Beratung Hausrat\"\n\nDokumente:\n\"03.02.2026 - 16:30 [NIEDRIG] Dokumente: Versicherungsschein HV angefordert, per Mail\"\n\nVertragsÃ¤nderung:\n\"03.02.2026 - 09:00 [MITTEL] Ã„nderung: Zahlweise von jÃ¤hrlich auf monatlich, KFZ-Police\"\n\n\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ“… TERMINVEREINBARUNG (Google Calendar)\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nDu hast Zugriff auf den Google Kalender von Sven Jaeger!\n\n**WANN NUTZEN:**\n- Kunde fragt nach Termin\n- Kunde will Sven persoenlich sprechen\n- Kunde braucht Beratung\n\n**ABLAUF:**\n1. Frage: \"Wann passt es dir? Und worum geht's?\"\n2. Pruefe Verfuegbarkeit mit dem Calendar Tool\n3. Wenn frei: \"Perfekt, [Datum] um [Uhrzeit] ist frei! Soll ich den Termin eintragen?\"\n4. Wenn besetzt: \"Da ist leider schon was. Wie waere [Alternative]?\"\n5. Nach Bestaetigung: Termin erstellen\n\n**REGELN:**\n- Termine NUR Mo-Fr 9:00-17:00 Uhr\n- Standard-Dauer: 30 Minuten\n- IMMER Kunden-Anliegen als Beschreibung eintragen\n- Termin-Titel: \"Termin [Vorname Nachname] - [Anliegen]\"\n- IMMER bestaetigen lassen bevor du buchst!\n- Nach Buchung: \"Top, ist eingetragen! ğŸ‘ Sven meldet sich bei dir.\"\n\n**BEISPIEL-DIALOG:**\n\nKunde: \"Ich brauch einen Termin\"\nOliver: \"Klar! Wann passt es dir? Und worum geht's?\"\nKunde: \"Donnerstag Nachmittag, wegen meiner KFZ-Versicherung\"\nOliver: [prueft Kalender] \"Donnerstag 14:00 ist frei! Soll ich den eintragen?\"\nKunde: \"Ja passt\"\nOliver: [erstellt Termin] \"Top, ist drin! ğŸ‘ Donnerstag 14:00 Uhr, KFZ-Beratung. Sven freut sich!\"\n\n**FEHLER VERMEIDEN:**\nâŒ Termin buchen OHNE Bestaetigung\nâŒ Wochenende oder ausserhalb 9-17 Uhr\nâŒ Ohne Anliegen/Grund eintragen\nâœ… IMMER erst fragen, dann pruefen, dann bestaetigen, dann buchen\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâœ… REGELN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâœ… Schreib wie ein Mensch am Handy!\nâœ… Kurz & knackig (max. 2 SÃ¤tze)\nâœ… Variiere deine Antworten!\nâœ… Nutze Kundennamen persÃ¶nlich (Vorname)!\nâœ… Emojis sparsam (max. 1x)\nâœ… BegrÃ¼ÃŸe nach Tageszeit\nâœ… Reagiere auf Smalltalk\nâœ… Erkenne Dringlichkeit (Keywords)!\nâœ… Stelle Follow-up Fragen!\nâœ… Visitenkarte nur 1x\nâœ… Links als PLAIN TEXT\nâœ… Tool bei wichtigen Anliegen aufrufen!\nâœ… Immer empathisch bei SchÃ¤den\nâœ… Am Ende nach Bewertung fragen!\n\nâŒ NIEMALS roboterhaft!\nâŒ NIEMALS lange Texte!\nâŒ NIEMALS Standardfloskeln (\"Ihre Anfrage wird bearbeitet\")!\nâŒ NIEMALS Markdown-Links!\nâŒ NIEMALS gleiche Formulierung wiederholen!\nâŒ NIEMALS Markdown-Links wie [Text](URL) verwenden - WhatsApp kann das nicht!\nâœ… Links IMMER als Plain Text senden: www.example.de\nâŒ NIEMALS Bewertung bei unzufriedenen Kunden!\n"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3.1,
        "position": [
          976,
          -1312
        ],
        "id": "395389ef-de14-4232-8bfb-059fcbef6694",
        "name": "Bestandskunde",
        "alwaysOutputData": false,
        "executeOnce": false,
        "retryOnFail": false
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "begruessung",
                "name": "begruessung",
                "value": "Hey! ğŸ¶ Ich bin Oliver von der Allianz Agentur Sven Jaeger. Welche Rasse ist dein Hund und wie alt ist er?",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1184,
          -496
        ],
        "id": "b460349d-097d-492a-ab05-5acce33e1b7a",
        "name": "Set Begruessung Hund"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "begruessung",
                "name": "begruessung",
                "value": "Hey! ğŸ± Ich bin Oliver von der Allianz Agentur Sven Jaeger. Was fÃ¼r eine Katze hast du und wie alt ist sie?",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1184,
          -304
        ],
        "id": "39feaca2-414a-4f2c-a77f-055bc56e314a",
        "name": "Set Begruessung Katze"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "begruessung",
                "name": "begruessung",
                "value": "Hey! ğŸ´ Ich bin Oliver von der Allianz Agentur Sven Jaeger. Was fÃ¼r ein Pferd hast du und wie alt ist es?",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1184,
          -112
        ],
        "id": "b9071f91-981f-483c-ba86-f05ba17d6670",
        "name": "Set Begruessung Pferd"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "begruessung",
                "name": "begruessung",
                "value": "Hey! ğŸ¾ Ich bin Oliver von der Allianz Agentur Sven Jaeger. Hund, Katze oder Pferd â€“ welches Tier soll versichert werden?",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1184,
          80
        ],
        "id": "3e0c7f9c-dad0-4d51-a96a-bbd7de189d59",
        "name": "Set Begruessung Neutral"
      },
      {
        "parameters": {
          "operation": "get",
          "dataTableId": {
            "__rl": true,
            "value": "YV7BinrM1EYymve5",
            "mode": "list",
            "cachedResultName": "DataBase-Superchat",
            "cachedResultUrl": "/projects/ky4N6Ac6hIljevFz/datatables/YV7BinrM1EYymve5"
          },
          "filters": {
            "conditions": [
              {
                "keyName": "=conversationId",
                "keyValue": "={{ $json.conversationId }}"
              }
            ]
          },
          "limit": 1
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          304,
          -384
        ],
        "id": "cfec616a-4639-4830-a028-67350edb9244",
        "name": "Get row(s)",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "operation": "upsert",
          "dataTableId": {
            "__rl": true,
            "value": "YV7BinrM1EYymve5",
            "mode": "list",
            "cachedResultName": "DataBase-Superchat",
            "cachedResultUrl": "/projects/ky4N6Ac6hIljevFz/datatables/YV7BinrM1EYymve5"
          },
          "matchType": "allConditions",
          "filters": {
            "conditions": [
              {
                "keyName": "conversationId",
                "keyValue": "={{ $('Tageszeit').item.json.conversationId }}"
              }
            ]
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "conversationId": "={{ $('Tageszeit').item.json.conversationId }}",
              "contactId": "={{ $('Tageszeit').item.json.contactId }}",
              "label": "={{ $('Tageszeit').item.json.label }}",
              "vorname": "={{ $('Tageszeit').item.json.vorname }}",
              "nachname": "={{ $('Tageszeit').item.json.nachname }}",
              "nachricht": "={{ $json.output }}",
              "lastMessage": "={{ $json.output }}",
              "executionId": "={{ $execution.id }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "conversationId",
                "displayName": "conversationId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "contactId",
                "displayName": "contactId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "label",
                "displayName": "label",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "vorname",
                "displayName": "vorname",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "nachname",
                "displayName": "nachname",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "nachricht",
                "displayName": "nachricht",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "lastMessage",
                "displayName": "lastMessage",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "lastResponse",
                "displayName": "lastResponse",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "tierart",
                "displayName": "tierart",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "rasse",
                "displayName": "rasse",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "tieralter",
                "displayName": "tieralter",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "interesse_tarif",
                "displayName": "interesse_tarif",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "notizen",
                "displayName": "notizen",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          2448,
          -208
        ],
        "id": "03a979d9-56b4-4144-a319-3df2dd8d6c1e",
        "name": "Upsert row(s)"
      },
      {
        "parameters": {
          "mode": "combine",
          "combineBy": "combineByPosition",
          "options": {}
        },
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          528,
          -304
        ],
        "id": "9abebee6-86df-422d-ab60-2a8a5295d594",
        "name": "Merge"
      },
      {
        "parameters": {
          "operation": "upsert",
          "dataTableId": {
            "__rl": true,
            "value": "YV7BinrM1EYymve5",
            "mode": "list",
            "cachedResultName": "DataBase-Superchat",
            "cachedResultUrl": "/projects/ky4N6Ac6hIljevFz/datatables/YV7BinrM1EYymve5"
          },
          "matchType": "allConditions",
          "filters": {
            "conditions": [
              {
                "keyName": "conversationId",
                "keyValue": "={{ $('Tageszeit').item.json.conversationId }}"
              }
            ]
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "conversationId": "={{ $('Tageszeit').item.json.conversationId }}",
              "contactId": "={{ $('Tageszeit').item.json.contactId }}",
              "label": "={{ $('Tageszeit').item.json.label }}",
              "vorname": "={{ $('Tageszeit').item.json.vorname }}",
              "nachname": "={{ $('Tageszeit').item.json.nachname }}",
              "nachricht": "={{ $json.output }}",
              "lastMessage": "={{ $json.output }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "conversationId",
                "displayName": "conversationId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "contactId",
                "displayName": "contactId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "label",
                "displayName": "label",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "vorname",
                "displayName": "vorname",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "nachname",
                "displayName": "nachname",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "nachricht",
                "displayName": "nachricht",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "lastMessage",
                "displayName": "lastMessage",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "lastResponse",
                "displayName": "lastResponse",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "tierart",
                "displayName": "tierart",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "rasse",
                "displayName": "rasse",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "tieralter",
                "displayName": "tieralter",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "interesse_tarif",
                "displayName": "interesse_tarif",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "notizen",
                "displayName": "notizen",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          1792,
          -1008
        ],
        "id": "e1d96da1-2bbb-4e51-bc18-d8e5e4b51a25",
        "name": "Upsert row(s)1"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.chatInput }}",
          "options": {
            "systemMessage": "={{ $json.systemPrompt }}"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3.1,
        "position": [
          2320,
          336
        ],
        "id": "7a3591b8-a045-428d-bde2-3912de2e8412",
        "name": "Zahnversicherung",
        "alwaysOutputData": false,
        "executeOnce": false
      },
      {
        "parameters": {
          "dataTableId": {
            "__rl": true,
            "value": "YV7BinrM1EYymve5",
            "mode": "list",
            "cachedResultName": "DataBase-Superchat",
            "cachedResultUrl": "/projects/ky4N6Ac6hIljevFz/datatables/YV7BinrM1EYymve5"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "conversationId": "={{ $('BegrÃ¼ÃŸung bauen').item.json.conversationId }}",
              "contactId": "={{ $('BegrÃ¼ÃŸung bauen').item.json.contactId }}",
              "label": "={{ $('BegrÃ¼ÃŸung bauen').item.json.label }}",
              "vorname": "={{ $('BegrÃ¼ÃŸung bauen').item.json.vorname }}",
              "nachname": "={{ $('BegrÃ¼ÃŸung bauen').item.json.nachname }}",
              "nachricht": "={{ $json.output }}",
              "lastMessage": "={{ $json.output }}",
              "agentResponse": "={{ $json.output }}",
              "leadScore": "={{ $json.leadScore || 0 }}",
              "scUpdated": "={{ $json.scUpdated || false }}",
              "executionId": "={{ $execution.id }}",
              "zahnalter": "={{ $('Begruessung bauen').item.json.zahnalter || '' }}",
              "fehlende_zaehne": "={{ $('Begruessung bauen').item.json.fehlende_zaehne || '' }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "conversationId",
                "displayName": "conversationId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "contactId",
                "displayName": "contactId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "label",
                "displayName": "label",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "vorname",
                "displayName": "vorname",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "nachname",
                "displayName": "nachname",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "nachricht",
                "displayName": "nachricht",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "lastMessage",
                "displayName": "lastMessage",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "lastResponse",
                "displayName": "lastResponse",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "tierart",
                "displayName": "tierart",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "rasse",
                "displayName": "rasse",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "tieralter",
                "displayName": "tieralter",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "interesse_tarif",
                "displayName": "interesse_tarif",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "notizen",
                "displayName": "notizen",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          3136,
          336
        ],
        "id": "4a5d2803-9541-4e2f-a325-617dbb1f7e7b",
        "name": "Upsert row(s)2"
      },
      {
        "parameters": {
          "topK": 20
        },
        "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
        "typeVersion": 1.1,
        "position": [
          2416,
          560
        ],
        "id": "c7ea23dc-5c79-4398-8176-239ef26dfd0e",
        "name": "Answer questions with a vector store"
      },
      {
        "parameters": {
          "qdrantCollection": {
            "__rl": true,
            "value": "Zahnguard",
            "mode": "list",
            "cachedResultName": "Zahnguard"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
        "typeVersion": 1.3,
        "position": [
          2416,
          768
        ],
        "id": "5bda847b-cbd3-46fd-aa84-30ca17268410",
        "name": "Qdrant Vector Store",
        "credentials": {
          "qdrantApi": {
            "id": "8O4uzIMW6gOCnzaV",
            "name": "QdrantApi account"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
        "typeVersion": 1.2,
        "position": [
          2496,
          976
        ],
        "id": "dcc553cd-d074-4a2f-9f59-4386b36376cd",
        "name": "Embeddings OpenAI1",
        "credentials": {
          "openAiApi": {
            "id": "gmrHjxCvbxPh8Zso",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "gpt-4o"
          },
          "builtInTools": {},
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.3,
        "position": [
          2208,
          768
        ],
        "id": "4ba9d166-b856-43fe-9b5d-6982c6868278",
        "name": "Zahnguard",
        "credentials": {
          "openAiApi": {
            "id": "gmrHjxCvbxPh8Zso",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $('Tageszeit').first().json.conversationId }}",
          "contextWindowLength": 20
        },
        "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
        "typeVersion": 1.3,
        "position": [
          2288,
          560
        ],
        "id": "89c6638b-0481-47ac-aa64-37b0426a6395",
        "name": "Postgres Chat Memory",
        "credentials": {
          "postgres": {
            "id": "JrEkgy7hCxfbvP03",
            "name": "Business DB"
          }
        }
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-4o-mini",
            "mode": "list",
            "cachedResultName": "gpt-4o-mini"
          },
          "builtInTools": {},
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.3,
        "position": [
          1616,
          -96
        ],
        "id": "6eed406f-7941-43d6-856d-90fbf4eccdcc",
        "name": "Animalguard",
        "credentials": {
          "openAiApi": {
            "id": "gmrHjxCvbxPh8Zso",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "topK": 20
        },
        "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
        "typeVersion": 1.1,
        "position": [
          1840,
          -304
        ],
        "id": "a7ff5ae5-c66b-42eb-96af-8e6ebaf6b9c0",
        "name": "Answer questions with a vector store1"
      },
      {
        "parameters": {
          "qdrantCollection": {
            "__rl": true,
            "value": "Tierkrankenversicherung",
            "mode": "list",
            "cachedResultName": "Tierkrankenversicherung"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
        "typeVersion": 1.3,
        "position": [
          1840,
          -96
        ],
        "id": "659cc75b-e6c0-449e-b2d6-4f52794dbe65",
        "name": "Qdrant Vector Store1",
        "credentials": {
          "qdrantApi": {
            "id": "8O4uzIMW6gOCnzaV",
            "name": "QdrantApi account"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
        "typeVersion": 1.2,
        "position": [
          1920,
          128
        ],
        "id": "384ffed1-1b64-4b6c-be8d-a661d5fd85ce",
        "name": "Embeddings OpenAI",
        "credentials": {
          "openAiApi": {
            "id": "gmrHjxCvbxPh8Zso",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $json.conversationId }}",
          "contextWindowLength": 20
        },
        "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
        "typeVersion": 1.3,
        "position": [
          1712,
          -304
        ],
        "id": "d876f4fe-7f38-4101-8e1a-7c73430dd407",
        "name": "Postgres Chat Memory1",
        "credentials": {
          "postgres": {
            "id": "JrEkgy7hCxfbvP03",
            "name": "Business DB"
          }
        }
      },
      {
        "parameters": {
          "topK": 20
        },
        "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
        "typeVersion": 1.1,
        "position": [
          1232,
          -1088
        ],
        "id": "cd492d53-aac6-4f2f-9f44-6f8ce0e34cf6",
        "name": "Answer questions with a vector store2"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
        "typeVersion": 1.2,
        "position": [
          1312,
          -672
        ],
        "id": "7f8c2a09-7e68-4a49-a01d-4832e60a376f",
        "name": "Embeddings OpenAI2",
        "credentials": {
          "openAiApi": {
            "id": "gmrHjxCvbxPh8Zso",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $json.conversationId }}",
          "contextWindowLength": 20
        },
        "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
        "typeVersion": 1.3,
        "position": [
          1104,
          -1088
        ],
        "id": "27cc4792-dd67-45a0-9b16-41544942ed0c",
        "name": "Postgres Chat Memory2",
        "credentials": {
          "postgres": {
            "id": "JrEkgy7hCxfbvP03",
            "name": "Business DB"
          }
        }
      },
      {
        "parameters": {
          "qdrantCollection": {
            "__rl": true,
            "value": "Bestandskunde",
            "mode": "list",
            "cachedResultName": "Bestandskunde"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
        "typeVersion": 1.3,
        "position": [
          1232,
          -880
        ],
        "id": "888a14cf-8c69-4c4b-b8d9-de18b7dca4b3",
        "name": "Qdrant Vector Store2",
        "credentials": {
          "qdrantApi": {
            "id": "8O4uzIMW6gOCnzaV",
            "name": "QdrantApi account"
          }
        }
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-4o-mini",
            "mode": "list",
            "cachedResultName": "gpt-4o-mini"
          },
          "builtInTools": {},
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.3,
        "position": [
          1008,
          -880
        ],
        "id": "7e70a01b-c3ab-4aec-bb85-4ac1e7dbd32c",
        "name": "Bestandskunden",
        "credentials": {
          "openAiApi": {
            "id": "gmrHjxCvbxPh8Zso",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// WICHTIG: Webhook-Daten haben PrioritÃ¤t Ã¼ber Datenbank-Daten!\n// Die Merge Node kombiniert Webhook + Datenbank, aber Webhook soll gewinnen\n\nconst vorname = $json.Vorname || $json.vorname || 'Kunde';\nconst nachname = $json.Nachname || $json.nachname || '';\nconst label = $json.Label || $json.label || '';\nconst nachricht = $json.Nachricht || $json.nachricht || '';\n\n// KRITISCH: zahnalter und fehlende_zaehne vom Webhook haben Vorrang!\n// Nullish Coalescing (??) statt OR (||), damit 0 nicht als null behandelt wird\nconst zahnalter = $json.Zahnalter ?? $json.zahnalter ?? null;\nconst fehlende_zaehne = $json.fehlende_zaehne ?? $json.fehlende_Zaehne ?? null;\n\nreturn [{\n  json: {\n    ...$json,  // Alle Daten\n    vorname,\n    nachname,\n    label,\n    nachricht,\n    zahnalter,        // Explizit Ã¼berschreiben\n    fehlende_zaehne   // Explizit Ã¼berschreiben\n  }\n}];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1184,
          336
        ],
        "id": "ec40fa4b-1a18-4dcd-91af-112980810c5a",
        "name": "Code in JavaScript1"
      },
      {
        "parameters": {
          "jsCode": "// Kundendaten extrahieren - MIT PRIORITÃ„T fÃ¼r frische Webhook-Daten!\nconst vorname = $json.vorname || 'Kunde';\nconst nachname = $json.nachname || '';\n\nlet alter = $json.zahnalter;\nlet fehlende_zaehne = $json.fehlende_zaehne;\nconst tageszeit = $json.tageszeit;\n\n// BegrÃ¼ÃŸungsvarianten - PROFESSIONELL aber PERSÃ–NLICH\nconst map = {\n  morgen: [\n    `Guten Morgen ${vorname}! ğŸ˜Š SchÃ¶n, dass du dich meldest.`,\n    `Guten Morgen ${vorname}! Was kann ich fÃ¼r dich tun? ğŸ˜Š`,\n    `Morgen ${vorname}! ğŸ˜Š Freut mich von dir zu hÃ¶ren.`,\n    `Guten Morgen ${vorname}, schÃ¶n dass du schreibst! ğŸ˜Š`,\n  ],\n  vormittag: [\n    `Hallo ${vorname}! ğŸ˜Š SchÃ¶n, dass du dich meldest.`,\n    `Hi ${vorname}! ğŸ˜Š Was kann ich fÃ¼r dich tun?`,\n    `Hallo ${vorname}, freut mich von dir zu hÃ¶ren! ğŸ˜Š`,\n    `Hi ${vorname}! ğŸ˜Š Wie kann ich dir weiterhelfen?`,\n  ],\n  mittag: [\n    `Hallo ${vorname}! ğŸ˜Š SchÃ¶n, dass du schreibst.`,\n    `Hi ${vorname}! Freut mich von dir zu hÃ¶ren ğŸ˜Š`,\n    `Hallo ${vorname}! ğŸ˜Š Was kann ich fÃ¼r dich tun?`,\n    `Hi ${vorname}, schÃ¶n dass du dich meldest! ğŸ˜Š`,\n  ],\n  nachmittag: [\n    `Hallo ${vorname}! ğŸ˜Š Wie kann ich dir helfen?`,\n    `Hi ${vorname}! ğŸ˜Š SchÃ¶n von dir zu hÃ¶ren.`,\n    `Hallo ${vorname}, freut mich! ğŸ˜Š Was steht an?`,\n    `Hi ${vorname}! ğŸ˜Š Was kann ich fÃ¼r dich tun?`,\n  ],\n  abend: [\n    `Guten Abend ${vorname}! ğŸ˜Š SchÃ¶n, dass du dich meldest.`,\n    `Hallo ${vorname}! ğŸ˜Š SchÃ¶nen Abend dir â€“ was kann ich fÃ¼r dich tun?`,\n    `Guten Abend ${vorname}! ğŸ˜Š Wie kann ich dir weiterhelfen?`,\n    `Hi ${vorname}, schÃ¶n von dir zu hÃ¶ren! ğŸ˜Š`,\n  ],\n  nacht: [\n    `Hallo ${vorname}! ğŸ˜Š SchÃ¶n, dass du schreibst.`,\n    `Hi ${vorname}! ğŸ˜Š Was kann ich fÃ¼r dich tun?`,\n    `Hallo ${vorname}, freut mich von dir zu hÃ¶ren! ğŸ˜Š`,\n  ],\n};\n\nconst variants = map[tageszeit] || [`Hey ${vorname}! ğŸ˜Š Was kann ich fÃ¼r dich tun?`];\nconst begruessung = variants[Math.floor(Math.random() * variants.length)];\n\nconst alterText = (alter !== null && alter !== undefined) ? String(alter) : 'unbekannt';\nconst zaehneText = (fehlende_zaehne !== null && fehlende_zaehne !== undefined) ? String(fehlende_zaehne) : 'unbekannt';\n\nconst alterBekannt = alterText !== 'unbekannt';\nconst zaehneBekannt = zaehneText !== 'unbekannt';\nconst beideBekannt = alterBekannt && zaehneBekannt;\n\nconst linkBasis = 'https://zahnguard.versicherungs-jaeger.eu/';\nlet personalisierterLink = '';\nlet linkAnweisung = '';\nif (alterText !== 'unbekannt' && zaehneText !== 'unbekannt') {\n  personalisierterLink = `${linkBasis}?name=${encodeURIComponent(vorname + \" \" + nachname)}&age=${alter}&teeth=${fehlende_zaehne}`;\n  linkAnweisung = 'FERTIGER LINK - sofort senden!';\n} else {\n  personalisierterLink = 'NOCH NICHT FERTIG';\n  linkAnweisung = 'BAUE DEN LINK SELBST, sobald du Alter UND fehlende Zaehne hast!';\n}\n\nlet qualifizierungsAnweisung = '';\nif (beideBekannt) {\n  qualifizierungsAnweisung = `\nâœ…âœ…âœ… DATEN BEREITS VOLLSTÃ„NDIG! âœ…âœ…âœ…\nAlter: ${alterText} Jahre | Fehlende ZÃ¤hne: ${zaehneText}\nâš ï¸ ABSOLUTE PFLICHT: Frage NIEMALS nochmal danach! Gehe SOFORT zu Schritt 3 (Preis nennen)!\nDer Kunde hat diese Daten SCHON eingegeben - nochmal fragen wÃ¤re unhÃ¶flich.`;\n} else if (alterBekannt) {\n  qualifizierungsAnweisung = `\nâœ… Alter bereits bekannt: ${alterText} Jahre\nâŒ Fehlende ZÃ¤hne: NOCH UNBEKANNT\nFrage NUR nach fehlenden ZÃ¤hnen! Alter ist schon da.`;\n} else if (zaehneBekannt) {\n  qualifizierungsAnweisung = `\nâŒ Alter: NOCH UNBEKANNT\nâœ… Fehlende ZÃ¤hne bereits bekannt: ${zaehneText}\nFrage NUR nach dem Alter! Fehlende ZÃ¤hne sind schon bekannt.`;\n} else {\n  qualifizierungsAnweisung = `\nâŒ Alter: UNBEKANNT | âŒ Fehlende ZÃ¤hne: UNBEKANNT\nDu musst BEIDES erst erfragen, bevor du einen Preis nennen kannst.`;\n}\n\nconst systemPrompt = `DU BIST OLIVER â€“ Ein lockerer, sympathischer Versicherungsberater bei der Allianz Agentur Sven Jaeger. Du chattest per WhatsApp mit Kunden.\n\nWICHTIG: Du bist KEIN Bot und KEINE KI. Du bist Oliver, ein echter Mensch. ErwÃ¤hne das niemals.\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½â•â•â•â•â•â•â•â•â•â•â•\nDEINE PERSÃ–NLICHKEIT\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nDu bist Oliver. Mitte 30, kompetent und nahbar. Du bist Versicherungsexperte mit Herz â€“ kein steifer AnzugtrÃ¤ger, aber auch kein Jugendlicher. Du berÃ¤tst professionell, bist dabei aber warm und persÃ¶nlich. Der Kunde soll sich gut aufgehoben fÃ¼hlen, wie bei einem freundlichen Berater, dem man vertraut.\n\nDein Stil:\nâ€¢ Professionell, aber persÃ¶nlich â€“ du duzst und bist nahbar, bleibst aber seriÃ¶s\nâ€¢ Du erklÃ¤rst Dinge verstÃ¤ndlich, ohne belehrend zu wirken\nâ€¢ Du wiederholst dich NIE â€“ jede Antwort ist frisch formuliert\nâ€¢ Du nutzt natÃ¼rliche Sprache: \"ehrlich gesagt\", \"ganz offen\", \"zwischen uns gesagt\", \"ich sag mal so\"\nâ€¢ Du schreibst wie ein echter Mensch â€“ nicht perfekt durchgestylt, aber auch nicht flapsig\nâ€¢ Du reagierst auf das, was der Kunde sagt â€“ mit echtem Interesse\nâ€¢ Wenn jemand Bedenken hat, gehst du ernsthaft darauf ein statt abzuwiegeln\nâ€¢ Ab und zu darf ein kleiner Witz rein â€“ aber dezent, nicht in jeder Nachricht\n\nTONFALL-REGELN:\nâœ… Professionell und gleichzeitig nahbar â€“ wie ein guter Bekannter, der Experte ist\nâœ… Variiere deine Formulierungen â€“ nie zweimal das Gleiche\nâœ… Zeig echtes Interesse am Menschen und seiner Situation\nâœ… Emojis: Dezent einsetzen â€“ 1-2 pro Nachricht reichen, nicht nach jedem Satz\nâœ… Stell Gegenfragen die zeigen dass du zuhÃ¶rst und mitdenkst\nâœ… Humor ja, aber situationsangemessen â€“ nicht erzwungen\nâœ… JEDE Nachricht endet mit einer Frage oder klarem nÃ¤chsten Schritt\nâœ… Schreib ruhig ausfÃ¼hrlicher wenn du berÃ¤tst oder erklÃ¤rst â€“ 5-8 SÃ¤tze sind vÃ¶llig in Ordnung wenn es dem Kunden Mehrwert bringt. Hauptsache es klingt nach echtem GesprÃ¤ch.\n\nâŒ NIEMALS: \"Ich verstehe deine Bedenken\" (klingt nach Callcenter-Skript)\nâŒ NIEMALS: \"Gerne helfe ich Ihnen dabei\" (zu formell)\nâŒ NIEMALS: \"Vielen Dank fÃ¼r Ihre Nachricht\" (Roboter-Sprache)\nâŒ NIEMALS: Slang oder Jugendsprache (\"krass\", \"digga\", \"alter\", \"safe\", \"lit\")\nâŒ NIEMALS: AufzÃ¤hlungen mit Bulletpoints in WhatsApp (wirkt wie Copy-Paste)\nâŒ NIEMALS: Markdown-Links wie [Text](URL) â€“ WhatsApp zeigt das DOPPELT an!\nâŒ NIEMALS: [Hier klicken](https://...) oder [Link](www...) â€“ VERBOTEN!\nâŒ NIEMALS: Eckige Klammern [] um Links oder Text vor Links in Klammern!\nâœ… Links IMMER als nackten Plain Text senden, OHNE Klammern, OHNE Formatierung!\nâœ… RICHTIG: Schau mal hier rein: www.example.de\nâŒ FALSCH: [Schau mal hier](www.example.de)\nâŒ FALSCH: Hier dein Link: [www.example.de](www.example.de)\nâŒ NIEMALS: Auf Englisch antworten - immer Deutsch!\nâŒ NIEMALS: Zugeben dass du ein Bot/KI bist\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nKUNDENDATEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nVorname: ${vorname}\nNachname: ${nachname}\nAlter: ${alterText}\nFehlende ZÃ¤hne: ${zaehneText}\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nPRODUKTE\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nDrei Zahnzusatz-Tarife der Allianz:\nâ€¢ MeinZahn75 (75% Erstattung)\nâ€¢ MeinZahn90 (90% Erstattung)\nâ€¢ MeinZahn100 (100% Erstattung â€“ Rundum-sorglos)\n\nHighlights die du beilÃ¤ufig erwÃ¤hnen kannst:\nâ†’ Zahnersatz komplett abgedeckt (Kronen, BrÃ¼cken, Implantate)\nâ†’ 2x Zahnreinigung pro Jahr inklusive\nâ†’ Keine Wartezeit â€“ Schutz gilt ab Tag 1\nâ†’ Nach 2 Jahren monatlich kÃ¼ndbar â€“ kein Risiko\n\nPreise: Nutze die PREISTABELLE weiter unten!\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nPREISTABELLE (VERBINDLICH!)\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâš ï¸ Nutze IMMER diese Tabelle! Der Vector Store ist nur fÃ¼r allgemeine Infos.\n\nBASISPREISE (monatlich, 0 fehlende ZÃ¤hne):\nAlter        | MeinZahn75 | MeinZahn90 | MeinZahn100\n0-20 Jahre   |  8,43 EUR  | 13,15 EUR  | 17,47 EUR\n21-30 Jahre  | 12,94 EUR  | 15,89 EUR  | 18,77 EUR\n31-40 Jahre  | 17,39 EUR  | 23,58 EUR  | 29,88 EUR\n41-50 Jahre  | 21,55 EUR  | 31,56 EUR  | 41,73 EUR\n51-60 Jahre  | 27,10 EUR  | 41,89 EUR  | 56,93 EUR\n61-65 Jahre  | 30,64 EUR  | 48,04 EUR  | 65,63 EUR\n\nMIT FEHLENDEN ZÃ„HNEN (monatlich):\nAlter + fehl. ZÃ¤hne  | MeinZahn75 | MeinZahn90 | MeinZahn100\n0-20,  1 fehlend      | 10,54 EUR  | 16,44 EUR  | 21,84 EUR\n0-20,  2 fehlend      | 12,65 EUR  | 19,73 EUR  | 26,21 EUR\n0-20,  3 fehlend      | 14,76 EUR  | 23,02 EUR  | 30,58 EUR\n21-30, 1 fehlend      | 16,18 EUR  | 19,86 EUR  | 23,46 EUR\n21-30, 2 fehlend      | 19,42 EUR  | 23,83 EUR  | 28,15 EUR\n21-30, 3 fehlend      | 22,66 EUR  | 27,80 EUR  | 32,84 EUR\n31-40, 1 fehlend      | 21,74 EUR  | 29,48 EUR  | 37,35 EUR\n31-40, 2 fehlend      | 26,09 EUR  | 35,38 EUR  | 44,82 EUR\n31-40, 3 fehlend      | 30,44 EUR  | 41,28 EUR  | 52,29 EUR\n41-50, 1 fehlend      | 26,94 EUR  | 39,45 EUR  | 52,16 EUR\n41-50, 2 fehlend      | 32,33 EUR  | 47,34 EUR  | 62,59 EUR\n41-50, 3 fehlend      | 37,72 EUR  | 55,23 EUR  | 73,02 EUR\n51-60, 1 fehlend      | 33,88 EUR  | 52,36 EUR  | 71,16 EUR\n51-60, 2 fehlend      | 40,66 EUR  | 62,83 EUR  | 85,39 EUR\n51-60, 3 fehlend      | 47,44 EUR  | 73,30 EUR  | 99,62 EUR\n61-65, 1 fehlend      | 38,30 EUR  | 60,05 EUR  | 82,04 EUR\n61-65, 2 fehlend      | 45,96 EUR  | 72,06 EUR  | 98,45 EUR\n61-65, 3 fehlend      | 53,62 EUR  | 84,07 EUR  | 114,86 EUR\n\nSO FINDEST DU DEN RICHTIGEN PREIS:\n1. Altersgruppe bestimmen (z.B. 40 = \"31-40 Jahre\")\n2. 0 fehlende ZÃ¤hne â†’ BASISPREIS // 1-3 fehlend â†’ Tabelle MIT FEHLENDEN ZÃ„HNEN\n3. Nenne NUR den empfohlenen Tarif, nicht alle drei!\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nTARIFEMPFEHLUNG\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nEmpfiehl immer NUR EINEN Tarif:\nâ€¢ Unter 30 â†’ MeinZahn90 (bestes Preis-Leistungs-VerhÃ¤ltnis)\nâ€¢ 30-65 â†’ MeinZahn100 (Rundum-sorglos, lohnt sich langfristig)\n\nâš ï¸ Nenne NICHT alle drei Tarife! Nur den empfohlenen.\nWenn der Kunde fragt, kannst du die anderen erwÃ¤hnen â€“ aber erst dann.\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nQUALIFIZIERUNG\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nBevor du einen Preis nennst, brauchst du ZWINGEND:\nâœ… Alter des Kunden\nâœ… Fehlende ZÃ¤hne (auÃŸer WeisheitszÃ¤hne)\n${qualifizierungsAnweisung}\n\nABLAUF:\n1. BEIDE fehlen â†’ Frage geschickt und natÃ¼rlich danach\n2. NUR Alter bekannt â†’ Frage nach fehlenden ZÃ¤hnen\n3. NUR ZÃ¤hne bekannt â†’ Frage nach Alter\n4. BEIDE bekannt â†’ SOFORT Preis + personalisierten Link!\n\nâš ï¸ NIEMALS Preis nennen wenn eine Info fehlt!\nâš ï¸ NIEMALS nach bereits bekannten Daten fragen!\n\nWIE du nach den Daten fragst (Beispiele â€“ VARIIERE immer!):\nNach Alter:\nâ†’ \"Kurze Frage noch â€“ wie alt bist du?\"\nâ†’ \"Damit ich dir deinen persÃ¶nlichen Preis raussuchen kann: In welchem Alter bist du?\"\nâ†’ \"Sag mal, wie alt bist du eigentlich? Brauch ich fÃ¼r den Preis ğŸ˜Š\"\n\nNach fehlenden ZÃ¤hnen:\nâ†’ \"Und fehlen dir ZÃ¤hne? Also ZÃ¤hne die gezogen oder verloren wurden â€“ WeisheitszÃ¤hne zÃ¤hlen da nicht mit.\"\nâ†’ \"Noch eine kurze Frage: Wurden bei dir schon mal ZÃ¤hne gezogen? WeisheitszÃ¤hne mal ausgenommen.\"\nâ†’ \"Darf ich noch fragen, ob alle ZÃ¤hne noch da sind? WeisheitszÃ¤hne zÃ¤hlen nicht mit ğŸ˜Š\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nLINKS\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nğŸ—‚ï¸ VISITENKARTE (bei erster Nachricht):\nwww.allianz-svenjaeger.de/Visitenkarte\n\nğŸ“‹ ALLGEMEINE ÃœBERSICHT (wenn Kunde Infos will, Alter/ZÃ¤hne noch unbekannt):\nhttps://zahnguard.versicherungs-jaeger.eu/\n\nğŸ¯ PERSONALISIERTER LINK:\nStatus: ${linkAnweisung}\n${personalisierterLink !== 'NOCH NICHT FERTIG' ? 'Fertiger Link: ' + personalisierterLink : ''}\n\nğŸ”§ URL-BAUKASTEN:\nBasis: ${linkBasis}\nSchema: [Basis]?name=${encodeURIComponent(vorname + \" \" + nachname)}&age=ALTER&teeth=ANZAHL\n\nSO BAUST DU DEN LINK:\n1. Alter UND fehlende ZÃ¤hne bekannt?\n2. ALTER = Alter des Kunden, ANZAHL = fehlende ZÃ¤hne (0, 1, 2, 3 oder mehr-als-3)\n3. Sende als Plain Text!\n\nBeispiel fÃ¼r 40 Jahre, 0 fehlende:\n${linkBasis}?name=${encodeURIComponent(vorname + \" \" + nachname)}&age=40&teeth=0\n\nâš ï¸ IMMER den personalisierten Link MIT dem Preis senden!\nâš ï¸ Wenn fertiger Link oben steht â†’ nutze diesen. Sonst â†’ baue ihn selbst!\n\nğŸ“… TERMINBUCHUNG (nur wenn Kunde will):\nwww.allianz-svenjaeger.de/termin\n\nğŸ“ DIREKTER ANTRAG (wenn Kunde abschlieÃŸen will):\nwww.allianz-svenjaeger.de/AntragMeinZahn\n\nğŸ“„ PDF-ANGEBOT (wenn Kunde schriftliches Angebot mÃ¶chte):\nhttp://zahnangebot.versicherungs-jaeger.eu/\n\nâ­ BEWERTUNG (am Ende einer guten Beratung / nach Abschluss):\nwww.allianz-svenjaeger.de/Bewertung\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nBEGRÃœSSUNG (NUR EINMAL!)\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâš ï¸ Check den Chatverlauf! Wenn du schon begrÃ¼ÃŸt hast â†’ NICHT nochmal!\n\nErste Nachricht: \"${begruessung}\"\nDann Visitenkarte anhÃ¤ngen: www.allianz-svenjaeger.de/Visitenkarte\n\nâš ï¸ WICHTIG: Der Kunde ist als ZAHNVERSICHERUNG-Interessent gelabelt.\nDu weiÃŸt, dass es um Zahnversicherung geht. Aber geh NICHT sofort ins VerhÃ¶r!\n\nDEIN EINSTIEG soll sich anfÃ¼hlen wie ein echtes GesprÃ¤ch:\nâ†’ BestÃ¤tige kurz das Thema, dann frag erstmal wie der Kunde aktuell versichert ist oder was ihn dazu gebracht hat sich zu melden.\nâ†’ Zeig echtes Interesse an seiner Situation BEVOR du nach Alter und ZÃ¤hnen fragst.\n\nBeispiele fÃ¼r den Einstieg (VARIIERE!):\nâ†’ \"Zahnversicherung, richtig? Da bist du bei mir genau richtig! ğŸ˜Š Sag mal, hast du dich schon mal damit beschÃ¤ftigt oder ist das ganz neu fÃ¼r dich?\"\nâ†’ \"Ah, Zahnversicherung! Super Thema ğŸ˜Š Was hat dich denn dazu gebracht, dich da mal umzuschauen?\"\nâ†’ \"Wegen der Zahnzusatzversicherung, richtig? Top! ğŸ˜Š Bist du aktuell schon irgendwo versichert oder wÃ¤re das komplett neu?\"\n\nDANACH erst im natÃ¼rlichen GesprÃ¤chsfluss die Qualifizierung einbauen.\nNICHT sofort: \"Wie alt bist du und wie viele ZÃ¤hne fehlen dir?\"\nSONDERN: Lass es sich aus dem GesprÃ¤ch ergeben. Wenn der Kunde z.B. von einem Zahnarztbesuch erzÃ¤hlt, frag beilÃ¤ufig nach.\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nGESPRÃ„CHSABLAUF & BERATUNGSSTRATEGIE\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nDu bist nicht nur Auskunft â€“ du bist BERATER. Dein Ziel ist es, dem Kunden wirklich zu helfen und ihn dabei zum Abschluss zu fÃ¼hren. Nicht mit Druck, sondern mit echter Beratung und Mehrwert.\n\nPHASEN:\n\n1ï¸âƒ£ BEGRÃœSSUNG + VISITENKARTE\nâ†’ Locker, persÃ¶nlich, Interesse zeigen\n\n2ï¸âƒ£ QUALIFIZIERUNG (geschickt einbauen, kein VerhÃ¶r!)\nâ†’ Alter + fehlende ZÃ¤hne erfragen â€“ aber im natÃ¼rlichen GesprÃ¤chsfluss\n\n3ï¸âƒ£ ECHTE BERATUNG + PREIS + LINK\nâ†’ Nicht nur Preis nennen! ErklÃ¤re WARUM du diesen Tarif empfiehlst.\nâ†’ Geh auf die persÃ¶nliche Situation des Kunden ein.\nâ†’ Rechne vor was eine Behandlung ohne Versicherung kosten wÃ¼rde.\nâ†’ Zeig den Mehrwert: \"Allein die 2 Zahnreinigungen pro Jahr sind schon Xâ‚¬ wert\"\nâ†’ Sende IMMER den personalisierten Link MIT der Beratung!\nâ†’ Hier darfst du gerne ausfÃ¼hrlicher schreiben â€“ das ist der wichtigste Teil!\n\n4ï¸âƒ£ AKTIV ZUM ABSCHLUSS FÃœHREN\nâ†’ Frag KONKRET ob der Kunde abschlieÃŸen mÃ¶chte!\nâ†’ Mach es ihm leicht: \"Soll ich dir den Antrag schicken? Dauert nur 2 Minuten online.\"\nâ†’ Wenn er zÃ¶gert: EinwÃ¤nde behandeln, nochmal Mehrwert betonen\nâ†’ Wenn er will: Antragslink senden â†’ www.allianz-svenjaeger.de/AntragMeinZahn\nâ†’ Sei hartnÃ¤ckig aber sympathisch â€“ nicht aufdringlich, aber bestimmt!\n\n5ï¸âƒ£ BEWERTUNG ERFRAGEN (NUR NACH ABSCHLUSS ODER GUTER BERATUNG!)\nâ†’ Wenn der Kunde zufrieden war, abgeschlossen hat, oder das GesprÃ¤ch positiv endet:\nâ†’ Frag freundlich nach einer Google-Bewertung!\nâ†’ Link: www.allianz-svenjaeger.de/Bewertung\nâ†’ Beispiele (VARIIERE!):\n  \"Eine Sache noch, ${vorname} â€“ wenn du mit der Beratung zufrieden warst, wÃ¼rde ich mich wirklich Ã¼ber eine kurze Google-Bewertung freuen. Das hilft uns sehr! ğŸ˜Š Dauert nur 30 Sekunden: www.allianz-svenjaeger.de/Bewertung\"\n  \"Falls du kurz Zeit findest: Eine ehrliche Bewertung bei Google wÃ¤re fÃ¼r uns wirklich wertvoll. Hier der Link: www.allianz-svenjaeger.de/Bewertung â­\"\n  \"${vorname}, wenn du magst â€“ eine kurze Bewertung bei Google wÃ¼rde uns sehr freuen ğŸ˜Š www.allianz-svenjaeger.de/Bewertung\"\n\nâš ï¸ WICHTIG zur Bewertung:\nâ†’ NICHT zu frÃ¼h fragen â€“ erst wenn das GesprÃ¤ch abgeschlossen ist\nâ†’ NICHT wenn der Kunde genervt oder unzufrieden war\nâ†’ Am besten als letzte Nachricht im GesprÃ¤ch\nâ†’ Locker und ohne Druck formulieren\n\nABSCHLUSS-TIPPS:\nâ†’ \"Soll ich dir den Antrag rÃ¼berschicken?\" ist besser als \"Hast du noch Fragen?\"\nâ†’ Mach konkrete VorschlÃ¤ge statt offene Fragen: \"Ich wÃ¼rde sagen, wir machen das! ğŸ˜Š\"\nâ†’ Wenn der Kunde sagt \"klingt gut\" oder \"interessant\" â†’ DAS ist dein Moment! Direkt Antragslink.\nâ†’ Bei Unentschlossenen: \"WeiÃŸt du was, schau dir das Angebot in Ruhe an und wenn du morgen noch magst, klick einfach drauf. Kein Druck!\"\n\nWenn oben \"DATEN BEREITS VOLLSTÃ„NDIG\" steht â†’ Spring direkt zu 3!\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nKAUFSIGNALE & REAKTIONEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nReagiere NATÃœRLICH auf Kaufsignale â€“ hier Ideen, aber VARIIERE immer:\n\n\"Was kostet das?\"\nâ†’ Super, lass mich dir das raussuchen! (Dann qualifizieren falls nÃ¶tig)\n\n\"Wie schnell geht das?\"\nâ†’ \"Sofort! 2 Minuten Antrag online und du bist abgesichert. Soll ich dir den Link schicken?\"\n\n\"Klingt gut\"\nâ†’ \"Das freut mich! ğŸ˜Š Soll ich dir den Antragslink schicken? Dauert wirklich nur 2 Minuten.\"\n\n\"Ich Ã¼berleg noch\"\nâ†’ \"NatÃ¼rlich, lass dir ruhig Zeit! Hier dein Angebot zum Durchschauen: [LINK]\"\n\n\"Schick mir das mal schriftlich\"\nï¿½ï¿½ \"Klar, mach ich! Hier dein PDF: http://zahnangebot.versicherungs-jaeger.eu/ ğŸ“„\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nEINWANDBEHANDLUNG â€“ NATÃœRLICH & EHRLICH\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nğŸ’° \"Zu teuer\":\nMÃ¶gliche Reaktionen (variiere!):\nâ†’ \"Das kann ich nachvollziehen. Lass mich mal kurz gegenrechnen: Eine Krone kostet schnell 500-800â‚¬, ein Implantat sogar 3.000â‚¬ und mehr. Mit [PREIS]â‚¬ im Monat bist du fÃ¼r all das abgesichert â€“ und das rechnet sich oft schon nach einer einzigen Behandlung.\"\nâ†’ \"Ganz ehrlich: Solange alles gut ist mit den ZÃ¤hnen, fÃ¼hlt sich jeder Beitrag viel an. Aber wenn dann doch mal was kommt â€“ und das kommt bei den meisten irgendwann â€“ sprechen wir schnell von mehreren tausend Euro. Da relativiert sich der Beitrag schnell.\"\nâ†’ \"Da darf ich dir eins dazu sagen: Allein eine professionelle Zahnreinigung kostet 80-120â‚¬. Mit dem Tarif bekommst du zwei pro Jahr inklusive â€“ das allein ist schon fast den Beitrag wert.\"\n\nğŸ¤” \"Muss ich Ã¼berlegen\":\nâ†’ \"NatÃ¼rlich, lass dir ruhig Zeit! Hier ist dein persÃ¶nliches Angebot zum Durchschauen: [LINK] â€“ und wenn du Fragen hast, meld dich einfach bei mir ğŸ˜Š\"\nâ†’ \"Klar, kein Problem. Dein Angebot lÃ¤uft nicht weg: [LINK] â€“ schau es dir in Ruhe an und schreib mir, wenn noch etwas unklar ist.\"\n\nâœ… \"Habe schon eine Versicherung\":\nâ†’ \"Sehr gut, dass du da schon vorgesorgt hast! ğŸ‘ Darf ich kurz fragen: Was genau deckt die ab? Gerade beim Zahnersatz gibt es oft groÃŸe Unterschiede bei der Erstattung.\"\nâ†’ \"Das freut mich! WeiÃŸt du zufÃ¤llig, wie viel Prozent die bei Zahnersatz oder Implantaten Ã¼bernimmt? Das ist meistens der entscheidende Punkt.\"\n\nâŒ \"Brauche ich nicht\":\nâ†’ \"Das hoffe ich fÃ¼r dich! ğŸ˜Š Aber nur als Info: Wenn irgendwann doch mal ein Implantat nÃ¶tig wird, sind wir schnell bei 3.000â‚¬ aufwÃ¤rts. Muss man natÃ¼rlich selbst abwÃ¤gen, aber gut zu wissen.\"\nâ†’ \"Kann ich verstehen. Die meisten denken so, bis dann die erste grÃ¶ÃŸere Rechnung vom Zahnarzt kommt. Aber klar â€“ ist natÃ¼rlich deine Entscheidung, und ich respektiere das.\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nHÃ„UFIGE FRAGEN\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nWartezeit?\nâ†’ \"Es gibt keine Wartezeit â€“ der Schutz gilt ab dem ersten Tag.\"\n\nVertragslaufzeit?\nâ†’ \"Die Mindestlaufzeit ist 2 Jahre. Danach kannst du monatlich kÃ¼ndigen, also ganz flexibel.\"\n\nLaufende Behandlung?\nâ†’ \"Ehrlich gesagt: Was bereits in Behandlung ist, kann leider nicht mehr versichert werden. Aber alles Neue ab Vertragsbeginn ist komplett abgedeckt.\"\n\nZahnspange?\nâ†’ \"FÃ¼r Kinder ja, das ist mit drin. FÃ¼r Erwachsene leider nicht â€“ das lÃ¤uft Ã¼ber die gesetzliche Kasse.\"\n\nImplantate?\nâ†’ \"Ja, auf jeden Fall! Beim MeinZahn100 werden sogar 100% der Kosten Ã¼bernommen. Gerade bei Implantaten macht das einen riesigen Unterschied.\"\n\nBleaching?\nâ†’ \"Ja, Bleaching ist bei allen drei Tarifen inklusive.\"\n\nPDF/Angebot?\nâ†’ \"SelbstverstÃ¤ndlich! Hier kannst du dir dein persÃ¶nliches Angebot als PDF erstellen: http://zahnangebot.versicherungs-jaeger.eu/ ğŸ“„\"\n\n\n`;\n\n\n// Tool-Anweisung fuer den User Prompt (Agent beachtet es hier besser!)\nconst toolAnweisung = `\nPFLICHT-TOOL: SUPERCHAT KONTAKT UPDATE\n=======================================\n\nDu MUSST das Tool \"Update an existing contact in Superchat\" aufrufen!\n\nWANN: Sobald du das Alter UND die fehlenden Zaehne des Kunden kennst.\nDie Contact-ID wird automatisch gesetzt.\n\nPARAMETER die du uebergeben musst:\n- zahnalter: Alter als Zahl (z.B. 42)\n- fehlende_zaehne: Anzahl fehlender Zaehne als Zahl (0 wenn keine fehlen)\n- personalisierter_link: Der Zahnguard-Link den du dem Kunden schickst\n\nABLAUF:\n1. Kunde nennt Alter und fehlende Zaehne\n2. Du berechnest den Tarif und erstellst den Link\n3. Du rufst ZUERST das Tool auf mit den Daten\n4. DANN antwortest du dem Kunden mit Tarif und Link\n\nWICHTIG: Das Tool MUSS aufgerufen werden, BEVOR du dem Kunden antwortest!\nOhne Tool-Aufruf gehen die Kundendaten verloren!`;\n\nreturn [{\n  json: {\n    ...$json,\n    begruessung,\n    systemPrompt,\n    personalisierterLink,\n    linkAnweisung,\n    linkBasis,\n    zahnalter: alter,\n    fehlende_zaehne: fehlende_zaehne,\n    chatInput: $json.nachricht + \"\\n\\n\" + toolAnweisung\n  }\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1776,
          336
        ],
        "id": "26fa3e45-77da-4273-bb00-ec6b24d16351",
        "name": "BegrÃ¼ÃŸung bauen"
      },
      {
        "parameters": {
          "resource": "message",
          "senderName": "Oliver",
          "identifier": "={{ $('Tageszeit').item.json.contactId }}",
          "channelId": {
            "__rl": true,
            "value": "mc_Ymwjl7M7NRM8hsxs6BkUE",
            "mode": "list",
            "cachedResultName": "WhatsApp: WhatsApp +4973319460350"
          },
          "replyToMessageId": {
            "__rl": true,
            "value": "=",
            "mode": ""
          },
          "content": {
            "text": {
              "value": "={{ $('Zahnversicherung').item.json.output }}"
            }
          }
        },
        "type": "n8n-nodes-superchat.superchat",
        "typeVersion": 1,
        "position": [
          3584,
          336
        ],
        "id": "d3d4776b-7202-4878-b196-6ccb4b5ac671",
        "name": "Send Message Zahnversicherung",
        "credentials": {
          "superchatApi": {
            "id": "CGalPTT8O4kdbp7o",
            "name": "Superchat account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// Daten aus Webhook extrahieren\nconst body = $input.first().json.body;\n\n// Aktuelle Zeit berechnen (Deutsche Zeitzone)\nconst now = new Date();\nconst deutscheZeit = new Date(now.toLocaleString('en-US', { timeZone: 'Europe/Berlin' }));\nconst stunde = deutscheZeit.getHours();\nconst minute = deutscheZeit.getMinutes();\n\n// Tageszeit bestimmen\nlet tageszeit = '';\nif (stunde >= 5 && stunde < 10) {\n  tageszeit = 'morgen';\n} else if (stunde >= 10 && stunde < 12) {\n  tageszeit = 'vormittag';\n} else if (stunde >= 12 && stunde < 14) {\n  tageszeit = 'mittag';\n} else if (stunde >= 14 && stunde < 17) {\n  tageszeit = 'nachmittag';\n} else if (stunde >= 17 && stunde < 21) {\n  tageszeit = 'abend';\n} else {\n  tageszeit = 'nacht';\n}\n\n// BÃ¼rostatus bestimmen\nlet bueroStatus = '';\nif (stunde >= 12 && stunde < 14) {\n  bueroStatus = 'mittagspause';\n} else if (stunde >= 17 || stunde < 8) {\n  bueroStatus = 'feierabend';\n} else if (stunde >= 8 && stunde < 17) {\n  bueroStatus = 'buerozeit';\n} else {\n  bueroStatus = 'geschlossen';\n}\n\nreturn {\n  conversationId: body.UnterhaltungsID || body.conversationId || null,\n  contactId: body.KontaktID || body.kontaktId || body.contactId || null,\n  label: body.Label || body.label || null,\n  vorname: body.Vorname || body.vorname || null,\n  nachname: body.Nachname || body.nachname || null,\n  nachricht: body.Nachricht || body.nachricht || null,\n  zahnalter: body.zahnalter ?? body.Zahnalter ?? null,\n  fehlende_zaehne: body.fehlende_zaehne ?? body.FehlendeZaehne ?? null,\n  timestamp: new Date().toISOString(),\n  \n  // Uhrzeit & Status\n  uhrzeit: `${stunde}:${minute < 10 ? '0' + minute : minute}`,\n  stunde: stunde,\n  tageszeit: tageszeit,\n  bueroStatus: bueroStatus\n};"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          80,
          -304
        ],
        "id": "6db7210e-9fd6-401f-8cc7-25113019437a",
        "name": "Tageszeit"
      },
      {
        "parameters": {
          "jsCode": "// Lead-Scoring System fÃ¼r Zahnversicherung\n// Die Kundennachricht kommt aus BegrÃ¼ÃŸung bauen\nconst input = $input.first().json;\nconst nachricht = ($('BegrÃ¼ÃŸung bauen').first().json.nachricht || '').toLowerCase();\nconst agentOutput = (input.output || '').toLowerCase();\n\n// Basis-Score\nlet score = 10;\nlet signals = [];\n\n// +15 Punkte: Alter angegeben\nif (/\\d+\\s*(jahre?|j\\.)/.test(nachricht) || /\\d+/.test(nachricht)) {\n  score += 15;\n  signals.push('alter_angegeben');\n}\n\n// +15 Punkte: Zahninfo angegeben\nif (/\\d+\\s*(z[Ã¤a]hne?|zahn|fehl)/.test(nachricht)) {\n  score += 15;\n  signals.push('zahninfo_angegeben');\n}\n\n// +25 Punkte: HeiÃŸe Signale (Dringlichkeit)\nif (['sofort', 'gleich', 'jetzt', 'heute', 'schnell', 'dringend', 'abschlieÃŸen', 'abschliessen'].some(w => nachricht.includes(w))) {\n  score += 25;\n  signals.push('dringlichkeit');\n}\n\n// +20 Punkte: Positive Reaktion\nif (['super', 'perfekt', 'klasse', 'danke', 'genau', 'top', 'ja', 'klingt gut', 'passt'].some(w => nachricht.includes(w))) {\n  score += 20;\n  signals.push('positive_reaktion');\n}\n\n// +15 Punkte: Preis-Interesse\nif (['preis', 'kosten', 'beitrag', 'gÃ¼nstiger', 'guenstiger', 'was kostet', 'euro', 'â‚¬', 'monat'].some(w => nachricht.includes(w))) {\n  score += 15;\n  signals.push('preis_interesse');\n}\n\n// +10 Punkte: Konkurrenz-Vergleich\nif (['ergo', 'huk', 'dkv', 'debeka', 'vergleich', 'andere', 'wechsel'].some(w => nachricht.includes(w))) {\n  score += 10;\n  signals.push('konkurrenz_vergleich');\n}\n\n// +20 Punkte: Agent hat Link geschickt (Kaufsignal)\nif (agentOutput.includes('zahnguard') || agentOutput.includes('versicherungs-jaeger')) {\n  score += 20;\n  signals.push('link_gesendet');\n}\n\n// +10 Punkte: Agent hat Preis genannt\nif (/\\d+[,.]\\d+\\s*â‚¬/.test(agentOutput) || agentOutput.includes('euro')) {\n  score += 10;\n  signals.push('preis_genannt');\n}\n\n// Lead-QualitÃ¤t bestimmen\nlet leadQuality, leadAction;\n\nif (score >= 70) {\n  leadQuality = 'hot';\n  leadAction = 'immediate_callback';\n} else if (score >= 40) {\n  leadQuality = 'warm';\n  leadAction = 'priority_followup';\n} else if (score >= 20) {\n  leadQuality = 'lukewarm';\n  leadAction = 'standard_followup';\n} else {\n  leadQuality = 'cold';\n  leadAction = 'none';\n}\n\nreturn [{\n  json: {\n    ...input,\n    lead_score: score,\n    lead_quality: leadQuality,\n    lead_action: leadAction,\n    lead_signals: signals.join(', ')\n  }\n}];"
        },
        "id": "a442275b-e028-46dd-bdf5-80c6fe8a4753",
        "name": "Lead Scoring",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2912,
          336
        ]
      },
      {
        "parameters": {
          "resource": "message",
          "senderName": "Oliver",
          "identifier": "={{ $('Tageszeit').first().json.contactId }}",
          "channelId": {
            "__rl": true,
            "value": "mc_Ymwjl7M7NRM8hsxs6BkUE",
            "mode": "list",
            "cachedResultName": "WhatsApp: WhatsApp +4973319460350"
          },
          "replyToMessageId": {
            "__rl": true,
            "value": "=",
            "mode": ""
          },
          "content": {
            "text": {
              "value": "={{ $('Tierkranken').item.json.output }}"
            }
          }
        },
        "type": "n8n-nodes-superchat.superchat",
        "typeVersion": 1,
        "position": [
          2912,
          -208
        ],
        "id": "f8de360a-256c-477f-8cf5-b9731671f898",
        "name": "Send Animalguard Message",
        "credentials": {
          "superchatApi": {
            "id": "CGalPTT8O4kdbp7o",
            "name": "Superchat account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "resource": "message",
          "senderName": "Oliver",
          "identifier": "={{ $('Tageszeit').item.json.contactId }}",
          "channelId": {
            "__rl": true,
            "value": "mc_Ymwjl7M7NRM8hsxs6BkUE",
            "mode": "list",
            "cachedResultName": "WhatsApp: WhatsApp +4973319460350"
          },
          "replyToMessageId": {
            "__rl": true,
            "value": "=",
            "mode": ""
          },
          "content": {
            "text": {
              "value": "={{ $('Bestandskunde').item.json.output }}"
            }
          }
        },
        "type": "n8n-nodes-superchat.superchat",
        "typeVersion": 1,
        "position": [
          2448,
          -1008
        ],
        "id": "7134aee5-6c6c-40c6-8dec-80cdfd2ade26",
        "name": "Send a message Bestandskunde",
        "credentials": {
          "superchatApi": {
            "id": "CGalPTT8O4kdbp7o",
            "name": "Superchat account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// Error Logger - Protokolliert fehlgeschlagene Superchat-Nachrichten\nconst items = $input.all();\nconst now = new Date().toLocaleString('de-DE', { timeZone: 'Europe/Berlin' });\n\nconst results = items.map(item => {\n  const data = item.json;\n  return {\n    json: {\n      timestamp: now,\n      error_type: 'send_message_failed',\n      error_message: data.error?.message || data.errorMessage || data.message || 'Unbekannter Fehler',\n      error_code: data.error?.httpCode || data.statusCode || 'N/A',\n      contactId: (() => { try { return $('Tageszeit').first().json.contactId; } catch(e) { return 'unknown'; } })(),\n      conversationId: (() => { try { return $('Tageszeit').first().json.conversationId; } catch(e) { return 'unknown'; } })(),\n      vorname: (() => { try { return $('Tageszeit').first().json.vorname; } catch(e) { return 'unknown'; } })(),\n      label: (() => { try { return $('Tageszeit').first().json.label; } catch(e) { return 'unknown'; } })(),\n      raw_error: JSON.stringify(data).substring(0, 500)\n    }\n  };\n});\n\nreturn results;"
        },
        "id": "error-logger-001",
        "name": "Error Logger",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3584,
          -608
        ]
      },
      {
        "parameters": {
          "operation": "upsert",
          "dataTableId": {
            "__rl": true,
            "value": "YV7BinrM1EYymve5",
            "mode": "list",
            "cachedResultName": "DataBase-Superchat",
            "cachedResultUrl": "/projects/ky4N6Ac6hIljevFz/datatables/YV7BinrM1EYymve5"
          },
          "matchType": "allConditions",
          "filters": {
            "conditions": [
              {
                "keyName": "conversationId",
                "keyValue": "={{ $json.conversationId }}"
              }
            ]
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "conversationId": "={{ $json.conversationId }}",
              "contactId": "={{ $json.contactId }}",
              "vorname": "={{ $json.vorname }}",
              "label": "={{ $json.label }}",
              "notizen": "={{ 'FEHLER ' + $json.timestamp + ': ' + $json.error_message }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "conversationId",
                "type": "string"
              },
              {
                "id": "contactId",
                "type": "string"
              },
              {
                "id": "vorname",
                "type": "string"
              },
              {
                "id": "label",
                "type": "string"
              },
              {
                "id": "notizen",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "error-upsert-001",
        "name": "Log Error to DataTable",
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 2,
        "position": [
          3808,
          -608
        ]
      },
      {
        "parameters": {
          "jsCode": "// Superchat Contact Update + Lead Score Notiz\r\n// v3: Uses fetch() instead of require('https') for n8n compatibility\r\nconst SUPERCHAT_API_KEY = 'b1a87b53-ba2c-4967-b903-e7b7369340ae';\r\n\r\nconst results = [];\r\n\r\nfor (const item of $input.all()) {\r\n  const input = item.json;\r\n  const bgData = $('BegrÃ¼ÃŸung bauen').first().json;\r\n  const contactId = bgData.contactId;\r\n  const conversationId = bgData.conversationId;\r\n  const agentOutput = input.output || '';\r\n  const nachricht = bgData.nachricht || '';\r\n  const allText = nachricht + ' ' + agentOutput;\r\n\r\n  // === 1. Daten sammeln: BegrÃ¼ÃŸung > Agent-Output > Nachricht ===\r\n  let zahnalter = 0;\r\n  let fehlende_zaehne = -1;\r\n  let personalisierterLink = '';\r\n\r\n  // --- QUELLE 1: BegrÃ¼ÃŸung bauen (URL-Params/DB) ---\r\n  const bgAlter = parseInt(bgData.zahnalter);\r\n  if (bgAlter > 0 && bgAlter <= 99) zahnalter = bgAlter;\r\n\r\n  const bgZaehne = parseInt(bgData.fehlende_zaehne);\r\n  if (!isNaN(bgZaehne) && bgZaehne >= 0) fehlende_zaehne = bgZaehne;\r\n\r\n  if (bgData.personalisierterLink && bgData.personalisierterLink !== 'NOCH NICHT FERTIG') {\r\n    personalisierterLink = bgData.personalisierterLink;\r\n  }\r\n\r\n  // --- QUELLE 2: Agent-Output ---\r\n  if (zahnalter === 0) {\r\n    const alterPatterns = [\r\n      /(?:bei|mit|bist|sind|alter)\\s*(?::|von)?\\s*(\\d{2,3})\\s*(?:jahre?|j\\.)?/i,\r\n      /(\\d{2,3})\\s*jahre?\\s*alt/i,\r\n      /(\\d{2,3})[-\\s]*j[Ã¤a]hrig/i\r\n    ];\r\n    for (const p of alterPatterns) {\r\n      const m = agentOutput.match(p);\r\n      if (m) {\r\n        const a = parseInt(m[1]);\r\n        if (a >= 18 && a <= 99) { zahnalter = a; break; }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (fehlende_zaehne < 0) {\r\n    if (/keine.*fehlende.*z[Ã¤a]hne?|kein.*zahn.*fehl|alle.*z[Ã¤a]hne.*vorhanden|0\\s*fehlende|allen\\s*z[Ã¤a]hne/i.test(allText)) {\r\n      fehlende_zaehne = 0;\r\n    }\r\n    if (fehlende_zaehne < 0) {\r\n      const zaehnePatterns = [\r\n        /(\\d)\\s*(?:fehlende?r?)?\\s*z[Ã¤a]hne?/i,\r\n        /fehlende?r?\\s*z[Ã¤a]hne?\\s*(?::|=)?\\s*(\\d)/i,\r\n        /(\\d)\\s*z[Ã¤a]hne?\\s*fehl/i\r\n      ];\r\n      for (const p of zaehnePatterns) {\r\n        const m = allText.match(p);\r\n        if (m) { fehlende_zaehne = Math.min(parseInt(m[1]), 3); break; }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Fallback Alter aus Nachricht\r\n  if (zahnalter === 0 && nachricht) {\r\n    const m = nachricht.match(/(\\d{2,3})\\s*(jahre?|j\\.|und)/i);\r\n    if (m) {\r\n      const a = parseInt(m[1]);\r\n      if (a >= 18 && a <= 99) zahnalter = a;\r\n    }\r\n  }\r\n\r\n  // Link: verschiedene Formate aus Agent-Output\r\n  if (!personalisierterLink) {\r\n    const linkPatterns = [\r\n      /https:\\/\\/zahnguard\\.versicherungs-jaeger\\.eu[^\\s)\\]\"'<]*/,\r\n      /\\(?(https:\\/\\/zahnguard\\.versicherungs-jaeger\\.eu[^)\\s]*)\\)?/,\r\n      /(?:www\\.)?zahnguard\\.versicherungs-jaeger\\.eu(\\/[^\\s)\\]\"'<]*)?/\r\n    ];\r\n    for (const p of linkPatterns) {\r\n      const m = agentOutput.match(p);\r\n      if (m) {\r\n        let link = m[1] || m[0];\r\n        link = link.replace(/^\\[|\\]$/g, '').replace(/^\\(|\\)$/g, '');\r\n        if (!link.startsWith('http')) link = 'https://' + link;\r\n        personalisierterLink = link;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (fehlende_zaehne < 0) fehlende_zaehne = 0;\r\n\r\n  // Fallback: Generate link from extracted data\r\n  if (!personalisierterLink && zahnalter > 0) {\r\n    const vorname = bgData.vorname || \"\";\r\n    const nachname_val = bgData.nachname || \"\";\r\n    const fullName = (vorname + \" \" + nachname_val).trim();\r\n    if (fullName) {\r\n      personalisierterLink = \"https://zahnguard.versicherungs-jaeger.eu/?name=\" + encodeURIComponent(fullName) + \"&age=\" + zahnalter + \"&teeth=\" + fehlende_zaehne;\r\n    }\r\n  }\r\n\r\n  console.log('[SC Update] contactId:', contactId, '| alter:', zahnalter, '| zaehne:', fehlende_zaehne, '| link:', personalisierterLink ? 'ja' : 'nein');\r\n\r\n  // === 2. Superchat Contact Update via fetch() ===\r\n  let superchatUpdated = false;\r\n  let superchatError = '';\r\n  let superchatResponse = null;\r\n\r\n  if (contactId && zahnalter > 0) {\r\n    try {\r\n      const attrs = [];\r\n      if (zahnalter > 0) attrs.push({ id: 'ca_CFmxU3aVP06z7ELmyspRg', value: String(zahnalter) });\r\n      attrs.push({ id: 'ca_ktjlYFH8zBid8PKq2fW0V', value: String(fehlende_zaehne) });\r\n      if (personalisierterLink) attrs.push({ id: 'ca_bcMfr9WB0Puf0PyGUFV1n', value: personalisierterLink });\r\n\r\n      console.log('[SC Update] PATCH attrs:', JSON.stringify(attrs));\r\n\r\n      const response = await fetch('https://api.superchat.com/v1.0/contacts/' + contactId, {\r\n        method: 'PATCH',\r\n        headers: {\r\n          'X-API-KEY': SUPERCHAT_API_KEY,\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({ custom_attributes: attrs })\r\n      });\r\n\r\n      const responseText = await response.text();\r\n      console.log('[SC Update] PATCH status:', response.status);\r\n      superchatUpdated = response.status >= 200 && response.status < 300;\r\n\r\n      try {\r\n        superchatResponse = JSON.parse(responseText);\r\n      } catch(e) {\r\n        superchatResponse = responseText;\r\n      }\r\n    } catch (e) {\r\n      console.log('[SC Update] PATCH error:', e.message);\r\n      superchatError = e.message;\r\n    }\r\n  } else {\r\n    console.log('[SC Update] Skip - no data. contactId:', !!contactId, 'alter:', zahnalter, 'zaehne:', fehlende_zaehne);\r\n    superchatError = 'Keine Daten: contactId=' + !!contactId + ' alter=' + zahnalter;\r\n  }\r\n\r\n  // === 3. Lead Score Notiz ===\r\n  if (conversationId && input.lead_score !== undefined) {\r\n    try {\r\n      const emoji = input.lead_quality === 'hot' ? 'ğŸ”¥' : input.lead_quality === 'warm' ? 'ğŸŸ¡' : input.lead_quality === 'lukewarm' ? 'ğŸŸ ' : 'â„ï¸';\r\n      let note = emoji + ' Lead Score: ' + input.lead_score + '/100 (' + input.lead_quality + ')';\r\n      note += '\\nğŸ“Š Aktion: ' + input.lead_action;\r\n      note += '\\nğŸ“Œ Signale: ' + (input.lead_signals || 'keine');\r\n      if (zahnalter > 0) note += '\\nğŸ¦· Alter: ' + zahnalter + ' | Fehlende ZÃ¤hne: ' + fehlende_zaehne;\r\n      if (personalisierterLink) note += '\\nğŸ”— Link: ' + personalisierterLink;\r\n\r\n      await fetch('https://api.superchat.com/v1.0/conversations/' + conversationId + '/notes', {\r\n        method: 'POST',\r\n        headers: {\r\n          'X-API-KEY': SUPERCHAT_API_KEY,\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({ content: note })\r\n      });\r\n    } catch (e) {\r\n      console.log('[SC Update] Note error:', e.message);\r\n    }\r\n  }\r\n\r\n  results.push({\r\n    json: {\r\n      ...input,\r\n      zahnalter,\r\n      fehlende_zaehne,\r\n      personalisierterLink,\r\n      superchat_updated: superchatUpdated,\r\n      superchat_error: superchatError || undefined,\r\n      superchat_response: superchatResponse || undefined\r\n    }\r\n  });\r\n}\r\n\r\nreturn results;\r\n"
        },
        "id": "superchat-update-code-001",
        "name": "Superchat Update",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3232,
          176
        ]
      },
      {
        "parameters": {
          "resource": "contact",
          "operation": "update",
          "id": "={{ $json.contactId }}",
          "emails": {
            "values": []
          },
          "phoneNumbers": {
            "values": []
          },
          "customAttributes": {
            "mappingMode": "defineBelow",
            "value": {
              "ca_CFmxU3aVP06z7ELmyspRg": "={{ $fromAI(\"zahnalter\", \"Das Alter des Kunden als Zahl, z.B. 35\", \"number\") }}",
              "ca_ktjlYFH8zBid8PKq2fW0V": "={{ $fromAI(\"fehlende_zaehne\", \"Anzahl fehlender ZÃ¤hne des Kunden als Zahl (0 wenn keine fehlen)\", \"number\") }}",
              "ca_bcMfr9WB0Puf0PyGUFV1n": "={{ $fromAI(\"personalisierter_link\", \"Der personalisierte Zahnguard-Link fÃ¼r den Kunden\", \"string\") }}"
            },
            "matchingColumns": [
              "ca_CFmxU3aVP06z7ELmyspRg",
              "ca_ktjlYFH8zBid8PKq2fW0V",
              "ca_bcMfr9WB0Puf0PyGUFV1n"
            ],
            "schema": [
              {
                "id": "ca_kPnmDDYq9XsWnO8vKlgY7",
                "displayName": "Geburtstag",
                "type": "dateTime",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "removed": false
              },
              {
                "id": "ca_UfMsBS9EHSM6PKpDpIOzs",
                "displayName": "JahresgesprÃ¤ch",
                "type": "dateTime",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "removed": false
              },
              {
                "id": "ca_1bgjzCjSIok6CmJ0Cd0Cf",
                "displayName": "EvB Nr.",
                "type": "string",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "removed": false
              },
              {
                "id": "ca_4a3QqHXjA1dffwkmoFPHA",
                "displayName": "Chatbot",
                "type": "options",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "options": [
                  {
                    "name": "Chatbot an",
                    "value": "Chatbot an"
                  },
                  {
                    "name": "Chatbot aus",
                    "value": "Chatbot aus"
                  }
                ],
                "removed": false
              },
              {
                "id": "ca_h5wpq6fE3LBoWDmA3Y6Py",
                "displayName": "Termin",
                "type": "dateTime",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "removed": false
              },
              {
                "id": "ca_G1g5L3UZoOHRpG5ENGr1O",
                "displayName": "Terminart",
                "type": "options",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "options": [
                  {
                    "name": "Termin beim Kunden",
                    "value": "Termin beim Kunden"
                  },
                  {
                    "name": "Termin fÃ¼r RÃ¼ckruf",
                    "value": "Termin fÃ¼r RÃ¼ckruf"
                  },
                  {
                    "name": "Termin im BÃ¼ro",
                    "value": "Termin im BÃ¼ro"
                  },
                  {
                    "name": "Termin vor Ort (Immobilien)",
                    "value": "Termin vor Ort (Immobilien)"
                  }
                ],
                "removed": false
              },
              {
                "id": "ca_SDiDtyIn6RZ5eXSGSbIzk",
                "displayName": "Terminort",
                "type": "string",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "removed": false
              },
              {
                "id": "ca_G2Us6NtOc2WHBJOQLLKT9",
                "displayName": "Flixcheck JahresgesprÃ¤ch Antwort",
                "type": "string",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "removed": false
              },
              {
                "id": "ca_X6o3AFgico6f3LR366kOT",
                "displayName": "Tiername",
                "type": "string",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "removed": false
              },
              {
                "id": "ca_Ealr176c7tIVQuWVx3fep",
                "displayName": "Tierrasse",
                "type": "string",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "removed": false
              },
              {
                "id": "ca_toAvVOIBTGcSVPfqurAkn",
                "displayName": "Tierkrankenheiten",
                "type": "options",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "options": [
                  {
                    "name": "Ja",
                    "value": "Ja"
                  },
                  {
                    "name": "Nein",
                    "value": "Nein"
                  }
                ],
                "removed": false
              },
              {
                "id": "ca_gYenMCz2MYWO6jJUwrbMv",
                "displayName": "Katzenhaltung",
                "type": "options",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "options": [
                  {
                    "name": "FreigÃ¤nger",
                    "value": "FreigÃ¤nger"
                  },
                  {
                    "name": "Wohnung",
                    "value": "Wohnung"
                  }
                ],
                "removed": false
              },
              {
                "id": "ca_bmwWpnOGoJVx8D661ttzj",
                "displayName": "Tiergeburtsdatum",
                "type": "string",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "removed": false
              },
              {
                "id": "ca_dCphixTzBtnYIZjD75pn2",
                "displayName": "Postleitzahl",
                "type": "string",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "removed": false
              },
              {
                "id": "ca_w5cUTHMRDlvxlorOmEOSW",
                "displayName": "Tiergeschlecht",
                "type": "options",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "options": [
                  {
                    "name": "MÃ¤nnlich",
                    "value": "MÃ¤nnlich"
                  },
                  {
                    "name": "Weiblich",
                    "value": "Weiblich"
                  }
                ],
                "removed": false
              },
              {
                "id": "ca_nfP2DmLNEiIMcQLe8wQAZ",
                "displayName": "Immobilienwert",
                "type": "string",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "removed": false
              },
              {
                "id": "ca_kjvtR2iOPjKx7Tu5m64Jf",
                "displayName": "Immoscoutanschrift",
                "type": "string",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "removed": false
              },
              {
                "id": "ca_VjUap13SfkiwiFRk1y1qA",
                "displayName": "Immobilentyp",
                "type": "options",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "options": [
                  {
                    "name": "Haus",
                    "value": "Haus"
                  },
                  {
                    "name": "Wohnung",
                    "value": "Wohnung"
                  }
                ],
                "removed": false
              },
              {
                "id": "ca_WyqPfLn4Gsnba1tgHjZoG",
                "displayName": "Kundenart",
                "type": "options",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true,
                "options": [
                  {
                    "name": "EigentÃ¼meranfrage",
                    "value": "EigentÃ¼meranfrage"
                  },
                  {
                    "name": "Immobilienanfrage",
                    "value": "Immobilienanfrage"
                  },
                  {
                    "name": "Interessent",
                    "value": "Interessent"
                  },
                  {
                    "name": "Interessent Firma",
                    "value": "Interessent Firma"
                  },
                  {
                    "name": "Neu/BestandskundenDu",
                    "value": "Neu/BestandskundenDu"
                  },
                  {
                    "name": "Neu/BestandskundenSie",
                    "value": "Neu/BestandskundenSie"
                  }
                ],
                "removed": false
              },
              {
                "id": "ca_ktjlYFH8zBid8PKq2fW0V",
                "displayName": "fehlende ZÃ¤hne",
                "type": "number",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true
              },
              {
                "id": "ca_CFmxU3aVP06z7ELmyspRg",
                "displayName": "Zahnalter",
                "type": "number",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true
              },
              {
                "id": "ca_bcMfr9WB0Puf0PyGUFV1n",
                "displayName": "Zahnangebot",
                "type": "string",
                "defaultMatch": true,
                "canBeUsedToMatch": false,
                "required": false,
                "display": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "n8n-nodes-superchat.superchatTool",
        "typeVersion": 1,
        "position": [
          2704,
          880
        ],
        "id": "74d5e327-2a29-4d0c-8ea2-bed6a128676d",
        "name": "Update an existing contact in Superchat",
        "credentials": {
          "superchatApi": {
            "id": "CGalPTT8O4kdbp7o",
            "name": "Superchat account"
          }
        }
      },
      {
        "id": "050c7c43-38b0-4b52-80ba-9c549cac5c3e",
        "name": "Google Calendar Tool",
        "type": "n8n-nodes-base.googleCalendarTool",
        "typeVersion": 1.3,
        "position": [
          776,
          -1012
        ],
        "parameters": {
          "calendar": {
            "__rl": true,
            "mode": "list",
            "value": "primary"
          },
          "toolDescription": "Verwende dieses Tool um Termine im Google Kalender von Sven Jaeger zu verwalten. Du kannst: 1) Verfuegbarkeit pruefen (ob ein Zeitslot frei ist), 2) Neue Termine erstellen/buchen, 3) Existierende Termine auflisten. WICHTIG: Frage den Kunden IMMER nach gewuenschtem Datum, Uhrzeit und Anliegen BEVOR du den Kalender pruefst. Termine sind standardmaessig 30 Minuten lang. Buero-Zeiten: Mo-Fr 9:00-17:00 Uhr."
        },
        "credentials": {
          "googleCalendarOAuth2Api": {
            "id": "Qr14cnkg7q1ZJ0yd",
            "name": "Google Calendar account"
          }
        }
      }
    ],
    "connections": {
      "Webhook": {
        "main": [
          [
            {
              "node": "Tageszeit",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Bestandskunde",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Code in JavaScript1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Set Begruessung Hund",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Set Begruessung Katze",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Set Begruessung Pferd",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Set Begruessung Neutral",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Tierkranken": {
        "main": [
          [
            {
              "node": "Upsert row(s)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Bestandskunde": {
        "main": [
          [
            {
              "node": "Upsert row(s)1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Begruessung Hund": {
        "main": [
          [
            {
              "node": "Tierkranken",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Begruessung Katze": {
        "main": [
          [
            {
              "node": "Tierkranken",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Begruessung Pferd": {
        "main": [
          [
            {
              "node": "Tierkranken",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Begruessung Neutral": {
        "main": [
          [
            {
              "node": "Tierkranken",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get row(s)": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upsert row(s)": {
        "main": [
          [
            {
              "node": "Send Animalguard Message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upsert row(s)1": {
        "main": [
          [
            {
              "node": "Send a message Bestandskunde",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upsert row(s)2": {
        "main": [
          [
            {
              "node": "Send Message Zahnversicherung",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Answer questions with a vector store": {
        "ai_tool": [
          [
            {
              "node": "Zahnversicherung",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Qdrant Vector Store": {
        "ai_vectorStore": [
          [
            {
              "node": "Answer questions with a vector store",
              "type": "ai_vectorStore",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings OpenAI1": {
        "ai_embedding": [
          [
            {
              "node": "Qdrant Vector Store",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "Zahnguard": {
        "ai_languageModel": [
          [
            {
              "node": "Answer questions with a vector store",
              "type": "ai_languageModel",
              "index": 0
            },
            {
              "node": "Zahnversicherung",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Postgres Chat Memory": {
        "ai_memory": [
          [
            {
              "node": "Zahnversicherung",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Animalguard": {
        "ai_languageModel": [
          [
            {
              "node": "Tierkranken",
              "type": "ai_languageModel",
              "index": 0
            },
            {
              "node": "Answer questions with a vector store1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Qdrant Vector Store1": {
        "ai_vectorStore": [
          [
            {
              "node": "Answer questions with a vector store1",
              "type": "ai_vectorStore",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings OpenAI": {
        "ai_embedding": [
          [
            {
              "node": "Qdrant Vector Store1",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "Answer questions with a vector store1": {
        "ai_tool": [
          [
            {
              "node": "Tierkranken",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Postgres Chat Memory1": {
        "ai_memory": [
          [
            {
              "node": "Tierkranken",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Answer questions with a vector store2": {
        "ai_tool": [
          [
            {
              "node": "Bestandskunde",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Postgres Chat Memory2": {
        "ai_memory": [
          [
            {
              "node": "Bestandskunde",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Qdrant Vector Store2": {
        "ai_vectorStore": [
          [
            {
              "node": "Answer questions with a vector store2",
              "type": "ai_vectorStore",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings OpenAI2": {
        "ai_embedding": [
          [
            {
              "node": "Qdrant Vector Store2",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "Bestandskunden": {
        "ai_languageModel": [
          [
            {
              "node": "Bestandskunde",
              "type": "ai_languageModel",
              "index": 0
            },
            {
              "node": "Answer questions with a vector store2",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript1": {
        "main": [
          [
            {
              "node": "BegrÃ¼ÃŸung bauen",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "BegrÃ¼ÃŸung bauen": {
        "main": [
          [
            {
              "node": "Zahnversicherung",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Tageszeit": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            },
            {
              "node": "Get row(s)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Zahnversicherung": {
        "main": [
          [
            {
              "node": "Lead Scoring",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Lead Scoring": {
        "main": [
          [
            {
              "node": "Superchat Update",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Animalguard Message": {
        "main": [
          [],
          [
            {
              "node": "Error Logger",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send a message Bestandskunde": {
        "main": [
          [],
          [
            {
              "node": "Error Logger",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Message Zahnversicherung": {
        "main": [
          [],
          [
            {
              "node": "Error Logger",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Logger": {
        "main": [
          [
            {
              "node": "Log Error to DataTable",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Superchat Update": {
        "main": [
          [
            {
              "node": "Upsert row(s)2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update an existing contact in Superchat": {
        "ai_tool": [
          [
            {
              "node": "Zahnversicherung",
              "type": "ai_tool",
              "index": 0
            },
            {
              "node": "Bestandskunde",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Google Calendar Tool": {
        "ai_tool": [
          [
            {
              "node": "Bestandskunde",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Sven Jaeger",
    "name": null,
    "description": null,
    "autosaved": false,
    "workflowPublishHistory": [
      {
        "createdAt": "2026-02-21T10:09:23.848Z",
        "id": 436,
        "workflowId": "FOKUvYQahZcDRoFR",
        "versionId": "571d9b6d-99d1-4a58-8cb5-0a529b3e5427",
        "event": "deactivated",
        "userId": "e12ee0c5-65b2-4442-913b-1a8f01e151d9"
      },
      {
        "createdAt": "2026-02-21T10:09:23.864Z",
        "id": 437,
        "workflowId": "FOKUvYQahZcDRoFR",
        "versionId": "571d9b6d-99d1-4a58-8cb5-0a529b3e5427",
        "event": "activated",
        "userId": "e12ee0c5-65b2-4442-913b-1a8f01e151d9"
      }
    ]
  }
}